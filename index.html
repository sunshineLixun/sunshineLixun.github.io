<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="Hello Li">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hello Li">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hello Li">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/"/>

  <title> Hello Li </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Hello Li</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">lx的个人博客</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/08/30/upload/google87f79bd82369149b/" itemprop="url">
                  未命名
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-08-30T15:37:53+08:00" content="2018-08-30">
              2018-08-30
            </time>
          </span>

          

          
            
          

          

          
          
             <span id="/2018/08/30/upload/google87f79bd82369149b/" class="leancloud_visitors" data-flag-title="">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="upload/google87f79bd82369149b.html">text</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/06/19/React更新props与Echarts实际应用/" itemprop="url">
                  React更新props与echarts实际应用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-06-19T17:33:46+08:00" content="2018-06-19">
              2018-06-19
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/React/" itemprop="url" rel="index">
                    <span itemprop="name">React</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          
             <span id="/2018/06/19/React更新props与Echarts实际应用/" class="leancloud_visitors" data-flag-title="React更新props与echarts实际应用">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="关于Echarts初始化"><a href="#关于Echarts初始化" class="headerlink" title="关于Echarts初始化"></a>关于Echarts初始化</h1><p>在react项目中引用Echarts组件，需要在 <code>render()</code>方法中返回一个<code>div</code>元素。因为Echarts底层使用Canvas绘图，所以<code>div</code>元素的宽高一定是已知的。列如：</p>
<p>.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div id=<span class="string">"pieCharts"</span> className=&#123;styles.pieCharts&#125;&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">componentDidMount() &#123;</span></span><br><span class="line"><span class="regexp">  let myChart = echarts.init(document.getElementById('pieCharts'))</span></span><br><span class="line"><span class="regexp">  let options = this.setOptions()</span></span><br><span class="line"><span class="regexp">  myChart.setOption(options)</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">setOptions() &#123;</span></span><br><span class="line"><span class="regexp">  const &#123;take_off, spray_off, spray_on, hand, total&#125; = this.props</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  /</span>*</span><br><span class="line">    该方法中拿到父组件传递过来的props之后，开始巴拉巴拉按照echarts官方文档设置需要的参数。</span><br><span class="line">  *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>.less</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.pieCharts &#123;</span><br><span class="line">  width: 400px;</span><br><span class="line">  height: 250px;</span><br><span class="line">  margin: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="动态更新Echarts数据参数"><a href="#动态更新Echarts数据参数" class="headerlink" title="动态更新Echarts数据参数"></a>动态更新Echarts数据参数</h1><p>如果该组件只是静态去展示某个时间段的数据，完全满足需求。但是如果是动态的去生成数据时，也就是props每时每刻都在改变，那么会发现echarts所展示的数据根本没有发现变化。我们都知道<code>componentDidMount</code>方法只会执行一次，就是在组件挂载完成之后调用。解决该问题就需要用到更新props或者state那一套流程。(React生命周期参考React官网)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">shouldComponentUpdate(nextProps) &#123;</span><br><span class="line">  <span class="keyword">if</span> (nextProps.take_off !== <span class="keyword">this</span>.take_off ||</span><br><span class="line">    nextProps.spray_off !== <span class="keyword">this</span>.spray_off ||</span><br><span class="line">    nextProps.spray_on !== <span class="keyword">this</span>.spray_on ||</span><br><span class="line">    nextProps.hand !== <span class="keyword">this</span>.hand) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">componentDidUpdate() &#123;</span><br><span class="line">  <span class="keyword">const</span> dom = <span class="built_in">document</span>.getElementById(<span class="string">'pieCharts'</span>)</span><br><span class="line">  <span class="keyword">var</span> myChart = echarts.getInstanceById(dom.getAttribute(<span class="string">'_echarts_instance_'</span>));</span><br><span class="line">  myChart.setOption(<span class="keyword">this</span>.setOptions())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>shouldComponentUpdate</code>判断当前组件是否需要更新，一般多用于性能优化，减少不必要的组件刷新次数。在本例中，比较父组件传递过来的props与上一次props的异同。当返回true时，我们在<code>componentDidUpdate</code>方法中取到echarts的实例，重新对echarts设置数据参数。</p>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>需求不难实现，最主要的还是要对React的生命周期有详细的认知。</p>
<p><img src="https://raw.githubusercontent.com/sunshineLixun/bloggerImage/master/imagesreact_life_cycle.png" alt="React生命周期"></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://hackernoon.com/reactjs-component-lifecycle-methods-a-deep-dive-38275d9d13c0" target="_blank" rel="noopener">ReactJs component lifecycle methods — A deep dive</a><br><a href="https://github.com/apache/incubator-echarts/issues/1400" target="_blank" rel="noopener">如何通过dom对象获取echarts对象</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/03/20/算法小集-持续更新/" itemprop="url">
                  算法小集(持续更新)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-03-20T10:24:13+08:00" content="2018-03-20">
              2018-03-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/算法/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          
             <span id="/2018/03/20/算法小集-持续更新/" class="leancloud_visitors" data-flag-title="算法小集(持续更新)">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h1><h2 id="桶排序"><a href="#桶排序" class="headerlink" title="桶排序"></a>桶排序</h2><p>OC</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *bucketSort(<span class="built_in">NSArray</span> *list)&#123;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">NSMutableArray</span> *a = @[].mutableCopy;</span><br><span class="line">	<span class="built_in">NSMutableArray</span> *c = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//初始化数组a中所有元素都为0</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">		a[i] = @<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//遍历b中所有元素 当出现数组a中出现b中元素 数组a的这个元素就+1</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="built_in">NSNumber</span> *num <span class="keyword">in</span> list) &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="built_in">NSInteger</span> index = [num integerValue];</span><br><span class="line">		<span class="comment">//index = 5,2,3,1,8</span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (a[index]) &#123;</span><br><span class="line">			a[index] = @([a[index] integerValue] + <span class="number">1</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			a[index] = @<span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//遍历数组a</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//从大到小</span></span><br><span class="line"><span class="comment">//	for (NSInteger i = 10; i &lt; a.count; i --) &#123;</span></span><br><span class="line"><span class="comment">//		//找到数组a中被增加的元素</span></span><br><span class="line"><span class="comment">//		if ([a[i] integerValue] &gt; 0) &#123;</span></span><br><span class="line"><span class="comment">//			[c addObject:@(i)];</span></span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//从小到大</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> ([a[i] integerValue] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			[c addObject:@(i)];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> (c.count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> c;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JS</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bucketSort</span>(<span class="params">list</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(list)) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> arrayA = []</span><br><span class="line">  <span class="keyword">let</span> arrayC = []</span><br><span class="line"></span><br><span class="line"> <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; <span class="number">10</span>; index++) &#123;</span><br><span class="line">   arrayA[index] = <span class="number">0</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> list.forEach(<span class="function"><span class="params">element</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (element == <span class="literal">undefined</span> || element == <span class="literal">null</span>) <span class="keyword">return</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (arrayA[element] != <span class="literal">undefined</span> || arrayA[element] != <span class="literal">null</span>) &#123;</span><br><span class="line">    arrayA[element] += <span class="number">1</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    arrayA[element] = <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> arrayA.map(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> (item &gt; <span class="number">0</span>) <span class="keyword">return</span> index</span><br><span class="line"> &#125;)</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h2><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *quicksort(<span class="built_in">NSMutableArray</span> *array, <span class="built_in">NSInteger</span> left, <span class="built_in">NSInteger</span> right)&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> (left &gt; right) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//temp 基准数</span></span><br><span class="line">	<span class="built_in">NSInteger</span> temp = [array[left] integerValue];</span><br><span class="line">	<span class="built_in">NSInteger</span> t = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span> (left != right) &#123;</span><br><span class="line">		<span class="comment">//从右向左找</span></span><br><span class="line">		<span class="keyword">while</span> ([array[right] integerValue] &gt; temp &amp;&amp; left &lt; right) &#123;</span><br><span class="line">			right --;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//从左向右找</span></span><br><span class="line">		<span class="keyword">while</span> ([array[left] integerValue] &lt; temp &amp;&amp; left &lt; right) &#123;</span><br><span class="line">			left ++;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//未相遇</span></span><br><span class="line">		<span class="keyword">if</span> (left &lt; right) &#123;</span><br><span class="line">			<span class="comment">//交换位置</span></span><br><span class="line">			t = [array[left] integerValue];</span><br><span class="line">			array[left] = array[right];</span><br><span class="line">			array[right] = @(t);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//left == right 确定基准数位置</span></span><br><span class="line">	array[left] = @(temp);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//递归</span></span><br><span class="line">	<span class="comment">//处理基准数左边数据</span></span><br><span class="line">	quicksort(array, left, left - <span class="number">1</span>);</span><br><span class="line">	<span class="comment">//处理基准数右边数据</span></span><br><span class="line">	quicksort(array, left + <span class="number">1</span>, right);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> array;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h2><p>OC</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *bubblesort(<span class="built_in">NSMutableArray</span> *list)&#123;</span><br><span class="line">	<span class="built_in">NSNumber</span> *t;</span><br><span class="line">	<span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; list.count - <span class="number">1</span>; i++) &#123; <span class="comment">//n个数排序,只用进行n-1趟</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="built_in">NSInteger</span> j = <span class="number">0</span>; j &lt; list.count - <span class="number">1</span>; j++) &#123; <span class="comment">//从第1位开始比较直到最后一位尚未归为的数 因为只进行n-1趟排序,所以最后一位则是n-1。</span></span><br><span class="line">			<span class="keyword">if</span> (list[j] &gt; list[j + <span class="number">1</span>]) &#123;</span><br><span class="line">				t = list[j];</span><br><span class="line">				list[j] = list[j+ <span class="number">1</span>];</span><br><span class="line">				list[j + <span class="number">1</span>] = t;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JS</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bubbleSort</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(array)) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">let</span> T = <span class="number">0</span>;</span><br><span class="line"> <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; array.length - <span class="number">1</span>; index++) &#123;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; array.length <span class="number">-1</span>; j++) &#123;</span><br><span class="line">     <span class="keyword">if</span> (array[j] &gt; array[j + <span class="number">1</span>]) &#123;</span><br><span class="line">       T = array[j]</span><br><span class="line">       array[j] = array[j + <span class="number">1</span>]</span><br><span class="line">       array[j + <span class="number">1</span>] = T</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> array</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h1><h2 id="二分查找"><a href="#二分查找" class="headerlink" title="二分查找"></a>二分查找</h2><p>JS</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">binary_search</span>(<span class="params">list, item</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> low = <span class="number">0</span></span><br><span class="line">  <span class="keyword">let</span> high = list.length - <span class="number">1</span></span><br><span class="line">  <span class="keyword">while</span> (low &lt;= high) &#123;</span><br><span class="line">    <span class="keyword">const</span> mid = <span class="built_in">Math</span>.floor((low + high ) / <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">const</span> guess = list[mid]</span><br><span class="line">    <span class="keyword">if</span> (guess == item) &#123;</span><br><span class="line">        <span class="keyword">return</span> mid</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">if</span> (guess &gt; item) &#123;</span><br><span class="line">        high = mid - <span class="number">1</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        low = mid + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/01/AutoLayout-父视图根据子视图自适应/" itemprop="url">
                  AutoLayout - 父视图根据子视图布局自适应大小
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-09-01T15:54:00+08:00" content="2017-09-01">
              2017-09-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          
             <span id="/2017/09/01/AutoLayout-父视图根据子视图自适应/" class="leancloud_visitors" data-flag-title="AutoLayout - 父视图根据子视图布局自适应大小">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本文记录AutoLayout日常布局UI时的技巧。每当拿到新的界面设计时,比</p>
<p>如这样的: </p>
<p><img src="/images/1.png" width="50%" height="50%" align="center/"></p>
<p>当某个字段的长度不确定时,(图1中的“作业地址”,图2中”预约地址”和“取消原因”)。Label的行数就要设置为0或者 &gt;=1。总试图的高度就不确定。于是乎就要开始就算containerView的高度了。</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">CGFloat</span>)cellHeight&#123;</span><br><span class="line">	<span class="built_in">CGFloat</span> publicHeight = kViewTopPadding + kImageSize().height + kViewTypeMargin + _nameStrSize.height + kViewTypePadding + _nameTextSize.height + kViewTypeMargin / <span class="number">2</span> + kCellBottomPadding;</span><br><span class="line">	<span class="keyword">switch</span> (_layoutViewType) &#123;</span><br><span class="line">		<span class="keyword">case</span> ViewLayoutBreviaryType:</span><br><span class="line">			<span class="keyword">return</span> publicHeight;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> ViewLayoutDetailType:</span><br><span class="line">			<span class="comment">//判断当前model存储的信息是待执行还是已取消状态</span></span><br><span class="line">			<span class="keyword">if</span> (_orderModel.reserveType == YWBOrderReservationToBeConfirm) &#123;</span><br><span class="line">				<span class="keyword">return</span> publicHeight + kViewTypeMargin / <span class="number">2</span> + _addressStrSize.height + kViewTypePadding + _addressTextSize.height + kViewTypeMargin + _typeStrSize.height + _typeTextSize.height + kViewTypeMargin + kButtonHeight + kViewBottomPadding + kCellBottomPadding;</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span>(_orderModel.reserveType == YWBOrderReservationCancledForSaler || _orderModel.reserveType == YWBOrderReservationCancledForClient)&#123;</span><br><span class="line">				<span class="keyword">return</span> publicHeight + kViewTypeMargin / <span class="number">2</span> + _addressStrSize.height + kViewTypePadding + _addressTextSize.height + kViewTypeMargin + _cancleStrSize.height + kViewTypePadding + _cancleTextSize.height + kViewBottomPadding + kCellBottomPadding;</span><br><span class="line">			&#125;</span><br><span class="line">		   <span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">CGFloat</span>)heightWithWidth:(<span class="built_in">CGFloat</span>)width font:(<span class="built_in">UIFont</span> *)font</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">CGRect</span> attrsRect = [<span class="keyword">self</span> boundingRectWithSize:<span class="built_in">CGSizeMake</span>(width, <span class="built_in">CGFLOAT_MAX</span>)</span><br><span class="line">										  options:<span class="built_in">NSStringDrawingUsesLineFragmentOrigin</span> | <span class="built_in">NSStringDrawingUsesFontLeading</span></span><br><span class="line">									   attributes:@&#123;<span class="built_in">NSFontAttributeName</span> : font&#125;</span><br><span class="line">										  context:<span class="literal">nil</span>];</span><br><span class="line">	<span class="keyword">return</span> attrsRect.size.height;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果不细心漏掉某一处高度,查找起来也比较麻烦。每次算高度是我不爱干的一件事情。没有技术含量😂。完全就是细心活。多亏AutoLayout能让我们从这一毫无兴趣的工作中解放出来。</p>
<h1 id="父视图自适应"><a href="#父视图自适应" class="headerlink" title="父视图自适应"></a>父视图自适应</h1><p>新建Xcode工程。在Main.storyboard的ViewController中随意拖入view控件，颜色暂定为blue。放置3个Label控件。</p>
<p><img src="https://i.loli.net/2018/03/02/5a98ee340eaab.png" alt="1.png"></p>
<ol>
<li>先不设置blueview的约束。</li>
<li>逐步设置Label的约束。</li>
</ol>
<p>黑色Label约束如下:</p>
<p><img src="https://i.loli.net/2018/03/02/5a98ee7ee44ec.png" alt="2.png"></p>
<p>在这里我设置了黑色Label的size。这个并无关系，可设可不设。使用Label的固有大小也行。</p>
<p>黄色Label约束如下:</p>
<p><img src="https://i.loli.net/2018/03/02/5a98eea02e37a.png" alt="3.png"></p>
<p>红色Label约束如下:</p>
<p><img src="https://i.loli.net/2018/03/02/5a98eeb892428.png" alt="4.png"></p>
<p>Label的行数都为0。</p>
<h2 id="重点"><a href="#重点" class="headerlink" title="重点"></a>重点</h2><p><strong><em>Label一定要设置距离父视图的间距。这样AutoLayout才能计算出父视图的大小。</em></strong></p>
<h1 id="最重要的一步"><a href="#最重要的一步" class="headerlink" title="最重要的一步"></a>最重要的一步</h1><p>看下view的约束<br><img src="https://i.loli.net/2018/03/02/5a98eed285ff8.png" alt="5.png"><br><img src="https://i.loli.net/2018/03/02/5a98eee554feb.png" alt="6.png"><br>将view的固有尺寸设置为placeholder。 我们都知道Label Button ImageView(已经设置image属性)这些控件，在用AutoLayout布局时，只需要设置外边距就行了。AutoLayout会自动适应size大小。这就是固有尺寸。反观View就不行了。假如只设置View的外边距，这时一定会报出约束错误。但是View作为容器。它能根据子控件的大小来自适应。只需要将其固有尺寸(size)都设置为0。</p>
<p>这是对于高度不固定的来讲。如果宽度不固定呢？答案是同样适用，一般来说，view的宽度是固定的。高度不固定。</p>
<h2 id="需要注意的问题"><a href="#需要注意的问题" class="headerlink" title="需要注意的问题"></a>需要注意的问题</h2><p>如果不设置view的左右边间距或者宽度你就会发现变成了这样:<br><img src="https://i.loli.net/2018/03/02/5a98eefb35dd4.png" alt="7.png"><br>view的左右边距已经被Label撑到屏幕外面了。因为这时view的宽度也是会随着Label变化的。<br>所以说我设置了view的左右边距(或者设置其固定的宽度)</p>
<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><p>接来下就可以设置Label的text属性了。随便输入汉字来验证一下：<br><img src="https://i.loli.net/2018/03/02/5a98ef188c27f.png" alt="8.png"><br><img src="https://i.loli.net/2018/03/02/5a98ef188f224.png" alt="9.png"></p>
<p>可以发现view的高度已经随着Label的变化而变化了。其他的控件以此类推。都是一样的道理。另外纯代码布局也同样适用。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>view作为容器类其承载其他控件的显示。只要设置了子控件的距离自己的约束。并将自己的固有尺寸设置为placeholder(也就是width和height都为0)。这样AutoLayout就能自动计算出view的大小。</p>
<h1 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h1><p>怎么样拿到view的大小呢？系统为我们提供了这样的API</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* The size fitting most closely to targetSize in which the receiver's subtree can be laid out while optimally satisfying the constraints. If you want the smallest possible size, pass UILayoutFittingCompressedSize; for the largest possible size, pass UILayoutFittingExpandedSize.</span></span><br><span class="line"><span class="comment">     Also see the comment for UILayoutPriorityFittingSizeLevel.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@available</span>(iOS <span class="number">6.0</span>, *)</span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">systemLayoutSizeFitting</span><span class="params">(<span class="number">_</span> targetSize: CGSize)</span></span> -&gt; <span class="type">CGSize</span> <span class="comment">// Equivalent to sending -systemLayoutSizeFittingSize:withHorizontalFittingPriority:verticalFittingPriority: with UILayoutPriorityFittingSizeLevel for both priorities.</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@available</span>(iOS <span class="number">8.0</span>, *)</span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">systemLayoutSizeFitting</span><span class="params">(<span class="number">_</span> targetSize: CGSize, withHorizontalFittingPriority horizontalFittingPriority: UILayoutPriority, verticalFittingPriority: UILayoutPriority)</span></span> -&gt; <span class="type">CGSize</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在viewDidLayoutSubviews或者layoutSubviews中通过调用上面API就能够获得通过AutoLayout计算过后view的大小。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/10/React-Native-自定义组件/" itemprop="url">
                  React Native 自定义组件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-07-10T16:02:49+08:00" content="2017-07-10">
              2017-07-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/React-Native/" itemprop="url" rel="index">
                    <span itemprop="name">React Native</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          
             <span id="/2017/07/10/React-Native-自定义组件/" class="leancloud_visitors" data-flag-title="React Native 自定义组件">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h1><p>自定义组件(Button)代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="comment">//解构</span></span><br><span class="line">        <span class="keyword">const</span> &#123;title,onClick&#125; = <span class="keyword">this</span>.props;</span><br><span class="line">        <span class="keyword">return</span>(</span><br><span class="line">            &lt;TouchableOpacity style=&#123;styles.touchStyle&#125;</span><br><span class="line">                              onPress=&#123;onClick&#125;</span><br><span class="line">            &gt;</span><br><span class="line">                &lt;Text style=&#123;styles.textStyle&#125;&gt;&#123;<span class="keyword">this</span>.props.title&#125;&lt;<span class="regexp">/Text&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>TouchableOpacity&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>export default</code>关键字：导出自定义组件,可以被别的js文件所引用。如果没有关键字,就只能在本js文件使用该类。例如在<code>Login.js</code>文件中可以用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import Button from &apos;./Button&apos;</span><br></pre></td></tr></table></figure>
<p>导入Button组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//解构</span></span><br><span class="line"><span class="keyword">const</span> &#123;title,onClick&#125; = <span class="keyword">this</span>.props;</span><br></pre></td></tr></table></figure>
<p>解构从父组件的传过来的props, 子组件拿到父组件设置的属性值,显示传递的值或者处理传递过来的方法。</p>
<p>列如上面代码:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///显示Button的title</span></span><br><span class="line">&lt;Text style=&#123;styles.textStyle&#125;&gt;&#123;<span class="keyword">this</span>.props.title&#125;&gt;</span><br><span class="line">&lt;<span class="regexp">/Text&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="comment">//处理TouchableOpacity的点击事件</span></span><br><span class="line">&lt;TouchableOpacity style=&#123;styles.touchStyle&#125;</span><br><span class="line">                  onPress=&#123;onClick&#125;&gt;</span><br><span class="line">&lt;<span class="regexp">/TouchableOpacity&gt;</span></span><br></pre></td></tr></table></figure>
<p>父组件调用代码: 传递title信息和onClick方法回调</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button title=<span class="string">"登录"</span></span><br><span class="line">        onClick=&#123;() =&gt; alert(<span class="string">'点击了登录按钮'</span>)&#125;/&gt;</span><br></pre></td></tr></table></figure>
<h1 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h1><p>与方法一的区别不大</p>
<p>代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component,PropTypes &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Text,TouchableOpacity,StyleSheet &#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">        title: PropTypes.string,</span><br><span class="line">        onPress: PropTypes.func</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span>(</span><br><span class="line">            &lt;TouchableOpacity style=&#123;styles.touchStyle&#125;</span><br><span class="line">                              onPress=&#123;()=&gt;&#123;</span><br><span class="line">                                <span class="keyword">if</span> (<span class="keyword">this</span>.props.onPress) &#123;</span><br><span class="line">                                    <span class="keyword">this</span>.props.onPress(<span class="keyword">this</span>)</span><br><span class="line">                                &#125;</span><br><span class="line">                              &#125;&#125;</span><br><span class="line">            &gt;</span><br><span class="line">                &lt;Text style=&#123;styles.textStyle&#125;&gt;&#123;<span class="keyword">this</span>.props.title&#125;&lt;<span class="regexp">/Text&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>TouchableOpacity&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">        title: PropTypes.string,</span><br><span class="line">        onPress: PropTypes.func</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>暴露出组件的属性(title)和方法(onPress)。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;TouchableOpacity style=&#123;styles.touchStyle&#125;</span><br><span class="line">                              onPress=&#123;()=&gt;&#123;</span><br><span class="line">                                <span class="keyword">if</span> (<span class="keyword">this</span>.props.onPress) &#123;</span><br><span class="line">                                    <span class="keyword">this</span>.props.onPress(<span class="keyword">this</span>)</span><br><span class="line">                                &#125;</span><br><span class="line">                              &#125;&#125;</span><br><span class="line">            &gt;</span><br><span class="line">                &lt;Text style=&#123;styles.textStyle&#125;&gt;&#123;<span class="keyword">this</span>.props.title&#125;&lt;<span class="regexp">/Text&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>TouchableOpacity&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>处理TouchableOpacity的点击事件,设置回调函数</li>
<li>显示Button的title</li>
</ul>
<p>组件调用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button  title=&quot;登录&quot;</span><br><span class="line">        onPress=&#123;() =&gt; alert(&apos;点击了登录按钮&apos;)&#125;/&gt;</span><br></pre></td></tr></table></figure>
<h1 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h1><p><img src="https://i.loli.net/2018/03/02/5a98efa4c7dc0.gif" alt="RNCustomComponent.gif"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/06/记一次React-Native-StackNavigator使用小结/" itemprop="url">
                  记一次React Native的StackNavigator使用小结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-07-06T16:10:49+08:00" content="2017-07-06">
              2017-07-06
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/React-Native/" itemprop="url" rel="index">
                    <span itemprop="name">React Native</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          
             <span id="/2017/07/06/记一次React-Native-StackNavigator使用小结/" class="leancloud_visitors" data-flag-title="记一次React Native的StackNavigator使用小结">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h1><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (</span><br><span class="line">  routeConfigMap: NavigationRouteConfigMap,</span><br><span class="line">  stackConfig: StackNavigatorConfig = &#123;&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>在<code>StackNavigator</code>的初始化中需要传入两个参数：<code>routeConfigMap</code> 表示路由配置参数, <code>stackConfig</code>表示配置<code>StackNavigatorConfig</code>一些样式或者属性。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MainSrceenStackNavigator = StackNavigator(</span><br><span class="line">    &#123;</span><br><span class="line">        MainScreenNavigator: &#123;screen: MainScreenNavigator&#125;,</span><br><span class="line">        DiscoverDetail: &#123;screen: DiscoverDetail&#125;,</span><br><span class="line">        SettingDetail: &#123;screen: SettingDetail&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        initialRouteName: <span class="string">'MainScreenNavigator'</span>,</span><br><span class="line">        mode:<span class="string">'card'</span>,</span><br><span class="line">        headerMode:<span class="string">'screen'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>上述代码块配置了3个不同路由的界面，<code>initialRouteName</code>设置根导航控制器界面,默认第一个为根路由。<code>mode</code>表示界面的跳转方式:push或者模态弹出。<code>headerMode</code>表示界面在做跳转时的区域。有三种方式:<code>float</code>,<code>screen</code>,<code>none</code>。<code>float</code>表示不包括导航条在内;<code>screen</code>表示整个屏幕(包括导航条);<code>none</code>表示导航条的隐藏。还有很多属性可选配置。用到可在官网查询<a href="https://reactnavigation.org/docs/navigators/stack" target="_blank" rel="noopener">React Navigation
</a>。</p>
<h1 id="🌰"><a href="#🌰" class="headerlink" title="🌰"></a>🌰</h1><p>在<code>我的</code>界面配置导航条样式</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> navigationOptions = <span class="function">(<span class="params">&#123;navigation&#125;</span>)=&gt;</span>(&#123;</span><br><span class="line">        <span class="comment">// tabBarLabel: '我的',</span></span><br><span class="line">        title: <span class="string">'我'</span>,</span><br><span class="line">        headerStyle:&#123;</span><br><span class="line">            backgroundColor: <span class="string">'black'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        headerTitleStyle:&#123;</span><br><span class="line">            color: <span class="string">'white'</span> </span><br><span class="line">        &#125;,</span><br><span class="line">        tabBarIcon:<span class="function">(<span class="params">&#123;tintColor,focused&#125;</span>) =&gt;</span> (</span><br><span class="line">            &lt;TabBarItem  </span><br><span class="line">              tintColor=&#123;tintColor&#125;  </span><br><span class="line">              focused=&#123;focused&#125;  </span><br><span class="line">              normalImage=&#123;<span class="built_in">require</span>(<span class="string">'./source/我的@2x.png'</span>)&#125;  </span><br><span class="line">              selectedImage=&#123;<span class="built_in">require</span>(<span class="string">'./source/我的-选中@2x.png'</span>)&#125;  </span><br><span class="line">            /&gt;  </span><br><span class="line">        ),</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>然后再显示出ListView(三个分区的ListView)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> ds = <span class="keyword">new</span> ListView.DataSource(&#123;<span class="attr">rowHasChanged</span>: <span class="function">(<span class="params">r1, r2</span>) =&gt;</span> r1 !== r2,<span class="attr">sectionHeaderHasChanged</span>:<span class="function">(<span class="params">s1,s2</span>)=&gt;</span>s1 !== s2&#125;);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            dataSource: ds.cloneWithRowsAndSections([[<span class="string">'钱包'</span>],[<span class="string">'收藏'</span>,<span class="string">'相册'</span>,<span class="string">'卡包'</span>,<span class="string">'表情'</span>],[<span class="string">'设置'</span>]]),</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">render()&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;View style=&#123;styles.container&#125;&gt;</span><br><span class="line">                &lt;ListView </span><br><span class="line">                dataSource=&#123;<span class="keyword">this</span>.state.dataSource&#125;</span><br><span class="line">                renderRow=&#123;<span class="keyword">this</span>._renderRow.bind(<span class="keyword">this</span>)&#125;</span><br><span class="line">                renderSeparator=&#123;<span class="keyword">this</span>._renderSeparator&#125;&gt;</span><br><span class="line">                &lt;<span class="regexp">/ListView&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>View&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>分割线</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">_renderSeparator(sectionID, rowID, adjacentRowHighlighted)  &#123;</span><br><span class="line">        <span class="keyword">if</span>(sectionID == <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;View style=&#123;styles.separatorStyle&#125;&gt;&lt;/View&gt;</span><br><span class="line">        )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ListView每个分区每一行的数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">_renderRow(rowData, sectionID, rowID, highlightRow)&#123;</span><br><span class="line">       <span class="keyword">if</span> (sectionID == <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span>(</span><br><span class="line">               &lt;TouchableOpacity onPress=&#123;() =&gt;&#123;</span><br><span class="line">                   highlightRow(sectionID,rowID),</span><br><span class="line">                   <span class="keyword">this</span>.props.navigation.navigate(<span class="string">'SettingDetail'</span>,&#123;<span class="string">'name'</span>: rowData&#125;)</span><br><span class="line">               &#125;&#125;&gt;</span><br><span class="line">                   &lt;View style=&#123;styles.section_0_style&#125;&gt;</span><br><span class="line">                       &lt;Text style=&#123;&#123;<span class="attr">fontSize</span>:<span class="number">15</span>&#125;&#125;&gt;&#123;rowData&#125;&lt;<span class="regexp">/Text&gt;</span></span><br><span class="line"><span class="regexp">                   &lt;/</span>View&gt;</span><br><span class="line">               &lt;<span class="regexp">/TouchableOpacity&gt;</span></span><br><span class="line"><span class="regexp">           )</span></span><br><span class="line"><span class="regexp">       &#125;else if(sectionID == 1)&#123;</span></span><br><span class="line"><span class="regexp">           return(</span></span><br><span class="line"><span class="regexp">           &lt;TouchableOpacity onPress=&#123;() =&gt;&#123;</span></span><br><span class="line"><span class="regexp">                   highlightRow(sectionID,rowID),</span></span><br><span class="line"><span class="regexp">                   this.props.navigation.navigate('SettingDetail',&#123;'name': rowData&#125;)</span></span><br><span class="line"><span class="regexp">               &#125;&#125;&gt;   </span></span><br><span class="line"><span class="regexp">           &lt;View style=&#123;styles.viewStyle&#125;&gt;</span></span><br><span class="line"><span class="regexp">               &lt;Text style=&#123;&#123;fontSize:15&#125;&#125;&gt;&#123;rowData&#125;&lt;/</span>Text&gt;</span><br><span class="line">           &lt;<span class="regexp">/View&gt;</span></span><br><span class="line"><span class="regexp">           &lt;/</span>TouchableOpacity&gt;</span><br><span class="line">           )</span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">           <span class="keyword">return</span>(</span><br><span class="line">               &lt;TouchableOpacity onPress=&#123;() =&gt;&#123;</span><br><span class="line">                   highlightRow(sectionID,rowID),</span><br><span class="line">                   <span class="keyword">this</span>.props.navigation.navigate(<span class="string">'SettingDetail'</span>,&#123;<span class="string">'name'</span>: rowData&#125;)</span><br><span class="line">               &#125;&#125;&gt;</span><br><span class="line">               &lt;View style=&#123;styles.section_0_style&#125;&gt;</span><br><span class="line">                    &lt;Text style=&#123;&#123;<span class="attr">fontSize</span>:<span class="number">15</span>&#125;&#125;&gt;&#123;rowData&#125;&lt;<span class="regexp">/Text&gt;</span></span><br><span class="line"><span class="regexp">               &lt;/</span>View&gt;</span><br><span class="line">               &lt;<span class="regexp">/TouchableOpacity&gt;</span></span><br><span class="line"><span class="regexp">           )</span></span><br><span class="line"><span class="regexp">       &#125;</span></span><br><span class="line"><span class="regexp">   &#125;</span></span><br></pre></td></tr></table></figure>
<p><code>this.props.navigation.navigate(&#39;SettingDetail&#39;,{&#39;name&#39;: rowData})</code> navigation可用属性来获取。 该函数传递参数<code>{rowData}</code>即ListView每行数据到<code>SettingDetail</code>界面。</p>
<p>再<code>SettingDetail</code>界面中可用下面方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> navigationOptions = <span class="function">(<span class="params">&#123;navigation&#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">       title:<span class="string">`<span class="subst">$&#123;navigation.state.params.name&#125;</span>`</span>,</span><br><span class="line">       headerBackTitle: <span class="string">'返回'</span>,</span><br><span class="line">   &#125;)</span><br></pre></td></tr></table></figure>
<p>来获取传递过来的参数显示到导航条的title。</p>
<p><img src="https://i.loli.net/2018/03/02/5a98f066c0e5b.gif" alt="RN.gif"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/13/iOS界面优化系列之：处理图片缩放问题/" itemprop="url">
                  iOS界面优化系列之：处理图片缩放问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-02-13T14:56:05+08:00" content="2017-02-13">
              2017-02-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          
             <span id="/2017/02/13/iOS界面优化系列之：处理图片缩放问题/" class="leancloud_visitors" data-flag-title="iOS界面优化系列之：处理图片缩放问题">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在众多阅读类的APP中，比如:</p>
<figure class="half"><br>    <img src="http://upload-images.jianshu.io/upload_images/1421047-cefaed703108a4aa.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/320/h/568"><br>    <img src="http://upload-images.jianshu.io/upload_images/1421047-8b81cc02257ab29f.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/320/h/568"><br></figure>

<p>这类比较稍微简单的界面中充斥着大量的的图片，多则6张,少则3-4张。再者像微博这类重型社交的APP，有的cell都已经有9张图片。图片的优化程度对整个界面的流畅度来说都是重中之重。（另外一个也很重要的地方就是文本的异步渲染），后几个系列也会说到。</p>
<p>像这种异步加载图片的开源库有很多：<code>SD_WebImageView</code>  <code>YYWebImage  Kingfisher</code>  <code>PINRemoteImage</code> …<br>开发者如果只是简单的调用一下 <code>sd_setImageWithURL:</code> 图片能够很好的显示出来。假如从网络加载的图片与自己设置的UIImageView的尺寸不一致,就会导致这种结果。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-8aeb9245ca7573ca.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/320/h/568" alt="Jietu20170112-131912.png"><br>如果是真机调试 打开<code>Instruments</code>中<code>Core Animation</code><br><img src="https://i.loli.net/2018/03/02/5a98f166a8d51.png" alt="Jietu20170112-135233.png"><br>在右侧栏中打开<br><img src="http://upload-images.jianshu.io/upload_images/1421047-7ce789d8152d0bff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/320/h/568" alt="Jietu20170112-135327.png"><br>如果是模拟器，打开Debug -&gt;Color Misaligned Images</p>
<p>这个选项检查了图片是否被缩放，以及像素是否对齐。被放缩的图片会被标记为黄色，像素不对齐则会标注为紫色。**黄色、紫色越多，性能越差。</p>
<p>解决办法：<br>1.与后台协商，让后台返回的图片尺寸与客户端UIImageView尺寸一致;<br>2.自己处理。</p>
<p>下面介绍下如何自己处理</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIImage</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">resizeImage</span><span class="params">(<span class="number">_</span> image: UIImage, targetSize: CGSize)</span></span> -&gt; <span class="type">UIImage</span>? &#123;</span><br><span class="line">            <span class="keyword">let</span> newRect = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: targetSize.width, height: targetSize.height).integral</span><br><span class="line">            <span class="type">UIGraphicsBeginImageContextWithOptions</span>(targetSize, <span class="literal">false</span>, <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>() &#123;</span><br><span class="line">                context.interpolationQuality = .high</span><br><span class="line">                <span class="keyword">let</span> flipVertical = <span class="type">CGAffineTransform</span>(a: <span class="number">1</span>, b: <span class="number">0</span>, <span class="built_in">c</span>: <span class="number">0</span>, d: -<span class="number">1</span>, tx: <span class="number">0</span>, ty: targetSize.height)</span><br><span class="line">                context.concatenate(flipVertical)</span><br><span class="line">                context.draw(<span class="keyword">self</span>.cgImage!, <span class="keyword">in</span>: newRect)</span><br><span class="line">                <span class="keyword">let</span> newImage = <span class="type">UIImage</span>(cgImage: context.makeImage()!)</span><br><span class="line">                <span class="type">UIGraphicsEndImageContext</span>()</span><br><span class="line">               <span class="keyword">return</span> newImage</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很简单就是网络下载下来的图片按照自己设置的UIImageView的尺寸来重新draw一个。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setImage</span>&lt;T: UIImageView&gt;<span class="params">(<span class="number">_</span> imageView: T, URLString: String, targetSize: CGSize)</span></span>&#123;</span><br><span class="line">        imageView.pin_setImage(from: <span class="type">URL</span>.<span class="keyword">init</span>(string: <span class="type">URLString</span>), completion: &#123;(<span class="type">PINRemoteImageManagerResult</span>) <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> image = <span class="type">PINRemoteImageManagerResult</span>.image&#123;</span><br><span class="line">                    imageView.image = image.resizeImage(image, targetSize: targetSize)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>重新给UIImageView设置image属性</p>
<p>重新打开Color Misaligned Images功能来检测一下<br><img src="http://upload-images.jianshu.io/upload_images/1421047-95561fdba06255d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/320/h/568" alt="Jietu20170112-140353.png"></p>
<p>嗯！ 不错哦，之前的黄色没有了。 本以为就达到了的要求。</p>
<p>但是用<code>Instruments</code>中<code>Time Profiler</code><br><img src="https://i.loli.net/2018/03/02/5a98f197b4aaa.png" alt="Jietu20170112-140732.png"><br>来检测下处理该函数所需要的时间</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-758e84ae67a3697e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20170112-141255.png"></p>
<p>用Core Animation来测下FPS</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-7663f55e36043484.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20170112-142314.png"></p>
<p>虽然已经很流畅了（注：文本用到了异步绘制）,  基本在54左右， 但是距离满帧59 - 60还差那么一丢丢。</p>
<p>再来观察给UIImage扩展的这个方法 发现它是在主线程中执行，当快速滑动表格时，会有大量的图片在主线程中重新绘制。这个是造成缺失那几帧的主要原因。</p>
<p>解决办法：那就在子线程总去draw, 在主线程中去显示</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIImageView</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">drawImage</span><span class="params">(<span class="number">_</span> image: UIImage, targetSize: CGSize)</span></span> &#123;</span><br><span class="line">        <span class="type">DispatchQueue</span>.global().async &#123;</span><br><span class="line">            <span class="keyword">let</span> newRect = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: targetSize.width, height: targetSize.height).integral</span><br><span class="line">            <span class="type">UIGraphicsBeginImageContextWithOptions</span>(targetSize, <span class="literal">false</span>, <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>() &#123;</span><br><span class="line">                context.interpolationQuality = .high</span><br><span class="line">                <span class="keyword">let</span> flipVertical = <span class="type">CGAffineTransform</span>(a: <span class="number">1</span>, b: <span class="number">0</span>, <span class="built_in">c</span>: <span class="number">0</span>, d: -<span class="number">1</span>, tx: <span class="number">0</span>, ty: targetSize.height)</span><br><span class="line">                context.concatenate(flipVertical)</span><br><span class="line">                context.saveGState()</span><br><span class="line">                context.draw(image.cgImage!, <span class="keyword">in</span>: newRect)</span><br><span class="line">                context.restoreGState()</span><br><span class="line">                <span class="keyword">let</span> newImage = <span class="type">UIGraphicsGetImageFromCurrentImageContext</span>()</span><br><span class="line">                <span class="type">UIGraphicsEndImageContext</span>()</span><br><span class="line">                <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">let</span> newImage = newImage&#123;</span><br><span class="line">                        <span class="keyword">self</span>.layer.contents = newImage.cgImage</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Objective-C</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)drawImage:(<span class="built_in">UIImage</span> *)image targetSize:(<span class="built_in">CGSize</span> )size&#123;</span><br><span class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(QOS_CLASS_DEFAULT, <span class="number">0</span>), ^&#123;</span><br><span class="line">        <span class="built_in">CGRect</span> newRect = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, size.width, size.height);</span><br><span class="line">        <span class="built_in">CGRectIntegral</span>(newRect);</span><br><span class="line">        <span class="built_in">UIGraphicsBeginImageContextWithOptions</span>(size, <span class="literal">NO</span>, [<span class="built_in">UIScreen</span> mainScreen].scale);</span><br><span class="line">        <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">        <span class="built_in">CGContextSetInterpolationQuality</span>(context, kCGInterpolationHigh);</span><br><span class="line">        <span class="built_in">CGAffineTransform</span> transform = <span class="built_in">CGAffineTransformMake</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span>, size.height);</span><br><span class="line">        <span class="built_in">CGContextConcatCTM</span>(context, transform);</span><br><span class="line">        <span class="built_in">CGContextSaveGState</span>(context);</span><br><span class="line">        <span class="built_in">CGContextDrawImage</span>(context, newRect, image.CGImage);</span><br><span class="line">        <span class="built_in">CGContextRestoreGState</span>(context);</span><br><span class="line">        <span class="built_in">UIImage</span> *newImage = <span class="built_in">UIGraphicsGetImageFromCurrentImageContext</span>();</span><br><span class="line">        <span class="built_in">UIGraphicsEndImageContext</span>();</span><br><span class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            <span class="keyword">if</span> (newImage) &#123;</span><br><span class="line">                <span class="keyword">self</span>.layer.contents = (<span class="keyword">id</span>)(newImage.CGImage);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该方法也很简单,在子线程中去重新draw一个UIImage,在主线程中去显示。</p>
<p>调用：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setImage</span>&lt;T: UIImageView&gt;<span class="params">(<span class="number">_</span> imageView: T, URLString: String, targetSize: CGSize)</span></span>&#123;</span><br><span class="line">        imageView.pin_setImage(from: <span class="type">URL</span>.<span class="keyword">init</span>(string: <span class="type">URLString</span>), completion: &#123;(<span class="type">PINRemoteImageManagerResult</span>) <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> image = <span class="type">PINRemoteImageManagerResult</span>.image&#123;</span><br><span class="line">                imageView.drawImage(image, targetSize: targetSize)</span><br><span class="line"><span class="comment">//                    imageView.image = image.resizeImage(image, targetSize: targetSize)</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>重新测下帧数以及Time Profile</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-2c7369df156405e6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20170112-143643.png"><br>当快速滑动的时候基本上能够达到慢帧的状态</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-833bed416800300a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20170112-143924.png"><br>所用的时间也是非常少的。在16ms以内。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/08/dispatch-semaphore-t-信号量/" itemprop="url">
                  dispatch_semaphore_t 信号量
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-12-08T16:20:14+08:00" content="2016-12-08">
              2016-12-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          
             <span id="/2016/12/08/dispatch-semaphore-t-信号量/" class="leancloud_visitors" data-flag-title="dispatch_semaphore_t 信号量">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="dispatch-semaphore-create"><a href="#dispatch-semaphore-create" class="headerlink" title="dispatch_semaphore_create"></a><code>dispatch_semaphore_create</code></h1><p><code>dispatch_semaphore_create(long value)</code> 传入的是一个数字,该数字必须大于等于0。列如传入10，表示创建一个信号总量为10信号量（就好比一共有10个停车位）。假如传入0</p>
<p>The starting value for the semaphore. Passing a value less than zero will cause NULL to be returned.</p>
<p>则返回为NULL</p>
<h1 id="dispatch-semaphore-wait"><a href="#dispatch-semaphore-wait" class="headerlink" title="dispatch_semaphore_wait"></a><code>dispatch_semaphore_wait</code></h1><p>该函数会使传入的信号量减1,当信号量有 &gt;= 1时,就会继续往下执行。如果没有,该线程就会一直处于等待状态，可阻塞当前线程。该函数需要传入另一个参数 </p>
<p><code>#define DISPATCH_TIME_NOW  表示从现在开始 #define DISPATCH_TIME_FOREVER  表示永不超时</code></p>
<h1 id="dispatch-semaphore-single"><a href="#dispatch-semaphore-single" class="headerlink" title="dispatch_semaphore_single"></a><code>dispatch_semaphore_single</code></h1><p>该函数会使传入的信号量加1,与<code>dispatch_ semaphore _ wait</code>成对出现。</p>
<p>拿YYKit源码来举例：在#import “UIButton+YYWebImage.m”中</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="comment">//声明一个信号总量为1信号量</span></span><br><span class="line">    _lock = dispatch_semaphore_create(<span class="number">1</span>);</span><br><span class="line">    _dic = [<span class="built_in">NSMutableDictionary</span> new];</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (_YYWebImageSetter *)setterForState:(<span class="built_in">NSNumber</span> *)state &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//是当前线程处于阻塞状态,直到有 &gt;= 1 信号量才会继续执行下面的取值操作</span></span><br><span class="line">    dispatch_semaphore_wait(_lock, DISPATCH_TIME_FOREVER);</span><br><span class="line">    <span class="comment">//如果不加入线程锁，就很有可能发生多个线程同时访问_dic字典,造成资源竞争。</span></span><br><span class="line">    _YYWebImageSetter *<span class="keyword">setter</span> = _dic[state];</span><br><span class="line">    <span class="comment">//使该信号量加1。保持信号量的平衡，如果没有保持信号量的平衡,可能会出现莫名的bug,甚至crash。</span></span><br><span class="line">    dispatch_semaphore_signal(_lock);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">setter</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (_YYWebImageSetter *)lazySetterForState:(<span class="built_in">NSNumber</span> *)state &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//同理</span></span><br><span class="line">    dispatch_semaphore_wait(_lock, DISPATCH_TIME_FOREVER);</span><br><span class="line">    _YYWebImageSetter *<span class="keyword">setter</span> = _dic[state];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">setter</span>) &#123;</span><br><span class="line">        <span class="keyword">setter</span> = [_YYWebImageSetter new];</span><br><span class="line">        _dic[state] = <span class="keyword">setter</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    dispatch_semaphore_signal(_lock);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">setter</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在读取_YYWebImageSetter该函数中使用<code>dispatch_semaphore_wait</code>和<code>dispatch_semaphore_signal</code>使当前函数为线程安全。实际上信号量就是锁，它与 <code>@synchronized</code> 函数看起来很像。所起到的作用就是至始至终只会有一个线程去访问该函数。</p>
<p>在 <a href="http://www.cnblogs.com/snailHL/p/3906112.html" target="_blank" rel="noopener">这边文章中</a>很形象的比喻了信号量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">关于信号量，一般可以用停车来比喻。</span><br><span class="line"></span><br><span class="line">　　停车场剩余4个车位，那么即使同时来了四辆车也能停的下。如果此时来了五辆车，那么就有一辆需要等待。</span><br><span class="line"></span><br><span class="line">　　信号量的值就相当于剩余车位的数目，dispatch_semaphore_wait函数就相当于来了一辆车，dispatch_semaphore_signal</span><br><span class="line"></span><br><span class="line">　　就相当于走了一辆车。停车位的剩余数目在初始化的时候就已经指明了（dispatch_semaphore_create（long value）），</span><br><span class="line"></span><br><span class="line">　　调用一次dispatch_semaphore_signal，剩余的车位就增加一个；调用一次dispatch_semaphore_wait剩余车位就减少一个；</span><br><span class="line"></span><br><span class="line">　　当剩余车位为0时，再来车（即调用dispatch_semaphore_wait）就只能等待。有可能同时有几辆车等待一个停车位。有些车主</span><br><span class="line"></span><br><span class="line">　　没有耐心，给自己设定了一段等待时间，这段时间内等不到停车位就走了，如果等到了就开进去停车。而有些车主就像把车停在这，</span><br><span class="line"></span><br><span class="line">　　所以就一直等下去。</span><br></pre></td></tr></table></figure>
<p>举个🌰   NSMutableArray不是线程安全的,我们可以稍作修饰,线程安全的去更新数组</p>
<p>　<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableArray</span> *array = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line"> dispatch_semaphore_t semphore = dispatch_semaphore_create(<span class="number">1</span>);</span><br><span class="line"> <span class="built_in">dispatch_queue_t</span> concurrentQueue = dispatch_queue_create(<span class="string">"com.lx.gcddemo"</span>,DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line">      dispatch_apply(<span class="number">100</span>, concurrentQueue, ^(size_t i) &#123;</span><br><span class="line">          dispatch_semaphore_wait(semphore, DISPATCH_TIME_FOREVER);</span><br><span class="line">          <span class="comment">/*</span></span><br><span class="line"><span class="comment">          @synchronized (array) &#123;</span></span><br><span class="line"><span class="comment">              [array addObject:[NSNumber numberWithUnsignedInteger:i]];</span></span><br><span class="line"><span class="comment">          &#125;</span></span><br><span class="line"><span class="comment">           */</span></span><br><span class="line">          [array addObject:[<span class="built_in">NSNumber</span> numberWithUnsignedInteger:i]];</span><br><span class="line">          dispatch_semaphore_signal(semphore);</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,array);</span><br></pre></td></tr></table></figure></p>
<p>　　
　　</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/14/cocoapods升级1.1.0/" itemprop="url">
                  cocoapods 更新到最新版本(1.1.0)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-14T20:45:52+08:00" content="2016-10-14">
              2016-10-14
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/其他/" itemprop="url" rel="index">
                    <span itemprop="name">其他</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          
             <span id="/2016/10/14/cocoapods升级1.1.0/" class="leancloud_visitors" data-flag-title="cocoapods 更新到最新版本(1.1.0)">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在Apple 发布swift3.0之后 一大部分著名的第三方开源库,比如Alamofire,snapKit 之后都陆续更新到swift3.0。当我们用cocoapods管理它们或者使用它们的时候都会看到这样一句话:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CocoaPods 1.1.0+ is required to build Alamofire 4.0.0+.</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CocoaPods 1.1.0+ is required to build SnapKit 3.0.0+.</span><br></pre></td></tr></table></figure>
<p>需要将cocoapods更新到1.1.0版本以上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem install cocoapods --pre //升级到最新版本</span><br></pre></td></tr></table></figure>
<p>但是会遇到权限问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR:  While executing gem ... (Errno::EPERM) Operation not permitted - /usr/bin/pod</span><br></pre></td></tr></table></figure>
<p>需要这么一句话</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gem install cocoapods --pre -n /usr/local/bin cocoa pods</span><br></pre></td></tr></table></figure>
<p>在10.11以上的系统中Apple已经启用无根的安装 stack overflow这么解释:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This is happening because Apple has enabled rootless on the new install</span><br></pre></td></tr></table></figure>
<p><a href="http://stackoverflow.com/questions/30812777/cannot-install-cocoa-pods-after-uninstalling-results-in-error/" target="_blank" rel="noopener">参考链接</a></p>
<p>查看cocoapods当前版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod --version</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.1.0.beta.2</span><br></pre></td></tr></table></figure>
<p>此时cocoapods版本就会更新到最新版本.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/10/iOS开发小技巧(一)/" itemprop="url">
                  iOS开发小技巧(一)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-10T20:44:20+08:00" content="2016-10-10">
              2016-10-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          
             <span id="/2016/10/10/iOS开发小技巧(一)/" class="leancloud_visitors" data-flag-title="iOS开发小技巧(一)">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="改变UIImagePickerController的导航条以及title的颜色"><a href="#改变UIImagePickerController的导航条以及title的颜色" class="headerlink" title="改变UIImagePickerController的导航条以及title的颜色"></a>改变UIImagePickerController的导航条以及title的颜色</h1><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)navigationController:(<span class="built_in">UINavigationController</span> *)navigationController willShowViewController:(<span class="built_in">UIViewController</span> *)viewController animated:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">   [<span class="built_in">UIApplication</span> sharedApplication].statusBarStyle = <span class="built_in">UIStatusBarStyleLightContent</span>;</span><br><span class="line">    <span class="built_in">UINavigationBar</span> *bar = [<span class="built_in">UINavigationBar</span> appearance];</span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *titleDictionary = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">    titleDictionary[<span class="built_in">NSForegroundColorAttributeName</span>] = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    [bar setTitleTextAttributes:titleDictionary];</span><br><span class="line">    viewController.navigationController.navigationBar.barTintColor = DIF_BASE_COLOR;</span><br><span class="line">    viewController.navigationController.navigationBar.tintColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="利用KVC改变TextField的占位符的颜色"><a href="#利用KVC改变TextField的占位符的颜色" class="headerlink" title="利用KVC改变TextField的占位符的颜色"></a>利用KVC改变TextField的占位符的颜色</h1><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">self</span>.nickNameTextField setValue:[<span class="built_in">UIColor</span> whiteColor] forKeyPath:<span class="string">@"_placeholderLabel.textColor"</span>];</span><br></pre></td></tr></table></figure>
<h1 id="TextView的字数限制"><a href="#TextView的字数限制" class="headerlink" title="TextView的字数限制"></a>TextView的字数限制</h1><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#define MaxNumberOfDescriptionChars  150</span></span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)textViewEditChanged:(<span class="built_in">NSNotification</span> *)obj&#123;</span><br><span class="line">    <span class="built_in">UITextView</span> *textView = (<span class="built_in">UITextView</span> *)obj.object;</span><br><span class="line">    <span class="built_in">NSString</span> *toBeString = textView.text;</span><br><span class="line">    <span class="built_in">NSString</span> *lang = [[<span class="built_in">UITextInputMode</span> currentInputMode] primaryLanguage]; <span class="comment">// 键盘输入模式</span></span><br><span class="line">    <span class="keyword">if</span> ([lang isEqualToString:<span class="string">@"zh-Hans"</span>]) &#123; <span class="comment">// 简体中文输入，包括简体拼音，健体五笔，简体手写</span></span><br><span class="line">        <span class="built_in">UITextRange</span> *selectedRange = [textView markedTextRange];</span><br><span class="line">        <span class="comment">//获取高亮部分</span></span><br><span class="line">        <span class="built_in">UITextPosition</span> *position = [textView positionFromPosition:selectedRange.start offset:<span class="number">0</span>];</span><br><span class="line">        <span class="comment">// 没有高亮选择的字，则对已输入的文字进行字数统计和限制</span></span><br><span class="line">        <span class="keyword">if</span> (!position) &#123;</span><br><span class="line">            <span class="keyword">if</span> (toBeString.length &gt; MaxNumberOfDescriptionChars) &#123;</span><br><span class="line">                textView.text = [toBeString substringToIndex:MaxNumberOfDescriptionChars];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 有高亮选择的字符串，则暂不对文字进行统计和限制</span></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 中文输入法以外的直接对其统计限制即可，不考虑其他语种情况</span></span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (toBeString.length &gt; MaxNumberOfDescriptionChars) &#123;</span><br><span class="line">            </span><br><span class="line">            textView.text = [toBeString substringToIndex:MaxNumberOfDescriptionChars];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)textView:(<span class="built_in">UITextView</span> *)textView shouldChangeTextInRange:(<span class="built_in">NSRange</span>)range replacementText:(<span class="built_in">NSString</span> *)text&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *new = [textView.text stringByReplacingCharactersInRange:range withString:text];</span><br><span class="line">    <span class="keyword">self</span>.numLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%zd字"</span>,(MaxNumberOfDescriptionChars - new.length)];</span><br><span class="line">    <span class="keyword">if</span>(new.length &gt; MaxNumberOfDescriptionChars)&#123;</span><br><span class="line">         <span class="keyword">self</span>.numLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%zd字"</span>,<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (![text isEqualToString:<span class="string">@""</span>]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="判断字符串或者集合类型是否为空"><a href="#判断字符串或者集合类型是否为空" class="headerlink" title="判断字符串或者集合类型是否为空"></a>判断字符串或者集合类型是否为空</h1><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">BOOL</span>)isEmpty:(<span class="keyword">id</span> )obj</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ([obj isKindOfClass:[<span class="built_in">NSString</span> <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(obj == <span class="literal">nil</span> || [obj <span class="keyword">class</span>] == [<span class="built_in">NSNull</span> null] || [obj isEqualToString:<span class="string">@""</span>] || [obj isEqualToString:<span class="string">@"(null)"</span>] || [obj isEqualToString:<span class="string">@"NULL"</span>] || [obj isEqualToString:<span class="string">@"&lt;null&gt;"</span>] || [obj isEqualToString:<span class="string">@"null"</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (obj == <span class="literal">nil</span> || (<span class="built_in">NSNull</span> *)obj == [<span class="built_in">NSNull</span> null] || ([obj respondsToSelector:<span class="keyword">@selector</span>(length)] &amp;&amp; [obj length] == <span class="number">0</span>) || ([obj respondsToSelector:<span class="keyword">@selector</span>(count)] &amp;&amp; [obj count] == <span class="number">0</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="给UIResponder添加indexPath属性"><a href="#给UIResponder添加indexPath属性" class="headerlink" title="给UIResponder添加indexPath属性"></a>给UIResponder添加indexPath属性</h1><h2 id="列如在cell中有button-imageview-可以利用该属性找到cell中改该视图"><a href="#列如在cell中有button-imageview-可以利用该属性找到cell中改该视图" class="headerlink" title="列如在cell中有button imageview 可以利用该属性找到cell中改该视图"></a>列如在cell中有button imageview 可以利用该属性找到cell中改该视图</h2><h3 id="objective-C"><a href="#objective-C" class="headerlink" title="objective - C"></a>objective - C</h3><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UIResponder</span> (<span class="title">Externtion</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSIndexPath</span> *indexPath;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, <span class="keyword">@selector</span>(indexPath), indexPath, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSIndexPath</span> *)indexPath&#123;</span><br><span class="line">    <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, <span class="keyword">@selector</span>(indexPath));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="swift"><a href="#swift" class="headerlink" title="swift"></a>swift</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIResponder</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">   <span class="keyword">private</span> <span class="class"><span class="keyword">struct</span> <span class="title">AssociatedKey</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> <span class="type">AssociatedName</span> = <span class="string">"AssociatedName"</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> indexPath: <span class="type">NSIndexPath</span>?&#123;</span><br><span class="line">        <span class="keyword">get</span>&#123;</span><br><span class="line">           <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, &amp;<span class="type">AssociatedKey</span>.<span class="type">AssociatedName</span>) <span class="keyword">as</span>? <span class="type">NSIndexPath</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">set</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> newValue = newValue &#123;</span><br><span class="line">                objc_setAssociatedObject(<span class="keyword">self</span>, &amp;<span class="type">AssociatedKey</span>.<span class="type">AssociatedName</span>, newValue <span class="keyword">as</span> <span class="type">NSIndexPath</span> , .<span class="type">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="UIRefreshControl"><a href="#UIRefreshControl" class="headerlink" title="UIRefreshControl"></a>UIRefreshControl</h1><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> refresh = <span class="type">UIRefreshControl</span>.<span class="keyword">init</span>()</span><br><span class="line">        refresh.tintColor = <span class="type">UIColor</span>.red</span><br><span class="line">        refresh.attributedTitle = <span class="type">NSAttributedString</span>.<span class="keyword">init</span>(string: <span class="string">"正在加载"</span>)</span><br><span class="line">        refresh.addTarget(<span class="keyword">self</span>, action: #selector(<span class="type">ViewController</span>.refreshTabeleView(sender:)), <span class="keyword">for</span>: <span class="type">UIControlEvents</span>.valueChanged)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        tableView.refreshControl = refresh</span><br><span class="line">        tableView.addSubview(refresh)</span><br><span class="line">        tableView.reloadData()</span><br></pre></td></tr></table></figure>
<h1 id="将HTML字符串转化为NSAttributedString富文本字符串"><a href="#将HTML字符串转化为NSAttributedString富文本字符串" class="headerlink" title="将HTML字符串转化为NSAttributedString富文本字符串"></a>将HTML字符串转化为NSAttributedString富文本字符串</h1><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSAttributedString</span> *)attributedStringWithHTMLString:(<span class="built_in">NSString</span> *)htmlString</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSDictionary</span> *options = @&#123; <span class="built_in">NSDocumentTypeDocumentAttribute</span> : <span class="built_in">NSHTMLTextDocumentType</span>,</span><br><span class="line">                               <span class="built_in">NSCharacterEncodingDocumentAttribute</span> :@(<span class="built_in">NSUTF8StringEncoding</span>) &#125;;</span><br><span class="line">   </span><br><span class="line">    <span class="built_in">NSData</span> *data = [htmlString dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">return</span> [[<span class="built_in">NSAttributedString</span> alloc] initWithData:data options:options documentAttributes:<span class="literal">nil</span> error:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="CABasicAnimation（CAKeyframeAnimation）key-path-取值"><a href="#CABasicAnimation（CAKeyframeAnimation）key-path-取值" class="headerlink" title="CABasicAnimation（CAKeyframeAnimation）key path 取值"></a>CABasicAnimation（CAKeyframeAnimation）key path 取值</h1><h2 id="keyPath可以使用的key"><a href="#keyPath可以使用的key" class="headerlink" title="keyPath可以使用的key"></a>keyPath可以使用的key</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">- define angle2Radian(angle) ((angle)/180.0*M_PI)</span><br><span class="line"></span><br><span class="line">transform.rotation.x 围绕x轴翻转 参数：角度 angle2Radian(4)</span><br><span class="line"></span><br><span class="line">transform.rotation.y 围绕y轴翻转 参数：同上</span><br><span class="line"></span><br><span class="line">transform.rotation.z 围绕z轴翻转 参数：同上</span><br><span class="line"></span><br><span class="line">transform.rotation 默认围绕z轴</span><br><span class="line"></span><br><span class="line">transform.scale.x x方向缩放 参数：缩放比例 1.5</span><br><span class="line"></span><br><span class="line">transform.scale.y y方向缩放 参数：同上</span><br><span class="line"></span><br><span class="line">transform.scale.z z方向缩放 参数：同上</span><br><span class="line"></span><br><span class="line">transform.scale 所有方向缩放 参数：同上</span><br><span class="line"></span><br><span class="line">transform.translation.x x方向移动 参数：x轴上的坐标 100</span><br><span class="line"></span><br><span class="line">transform.translation.y x方向移动 参数：y轴上的坐标</span><br><span class="line"></span><br><span class="line">transform.translation.z x方向移动 参数：z轴上的坐标</span><br><span class="line"></span><br><span class="line">transform.translation 移动 参数：移动到的点 （100，100）</span><br><span class="line"></span><br><span class="line">opacity 透明度 参数：透明度 0.5</span><br><span class="line"></span><br><span class="line">backgroundColor 背景颜色 参数：颜色 (id)[[UIColor redColor] CGColor]</span><br><span class="line"></span><br><span class="line">cornerRadius 圆角 参数：圆角半径 5</span><br><span class="line"></span><br><span class="line">borderWidth 边框宽度 参数：边框宽度 5</span><br><span class="line"></span><br><span class="line">bounds 大小 参数：CGRect</span><br><span class="line"></span><br><span class="line">contents 内容 参数：CGImage</span><br><span class="line"></span><br><span class="line">contentsRect 可视内容 参数：CGRect 值是0～1之间的小数</span><br><span class="line"></span><br><span class="line">hidden 是否隐藏</span><br><span class="line"></span><br><span class="line">position</span><br><span class="line"></span><br><span class="line">shadowColor</span><br><span class="line"></span><br><span class="line">shadowOffset</span><br><span class="line"></span><br><span class="line">shadowOpacity</span><br><span class="line"></span><br><span class="line">shadowRadius</span><br></pre></td></tr></table></figure>
<h1 id="隐藏导航条和tabBar的直线"><a href="#隐藏导航条和tabBar的直线" class="headerlink" title="隐藏导航条和tabBar的直线"></a>隐藏导航条和tabBar的直线</h1><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UINavigationBar</span> *bar = [<span class="built_in">UINavigationBar</span> appearance];</span><br><span class="line">bar.shadowImage = [<span class="built_in">UIImage</span> new];</span><br><span class="line">[bar setBackgroundImage:[<span class="built_in">UIImage</span> new] forBarMetrics:<span class="built_in">UIBarMetricsDefault</span>];</span><br></pre></td></tr></table></figure>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UITabBar</span> *tabBar = [<span class="built_in">UITabBar</span> appearance];</span><br><span class="line">tabBar.shadowImage = [<span class="built_in">UIImage</span> new];</span><br><span class="line">tabBar.backgroundImage = [<span class="built_in">UIImage</span> new];</span><br></pre></td></tr></table></figure>
<h1 id="全屏手势返回"><a href="#全屏手势返回" class="headerlink" title="全屏手势返回"></a>全屏手势返回</h1><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIPanGestureRecognizer</span> *pan = [[<span class="built_in">UIPanGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span>.interactivePopGestureRecognizer.delegate action:<span class="keyword">@selector</span>(handleNavigationTransition:)];</span><br><span class="line">pan.delegate = <span class="keyword">self</span>;</span><br><span class="line">[<span class="keyword">self</span>.view addGestureRecognizer:pan];</span><br></pre></td></tr></table></figure>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)gestureRecognizer:(<span class="built_in">UIGestureRecognizer</span> *)gestureRecognizer shouldReceiveTouch:(<span class="built_in">UITouch</span> *)touch</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.childViewControllers.count &gt; <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="UITextView的placeholder"><a href="#UITextView的placeholder" class="headerlink" title="UITextView的placeholder"></a>UITextView的placeholder</h1><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)textViewDidBeginEditing:(<span class="built_in">UITextView</span> *)textView &#123;</span><br><span class="line">    [<span class="keyword">self</span> resetTextViewPlaceholderWithText:textView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)textViewDidEndEditing:(<span class="built_in">UITextView</span> *)textView &#123;</span><br><span class="line">    [<span class="keyword">self</span> resetTextViewPlaceholderWithText:textView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)resetTextViewPlaceholderWithText:(<span class="built_in">UITextView</span> *)textView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ([textView.text isEqualToString:<span class="string">@"要显示的placeholder"</span>]) &#123;</span><br><span class="line">        textView.text = <span class="string">@""</span>;</span><br><span class="line">        textView.textColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (textView.text.length &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        textView.text = <span class="string">@"要显示的placeholder"</span>;</span><br><span class="line">        textView.textColor = [<span class="built_in">UIColor</span> colorWithRed:<span class="number">0.87</span> green:<span class="number">0.87</span> blue:<span class="number">0.87</span> alpha:<span class="number">1.00</span>];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="让应用支持摇一摇"><a href="#让应用支持摇一摇" class="headerlink" title="让应用支持摇一摇"></a>让应用支持摇一摇</h1><ul>
<li>开启摇一摇权限</li>
</ul>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">UIApplication</span> sharedApplication].applicationSupportsShakeToEdit = <span class="literal">YES</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>让view/viewcontroller成为第一响应者</li>
</ul>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - UIResponder</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)canBecomeFirstResponder &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>实现方发</li>
</ul>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - 摇动</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  摇动开始</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)motionBegan:(<span class="built_in">UIEventSubtype</span>)motion withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="keyword">if</span> (motion == <span class="built_in">UIEventSubtypeMotionShake</span>) &#123;</span><br><span class="line">    <span class="comment">// do some thing</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  摇动结束</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)motionEnded:(<span class="built_in">UIEventSubtype</span>)motion withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  摇动取消</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)motionCancelled:(<span class="built_in">UIEventSubtype</span>)motion withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="HeaderView随tableview一起滑动"><a href="#HeaderView随tableview一起滑动" class="headerlink" title="HeaderView随tableview一起滑动"></a>HeaderView随tableview一起滑动</h1><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)scrollViewDidScroll:(<span class="built_in">UIScrollView</span> *)scrollView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (scrollView == <span class="keyword">self</span>.tableView) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">CGFloat</span> headerHeight = DIF_SCREEN_HEIGHT / <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">if</span> (scrollView.contentOffset.y &lt;= headerHeight &amp;&amp; scrollView.contentOffset.y &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            scrollView.contentInset = <span class="built_in">UIEdgeInsetsMake</span>(-scrollView.contentOffset.y, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (scrollView.contentOffset.y &gt;= headerHeight)&#123;</span><br><span class="line">            scrollView.contentInset = <span class="built_in">UIEdgeInsetsMake</span>(-headerHeight, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.png"
               alt="Hello Li" />
          <p class="site-author-name" itemprop="name">Hello Li</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">15</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/sunshineLixun" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hello Li</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("2i0jddK6AkBmJ3LyGqEbNhfO-gzGzoHsz", "j7dHuehi8Wf97HyMAU4tQb7a");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

</body>
</html>
