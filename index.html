<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="做一个有文艺气息的程序猿">
<meta property="og:type" content="website">
<meta property="og:title" content="Sunshine">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Sunshine">
<meta property="og:description" content="做一个有文艺气息的程序猿">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sunshine">
<meta name="twitter:description" content="做一个有文艺气息的程序猿">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/"/>

  <title> Sunshine </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Sunshine</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">lx的个人博客</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/17/OC代码规范总结/" itemprop="url">
                  OC代码规范总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-02-17T15:18:08+08:00" content="2017-02-17">
              2017-02-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Other/" itemprop="url" rel="index">
                    <span itemprop="name">Other</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Objective-C-Coding-Guidelines-In-Chinese"><a href="#Objective-C-Coding-Guidelines-In-Chinese" class="headerlink" title="Objective-C-Coding-Guidelines-In-Chinese"></a>Objective-C-Coding-Guidelines-In-Chinese</h1><p>Objective-C编码规范，内容来自苹果、谷歌的文档翻译，<a href="https://github.com/boai" target="_blank" rel="external">『博爱』</a>的编码经验和对其它资料的总结。<br>详情可前往：开源项目<a href="https://github.com/boai/BABaseProject" target="_blank" rel="external">『BABaseProject』</a>！</p>
<p>转载请注明出处。 </p>
<h1 id="本篇为转载文章（供自己学习-查阅）"><a href="#本篇为转载文章（供自己学习-查阅）" class="headerlink" title="本篇为转载文章（供自己学习/查阅）"></a>本篇为转载文章（供自己学习/查阅）</h1><h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>Objective-C是一门面向对象的动态编程语言，主要用于编写iOS和Mac应用程序。关于Objective-C的编码规范，苹果和谷歌都已经有很好的总结：</p>
<ul>
<li><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/CodingGuidelines/CodingGuidelines.html" target="_blank" rel="external">Apple Coding Guidelines for Cocoa</a></li>
<li><a href="https://google-styleguide.googlecode.com/svn/trunk/objcguide.xml?showone=Line_Length#Line_Length" target="_blank" rel="external">Google Objective-C Style Guide</a></li>
</ul>
<p>本文主要整合了对上述文档的翻译、作者自己的编程经验和其他的相关资料，为公司总结出一份通用的编码规范。</p>
<h2 id="代码格式"><a href="#代码格式" class="headerlink" title="代码格式"></a>代码格式</h2><h3 id="使用空格而不是制表符Tab"><a href="#使用空格而不是制表符Tab" class="headerlink" title="使用空格而不是制表符Tab"></a>使用空格而不是制表符Tab</h3><p>不要在工程里使用Tab键，使用空格来进行缩进。在<code>Xcode &gt; Preferences &gt; Text Editing</code>将Tab和自动缩进都设置为<strong>4</strong>个空格。（<em>Google的标准是使用两个空格来缩进，但这里还是推荐使用Xcode默认的设置。</em>）</p>
<h3 id="每一行的最大长度"><a href="#每一行的最大长度" class="headerlink" title="每一行的最大长度"></a>每一行的最大长度</h3><p>同样的，在<code>Xcode &gt; Preferences &gt; Text Editing &gt; Page guide at column:</code>中将最大行长设置为<strong>80</strong>，过长的一行代码将会导致可读性问题。</p>
<h3 id="函数的书写"><a href="#函数的书写" class="headerlink" title="函数的书写"></a>函数的书写</h3><p>一个典型的Objective-C函数应该是这样的：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)writeVideoFrameWithData:(<span class="built_in">NSData</span> *)frameData timeStamp:(<span class="keyword">int</span>)timeStamp &#123;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在<code>-</code>和<code>(void)</code>之间应该有一个空格，第一个大括号<code>{</code>的位置在函数所在行的末尾，同样应该有一个空格。（<em>我司的C语言规范要求是第一个大括号单独占一行，但考虑到OC较长的函数名和苹果SDK代码的风格，还是将大括号放在行末。</em>）</p>
<p>如果一个函数有特别多的参数或者名称很长，应该将其按照<code>:</code>来对齐分行显示：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">id</span>)initWithModel:(IPCModle)model</div><div class="line">       ConnectType:(IPCConnectType)connectType</div><div class="line">        Resolution:(IPCResolution)resolution</div><div class="line">          AuthName:(<span class="built_in">NSString</span> *)authName</div><div class="line">          Password:(<span class="built_in">NSString</span> *)password</div><div class="line">               MAC:(<span class="built_in">NSString</span> *)mac</div><div class="line">              AzIp:(<span class="built_in">NSString</span> *)az_ip</div><div class="line">             AzDns:(<span class="built_in">NSString</span> *)az_dns</div><div class="line">             Token:(<span class="built_in">NSString</span> *)token</div><div class="line">             Email:(<span class="built_in">NSString</span> *)email</div><div class="line">          Delegate:(<span class="keyword">id</span>&lt;IPCConnectHandlerDelegate&gt;)delegate;</div></pre></td></tr></table></figure>
<p>在分行时，如果第一段名称过短，后续名称可以以Tab的长度（4个空格）为单位进行缩进：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)<span class="keyword">short</span>:(GTMFoo *)theFoo</div><div class="line">        longKeyword:(<span class="built_in">NSRect</span>)theRect</div><div class="line">  evenLongerKeyword:(<span class="keyword">float</span>)theInterval</div><div class="line">              error:(<span class="built_in">NSError</span> **)theError &#123;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="函数调用"><a href="#函数调用" class="headerlink" title="函数调用"></a>函数调用</h3><p>函数调用的格式和书写差不多，可以按照函数的长短来选择写在一行或者分成多行：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//写在一行</span></div><div class="line">[myObject doFooWith:arg1 name:arg2 error:arg3];</div><div class="line"></div><div class="line"><span class="comment">//分行写，按照':'对齐</span></div><div class="line">[myObject doFooWith:arg1</div><div class="line">               name:arg2</div><div class="line">              error:arg3];</div><div class="line"></div><div class="line"><span class="comment">//第一段名称过短的话后续可以进行缩进</span></div><div class="line">[myObj <span class="keyword">short</span>:arg1</div><div class="line">          longKeyword:arg2</div><div class="line">    evenLongerKeyword:arg3</div><div class="line">                error:arg4];</div></pre></td></tr></table></figure>
<p>以下写法是错误的：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//错误，要么写在一行，要么全部分行</span></div><div class="line">[myObject doFooWith:arg1 name:arg2</div><div class="line">              error:arg3];</div><div class="line">[myObject doFooWith:arg1</div><div class="line">               name:arg2 error:arg3];</div><div class="line"></div><div class="line"><span class="comment">//错误，按照':'来对齐，而不是关键字</span></div><div class="line">[myObject doFooWith:arg1</div><div class="line">          name:arg2</div><div class="line">          error:arg3];</div></pre></td></tr></table></figure>
<h3 id="public和-private标记符"><a href="#public和-private标记符" class="headerlink" title="@public和@private标记符"></a>@public和@private标记符</h3><p>@public和@private标记符应该以<strong>一个空格</strong>来进行缩进：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyClass</span> : <span class="title">NSObject</span> </span>&#123;</div><div class="line"> <span class="keyword">@public</span></div><div class="line">  ...</div><div class="line"> <span class="keyword">@private</span></div><div class="line">  ...</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<h3 id="协议（Protocols）"><a href="#协议（Protocols）" class="headerlink" title="协议（Protocols）"></a>协议（Protocols）</h3><p>在书写协议的时候注意用<code>&lt;&gt;</code>括起来的协议和类型名之间是没有空格的，比如<code>IPCConnectHandler()&lt;IPCPreconnectorDelegate&gt;</code>,这个规则适用所有书写协议的地方，包括函数声明、类声明、实例变量等等：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyProtocoledClass</span> : <span class="title">NSObject</span>&lt;<span class="title">NSWindowDelegate</span>&gt; </span>&#123;</div><div class="line"> <span class="keyword">@private</span></div><div class="line">    <span class="keyword">id</span>&lt;MyFancyDelegate&gt; _delegate;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setDelegate:(<span class="keyword">id</span>&lt;MyFancyDelegate&gt;)aDelegate;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<h3 id="闭包（Blocks）"><a href="#闭包（Blocks）" class="headerlink" title="闭包（Blocks）"></a>闭包（Blocks）</h3><p>根据block的长度，有不同的书写规则：</p>
<ul>
<li>较短的block可以写在一行内。</li>
<li>如果分行显示的话，block的右括号<code>}</code>应该和调用block那行代码的第一个非空字符对齐。</li>
<li>block内的代码采用<strong>4个空格</strong>的缩进。</li>
<li>如果block过于庞大，应该单独声明成一个变量来使用。</li>
<li><code>^</code>和<code>(</code>之间，<code>^</code>和<code>{</code>之间都没有空格，参数列表的右括号<code>)</code>和<code>{</code>之间有一个空格。</li>
</ul>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//较短的block写在一行内</span></div><div class="line">[operation setCompletionBlock:^&#123; [<span class="keyword">self</span> onOperationDone]; &#125;];</div><div class="line"></div><div class="line"><span class="comment">//分行书写的block，内部使用4空格缩进</span></div><div class="line">[operation setCompletionBlock:^&#123;</div><div class="line">    [<span class="keyword">self</span>.delegate newDataAvailable];</div><div class="line">&#125;];</div><div class="line"></div><div class="line"><span class="comment">//使用C语言API调用的block遵循同样的书写规则</span></div><div class="line"><span class="built_in">dispatch_async</span>(_fileIOQueue, ^&#123;</div><div class="line">    <span class="built_in">NSString</span>* path = [<span class="keyword">self</span> sessionFilePath];</div><div class="line">    <span class="keyword">if</span> (path) &#123;</div><div class="line">      <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">//较长的block关键字可以缩进后在新行书写，注意block的右括号'&#125;'和调用block那行代码的第一个非空字符对齐</span></div><div class="line">[[SessionService sharedService]</div><div class="line">    loadWindowWithCompletionBlock:^(SessionWindow *window) &#123;</div><div class="line">        <span class="keyword">if</span> (window) &#123;</div><div class="line">          [<span class="keyword">self</span> windowDidLoad:window];</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          [<span class="keyword">self</span> errorLoadingWindow];</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line"></div><div class="line"><span class="comment">//较长的block参数列表同样可以缩进后在新行书写</span></div><div class="line">[[SessionService sharedService]</div><div class="line">    loadWindowWithCompletionBlock:</div><div class="line">        ^(SessionWindow *window) &#123;</div><div class="line">            <span class="keyword">if</span> (window) &#123;</div><div class="line">              [<span class="keyword">self</span> windowDidLoad:window];</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">              [<span class="keyword">self</span> errorLoadingWindow];</div><div class="line">            &#125;</div><div class="line">        &#125;];</div><div class="line"></div><div class="line"><span class="comment">//庞大的block应该单独定义成变量使用</span></div><div class="line"><span class="keyword">void</span> (^largeBlock)(<span class="keyword">void</span>) = ^&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;;</div><div class="line">[_operationQueue addOperationWithBlock:largeBlock];</div><div class="line"></div><div class="line"><span class="comment">//在一个调用中使用多个block，注意到他们不是像函数那样通过':'对齐的，而是同时进行了4个空格的缩进</span></div><div class="line">[myObject doSomethingWith:arg1</div><div class="line">    firstBlock:^(Foo *a) &#123;</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line">    secondBlock:^(Bar *b) &#123;</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    &#125;];</div></pre></td></tr></table></figure>
<h3 id="数据结构的语法糖"><a href="#数据结构的语法糖" class="headerlink" title="数据结构的语法糖"></a>数据结构的语法糖</h3><p>应该使用可读性更好的语法糖来构造<code>NSArray</code>，<code>NSDictionary</code>等数据结构，避免使用冗长的<code>alloc</code>,<code>init</code>方法。</p>
<p>如果构造代码写在一行，需要在括号两端留有一个空格，使得被构造的元素于与构造语法区分开来：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//正确，在语法糖的"[]"或者"&#123;&#125;"两端留有空格</span></div><div class="line"><span class="built_in">NSArray</span> *array = @[ [foo description], <span class="string">@"Another String"</span>, [bar description] ];</div><div class="line"><span class="built_in">NSDictionary</span> *dict = @&#123; <span class="built_in">NSForegroundColorAttributeName</span> : [<span class="built_in">NSColor</span> redColor] &#125;;</div><div class="line"></div><div class="line"><span class="comment">//不正确，不留有空格降低了可读性</span></div><div class="line"><span class="built_in">NSArray</span>* array = @[[foo description], [bar description]];</div><div class="line"><span class="built_in">NSDictionary</span>* dict = @&#123;<span class="built_in">NSForegroundColorAttributeName</span>: [<span class="built_in">NSColor</span> redColor]&#125;;</div></pre></td></tr></table></figure>
<p>如果构造代码不写在一行内，构造元素需要使用<strong>两个空格</strong>来进行缩进，右括号<code>]</code>或者<code>}</code>写在新的一行，并且与调用语法糖那行代码的第一个非空字符对齐：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSArray</span> *array = @[</div><div class="line">  <span class="string">@"This"</span>,</div><div class="line">  <span class="string">@"is"</span>,</div><div class="line">  <span class="string">@"an"</span>,</div><div class="line">  <span class="string">@"array"</span></div><div class="line">];</div><div class="line"></div><div class="line"><span class="built_in">NSDictionary</span> *dictionary = @&#123;</div><div class="line">  <span class="built_in">NSFontAttributeName</span> : [<span class="built_in">NSFont</span> fontWithName:<span class="string">@"Helvetica-Bold"</span> size:<span class="number">12</span>],</div><div class="line">  <span class="built_in">NSForegroundColorAttributeName</span> : fontColor</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>构造字典时，字典的Key和Value与中间的冒号<code>:</code>都要留有一个空格，多行书写时，也可以将Value对齐：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//正确，冒号':'前后留有一个空格</span></div><div class="line"><span class="built_in">NSDictionary</span> *option1 = @&#123;</div><div class="line">  <span class="built_in">NSFontAttributeName</span> : [<span class="built_in">NSFont</span> fontWithName:<span class="string">@"Helvetica-Bold"</span> size:<span class="number">12</span>],</div><div class="line">  <span class="built_in">NSForegroundColorAttributeName</span> : fontColor</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//正确，按照Value来对齐</span></div><div class="line"><span class="built_in">NSDictionary</span> *option2 = @&#123;</div><div class="line">  <span class="built_in">NSFontAttributeName</span> :            [<span class="built_in">NSFont</span> fontWithName:<span class="string">@"Arial"</span> size:<span class="number">12</span>],</div><div class="line">  <span class="built_in">NSForegroundColorAttributeName</span> : fontColor</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//错误，冒号前应该有一个空格</span></div><div class="line"><span class="built_in">NSDictionary</span> *wrong = @&#123;</div><div class="line">  AKey:       <span class="string">@"b"</span>,</div><div class="line">  BLongerKey: <span class="string">@"c"</span>,</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//错误，每一个元素要么单独成为一行，要么全部写在一行内</span></div><div class="line"><span class="built_in">NSDictionary</span> *alsoWrong= @&#123; AKey : <span class="string">@"a"</span>,</div><div class="line">                            BLongerKey : <span class="string">@"b"</span> &#125;;</div><div class="line"></div><div class="line"><span class="comment">//错误，在冒号前只能有一个空格，冒号后才可以考虑按照Value对齐</span></div><div class="line"><span class="built_in">NSDictionary</span> *stillWrong = @&#123;</div><div class="line">  AKey       : <span class="string">@"b"</span>,</div><div class="line">  BLongerKey : <span class="string">@"c"</span>,</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="命名规范"><a href="#命名规范" class="headerlink" title="命名规范"></a>命名规范</h2><h3 id="基本原则"><a href="#基本原则" class="headerlink" title="基本原则"></a>基本原则</h3><h4 id="清晰"><a href="#清晰" class="headerlink" title="清晰"></a>清晰</h4><p>命名应该尽可能的清晰和简洁，但在Objective-C中，清晰比简洁更重要。由于Xcode强大的自动补全功能，我们不必担心名称过长的问题。</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//清晰</span></div><div class="line">insertObject:atIndex:</div><div class="line"></div><div class="line"><span class="comment">//不清晰，insert的对象类型和at的位置属性没有说明</span></div><div class="line">insert:at:</div><div class="line"></div><div class="line"><span class="comment">//清晰</span></div><div class="line">removeObjectAtIndex:</div><div class="line"></div><div class="line"><span class="comment">//不清晰，remove的对象类型没有说明，参数的作用没有说明</span></div><div class="line">remove:</div></pre></td></tr></table></figure>
<p>不要使用单词的简写，拼写出完整的单词：<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//清晰</span></div><div class="line">destinationSelection</div><div class="line">setBackgroundColor:</div><div class="line"></div><div class="line"><span class="comment">//不清晰，不要使用简写</span></div><div class="line">destSel</div><div class="line">setBkgdColor:</div></pre></td></tr></table></figure></p>
<p>然而，有部分单词简写在Objective-C编码过程中是非常常用的，以至于成为了一种规范，这些简写可以在代码中直接使用，下面列举了部分：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">alloc   == Allocate					max    == Maximum</div><div class="line">alt     == Alternate				min    == Minimum</div><div class="line">app     == Application				msg    == Message</div><div class="line">calc    == Calculate				nib    == Interface Builder archive</div><div class="line">dealloc == Deallocate				pboard == Pasteboard</div><div class="line">func    == Function					rect   == Rectangle</div><div class="line">horiz   == Horizontal				Rep    == Representation (used <span class="keyword">in</span> <span class="keyword">class</span> name such as <span class="built_in">NSBitmapImageRep</span>).</div><div class="line">info    == Information				temp   == Temporary</div><div class="line">init    == Initialize				vert   == Vertical</div><div class="line"><span class="keyword">int</span>     == Integer</div></pre></td></tr></table></figure>
<p>命名方法或者函数时要避免歧义</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//有歧义，是返回sendPort还是send一个Port？</span></div><div class="line">sendPort</div><div class="line"></div><div class="line"><span class="comment">//有歧义，是返回一个名字属性的值还是display一个name的动作？</span></div><div class="line">displayName</div></pre></td></tr></table></figure>
<h4 id="一致性"><a href="#一致性" class="headerlink" title="一致性"></a>一致性</h4><p>整个工程的命名风格要保持一致性，最好和苹果SDK的代码保持统一。不同类中完成相似功能的方法应该叫一样的名字，比如我们总是用<code>count</code>来返回集合的个数，不能在A类中使用<code>count</code>而在B类中使用<code>getNumber</code>。</p>
<h3 id="使用前缀"><a href="#使用前缀" class="headerlink" title="使用前缀"></a>使用前缀</h3><p>如果代码需要打包成Framework给别的工程使用，或者工程项目非常庞大，需要拆分成不同的模块，使用命名前缀是非常有用的。</p>
<ul>
<li><p>前缀由大写的字母缩写组成，比如Cocoa中<code>NS</code>前缀代表Founation框架中的类，<code>IB</code>则代表Interface Builder框架。</p>
</li>
<li><p>可以在为类、协议、函数、常量以及typedef宏命名的时候使用前缀，但注意<strong>不要</strong>为成员变量或者方法使用前缀，因为他们本身就包含在类的命名空间内。</p>
</li>
<li><p>命名前缀的时候不要和苹果SDK框架冲突。</p>
</li>
</ul>
<h3 id="命名类和协议（Class-amp-Protocol）"><a href="#命名类和协议（Class-amp-Protocol）" class="headerlink" title="命名类和协议（Class&amp;Protocol）"></a>命名类和协议（Class&amp;Protocol）</h3><p>类名以大写字母开头，应该包含一个<em>名词</em>来表示它代表的对象类型，同时可以加上必要的前缀，比如<code>NSString</code>, <code>NSDate</code>, <code>NSScanner</code>, <code>NSApplication</code>等等。</p>
<p>而协议名称应该清晰地表示它所执行的行为，而且要和类名区别开来，所以通常使用<code>ing</code>词尾来命名一个协议，比如<code>NSCopying</code>,<code>NSLocking</code>。</p>
<p>有些协议本身包含了很多不相关的功能，主要用来为某一特定类服务，这时候可以直接用类名来命名这个协议，比如<code>NSObject</code>协议，它包含了id对象在生存周期内的一系列方法。</p>
<h3 id="命名头文件（Headers）"><a href="#命名头文件（Headers）" class="headerlink" title="命名头文件（Headers）"></a>命名头文件（Headers）</h3><p>源码的头文件名应该清晰地暗示它的功能和包含的内容：</p>
<ul>
<li><p>如果头文件内只定义了单个类或者协议，直接用类名或者协议名来命名头文件，比如<code>NSLocale.h</code>定义了<code>NSLocale</code>类。</p>
</li>
<li><p>如果头文件内定义了一系列的类、协议、类别，使用其中最主要的类名来命名头文件，比如<code>NSString.h</code>定义了<code>NSString</code>和<code>NSMutableString</code>。</p>
</li>
<li><p>每一个Framework都应该有一个和框架同名的头文件，包含了框架中所有公共类头文件的引用，比如<code>Foundation.h</code></p>
</li>
<li><p>Framework中有时候会实现在别的框架中类的类别扩展，这样的文件通常使用<code>被扩展的框架名</code>+<code>Additions</code>的方式来命名，比如<code>NSBundleAdditions.h</code>。</p>
</li>
</ul>
<h3 id="命名方法（Methods）"><a href="#命名方法（Methods）" class="headerlink" title="命名方法（Methods）"></a>命名方法（Methods）</h3><p>Objective-C的方法名通常都比较长，这是为了让程序有更好地可读性，按苹果的说法<em>“好的方法名应当可以以一个句子的形式朗读出来”</em>。</p>
<p>方法一般以小写字母打头，每一个后续的单词首字母大写，方法名中不应该有标点符号（<em>包括下划线</em>），有两个例外：</p>
<ul>
<li>可以用一些通用的大写字母缩写打头方法，比如<code>PDF</code>,<code>TIFF</code>等。</li>
<li>可以用带下划线的前缀来命名私有方法或者类别中的方法。</li>
</ul>
<p>如果方法表示让对象执行一个动作，使用动词打头来命名，注意不要使用<code>do</code>，<code>does</code>这种多余的关键字，动词本身的暗示就足够了：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//动词打头的方法表示让对象执行一个动作</span></div><div class="line">- (<span class="keyword">void</span>)invokeWithTarget:(<span class="keyword">id</span>)target;</div><div class="line">- (<span class="keyword">void</span>)selectTabViewItem:(<span class="built_in">NSTabViewItem</span> *)tabViewItem;</div></pre></td></tr></table></figure>
<p>如果方法是为了获取对象的一个属性值，直接用属性名称来命名这个方法，注意不要添加<code>get</code>或者其他的动词前缀：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//正确，使用属性名来命名方法</span></div><div class="line">- (<span class="built_in">NSSize</span>)cellSize;</div><div class="line"></div><div class="line"><span class="comment">//错误，添加了多余的动词前缀</span></div><div class="line">- (<span class="built_in">NSSize</span>)calcCellSize;</div><div class="line">- (<span class="built_in">NSSize</span>)getCellSize;</div></pre></td></tr></table></figure>
<p>对于有多个参数的方法，务必在每一个参数前都添加关键词，关键词应当清晰说明参数的作用：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//正确，保证每个参数都有关键词修饰</span></div><div class="line">- (<span class="keyword">void</span>)sendAction:(SEL)aSelector toObject:(<span class="keyword">id</span>)anObject forAllCells:(<span class="built_in">BOOL</span>)flag;</div><div class="line"></div><div class="line"><span class="comment">//错误，遗漏关键词</span></div><div class="line">- (<span class="keyword">void</span>)sendAction:(SEL)aSelector :(<span class="keyword">id</span>)anObject :(<span class="built_in">BOOL</span>)flag;</div><div class="line"></div><div class="line"><span class="comment">//正确</span></div><div class="line">- (<span class="keyword">id</span>)viewWithTag:(<span class="built_in">NSInteger</span>)aTag;</div><div class="line"></div><div class="line"><span class="comment">//错误，关键词的作用不清晰</span></div><div class="line">- (<span class="keyword">id</span>)taggedView:(<span class="keyword">int</span>)aTag;</div></pre></td></tr></table></figure>
<p>不要用<code>and</code>来连接两个参数，通常<code>and</code>用来表示方法执行了两个相对独立的操作（<em>从设计上来说，这时候应该拆分成两个独立的方法</em>）：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//错误，不要使用"and"来连接参数</span></div><div class="line">- (<span class="keyword">int</span>)runModalForDirectory:(<span class="built_in">NSString</span> *)path andFile:(<span class="built_in">NSString</span> *)name andTypes:(<span class="built_in">NSArray</span> *)fileTypes;</div><div class="line"></div><div class="line"><span class="comment">//正确，使用"and"来表示两个相对独立的操作</span></div><div class="line">- (<span class="built_in">BOOL</span>)openFile:(<span class="built_in">NSString</span> *)fullPath withApplication:(<span class="built_in">NSString</span> *)appName andDeactivate:(<span class="built_in">BOOL</span>)flag;</div></pre></td></tr></table></figure>
<p>方法的参数命名也有一些需要注意的地方:</p>
<ul>
<li>和方法名类似，参数的第一个字母小写，后面的每一个单词首字母大写</li>
<li>不要再方法名中使用类似<code>pointer</code>,<code>ptr</code>这样的字眼去表示指针，参数本身的类型足以说明</li>
<li>不要使用只有一两个字母的参数名</li>
<li>不要使用简写，拼出完整的单词</li>
</ul>
<p>下面列举了一些常用参数名：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">...action:(SEL)aSelector</div><div class="line">...alignment:(<span class="keyword">int</span>)mode</div><div class="line">...atIndex:(<span class="keyword">int</span>)index</div><div class="line">...content:(<span class="built_in">NSRect</span>)aRect</div><div class="line">...doubleValue:(<span class="keyword">double</span>)aDouble</div><div class="line">...floatValue:(<span class="keyword">float</span>)aFloat</div><div class="line">...font:(<span class="built_in">NSFont</span> *)fontObj</div><div class="line">...frame:(<span class="built_in">NSRect</span>)frameRect</div><div class="line">...intValue:(<span class="keyword">int</span>)anInt</div><div class="line">...keyEquivalent:(<span class="built_in">NSString</span> *)charCode</div><div class="line">...length:(<span class="keyword">int</span>)numBytes</div><div class="line">...point:(<span class="built_in">NSPoint</span>)aPoint</div><div class="line">...stringValue:(<span class="built_in">NSString</span> *)aString</div><div class="line">...tag:(<span class="keyword">int</span>)anInt</div><div class="line">...target:(<span class="keyword">id</span>)anObject</div><div class="line">...title:(<span class="built_in">NSString</span> *)aString</div></pre></td></tr></table></figure>
<h3 id="存取方法（Accessor-Methods）"><a href="#存取方法（Accessor-Methods）" class="headerlink" title="存取方法（Accessor Methods）"></a>存取方法（Accessor Methods）</h3><p>存取方法是指用来获取和设置类属性值的方法，属性的不同类型，对应着不同的存取方法规范：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//属性是一个名词时的存取方法范式</span></div><div class="line">- (type)noun;</div><div class="line">- (<span class="keyword">void</span>)setNoun:(type)aNoun;</div><div class="line"><span class="comment">//栗子</span></div><div class="line">- (<span class="built_in">NSString</span> *)title;</div><div class="line">- (<span class="keyword">void</span>)setTitle:(<span class="built_in">NSString</span> *)aTitle;</div><div class="line"></div><div class="line"><span class="comment">//属性是一个形容词时存取方法的范式</span></div><div class="line">- (<span class="built_in">BOOL</span>)isAdjective;</div><div class="line">- (<span class="keyword">void</span>)setAdjective:(<span class="built_in">BOOL</span>)flag;</div><div class="line"><span class="comment">//栗子</span></div><div class="line">- (<span class="built_in">BOOL</span>)isEditable;</div><div class="line">- (<span class="keyword">void</span>)setEditable:(<span class="built_in">BOOL</span>)flag;</div><div class="line"></div><div class="line"><span class="comment">//属性是一个动词时存取方法的范式</span></div><div class="line">- (<span class="built_in">BOOL</span>)verbObject;</div><div class="line">- (<span class="keyword">void</span>)setVerbObject:(<span class="built_in">BOOL</span>)flag;</div><div class="line"><span class="comment">//栗子</span></div><div class="line">- (<span class="built_in">BOOL</span>)showsAlpha;</div><div class="line">- (<span class="keyword">void</span>)setShowsAlpha:(<span class="built_in">BOOL</span>)flag;</div></pre></td></tr></table></figure>
<p>命名存取方法时不要将动词转化为被动形式来使用：<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//正确</span></div><div class="line">- (<span class="keyword">void</span>)setAcceptsGlyphInfo:(<span class="built_in">BOOL</span>)flag;</div><div class="line">- (<span class="built_in">BOOL</span>)acceptsGlyphInfo;</div><div class="line"></div><div class="line"><span class="comment">//错误，不要使用动词的被动形式</span></div><div class="line">- (<span class="keyword">void</span>)setGlyphInfoAccepted:(<span class="built_in">BOOL</span>)flag;</div><div class="line">- (<span class="built_in">BOOL</span>)glyphInfoAccepted;</div></pre></td></tr></table></figure></p>
<p>可以使用<code>can</code>,<code>should</code>,<code>will</code>等词来协助表达存取方法的意思，但不要使用<code>do</code>,和<code>does</code>：<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//正确</span></div><div class="line">- (<span class="keyword">void</span>)setCanHide:(<span class="built_in">BOOL</span>)flag;</div><div class="line">- (<span class="built_in">BOOL</span>)canHide;</div><div class="line">- (<span class="keyword">void</span>)setShouldCloseDocument:(<span class="built_in">BOOL</span>)flag;</div><div class="line">- (<span class="built_in">BOOL</span>)shouldCloseDocument;</div><div class="line"></div><div class="line"><span class="comment">//错误，不要使用"do"或者"does"</span></div><div class="line">- (<span class="keyword">void</span>)setDoesAcceptGlyphInfo:(<span class="built_in">BOOL</span>)flag;</div><div class="line">- (<span class="built_in">BOOL</span>)doesAcceptGlyphInfo;</div></pre></td></tr></table></figure></p>
<p>为什么Objective-C中不适用<code>get</code>前缀来表示属性获取方法？因为<code>get</code>在Objective-C中通常只用来表示从函数指针返回值的函数：<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//三个参数都是作为函数的返回值来使用的，这样的函数名可以使用"get"前缀</span></div><div class="line">- (<span class="keyword">void</span>)getLineDash:(<span class="keyword">float</span> *)pattern count:(<span class="keyword">int</span> *)count phase:(<span class="keyword">float</span> *)phase;</div></pre></td></tr></table></figure></p>
<h3 id="命名委托（Delegate）"><a href="#命名委托（Delegate）" class="headerlink" title="命名委托（Delegate）"></a>命名委托（Delegate）</h3><p>当特定的事件发生时，对象会触发它注册的委托方法。委托是Objective-C中常用的传递消息的方式。委托有它固定的命名范式。</p>
<p>一个委托方法的第一个参数是触发它的对象，第一个关键词是触发对象的类名，除非委托方法只有一个名为<code>sender</code>的参数：<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//第一个关键词为触发委托的类名</span></div><div class="line">- (<span class="built_in">BOOL</span>)tableView:(<span class="built_in">NSTableView</span> *)tableView shouldSelectRow:(<span class="keyword">int</span>)row;</div><div class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">NSApplication</span> *)sender openFile:(<span class="built_in">NSString</span> *)filename;</div><div class="line"></div><div class="line"><span class="comment">//当只有一个"sender"参数时可以省略类名</span></div><div class="line">- (<span class="built_in">BOOL</span>)applicationOpenUntitledFile:(<span class="built_in">NSApplication</span> *)sender;</div></pre></td></tr></table></figure></p>
<p>根据委托方法触发的时机和目的，使用<code>should</code>,<code>will</code>,<code>did</code>等关键词<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)browserDidScroll:(<span class="built_in">NSBrowser</span> *)sender;</div><div class="line"></div><div class="line">- (<span class="built_in">NSUndoManager</span> *)windowWillReturnUndoManager:(<span class="built_in">NSWindow</span> *)window;、</div><div class="line"></div><div class="line">- (<span class="built_in">BOOL</span>)windowShouldClose:(<span class="keyword">id</span>)sender;</div></pre></td></tr></table></figure></p>
<h3 id="集合操作类方法（Collection-Methods）"><a href="#集合操作类方法（Collection-Methods）" class="headerlink" title="集合操作类方法（Collection Methods）"></a>集合操作类方法（Collection Methods）</h3><p>有些对象管理着一系列其它对象或者元素的集合，需要使用类似“增删查改”的方法来对集合进行操作，这些方法的命名范式一般为：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//集合操作范式</span></div><div class="line">- (<span class="keyword">void</span>)addElement:(elementType)anObj;</div><div class="line">- (<span class="keyword">void</span>)removeElement:(elementType)anObj;</div><div class="line">- (<span class="built_in">NSArray</span> *)elements;</div><div class="line"></div><div class="line"><span class="comment">//栗子</span></div><div class="line">- (<span class="keyword">void</span>)addLayoutManager:(<span class="built_in">NSLayoutManager</span> *)obj;</div><div class="line">- (<span class="keyword">void</span>)removeLayoutManager:(<span class="built_in">NSLayoutManager</span> *)obj;</div><div class="line">- (<span class="built_in">NSArray</span> *)layoutManagers;</div></pre></td></tr></table></figure>
<p>注意，如果返回的集合是无序的，使用<code>NSSet</code>来代替<code>NSArray</code>。如果需要将元素插入到特定的位置，使用类似于这样的命名：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)insertLayoutManager:(<span class="built_in">NSLayoutManager</span> *)obj atIndex:(<span class="keyword">int</span>)index;</div><div class="line">- (<span class="keyword">void</span>)removeLayoutManagerAtIndex:(<span class="keyword">int</span>)index;</div></pre></td></tr></table></figure>
<p>如果管理的集合元素中有指向管理对象的指针，要设置成<code>weak</code>类型以防止引用循环。</p>
<p>下面是SDK中<code>NSWindow</code>类的集合操作方法：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)addChildWindow:(<span class="built_in">NSWindow</span> *)childWin ordered:(<span class="built_in">NSWindowOrderingMode</span>)place;</div><div class="line">- (<span class="keyword">void</span>)removeChildWindow:(<span class="built_in">NSWindow</span> *)childWin;</div><div class="line">- (<span class="built_in">NSArray</span> *)childWindows;</div><div class="line">- (<span class="built_in">NSWindow</span> *)parentWindow;</div><div class="line">- (<span class="keyword">void</span>)setParentWindow:(<span class="built_in">NSWindow</span> *)window;</div></pre></td></tr></table></figure>
<h3 id="命名函数（Functions）"><a href="#命名函数（Functions）" class="headerlink" title="命名函数（Functions）"></a>命名函数（Functions）</h3><p>在很多场合仍然需要用到函数，比如说如果一个对象是一个单例，那么应该使用函数来代替类方法执行相关操作。</p>
<p>函数的命名和方法有一些不同，主要是：</p>
<ul>
<li>函数名称一般带有缩写前缀，表示方法所在的框架。</li>
<li>前缀后的单词以“驼峰”表示法显示，第一个单词首字母大写。</li>
</ul>
<p>函数名的第一个单词通常是一个动词，表示方法执行的操作：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSHighlightRect</span></div><div class="line"><span class="built_in">NSDeallocateObject</span></div></pre></td></tr></table></figure>
<p>如果函数返回其参数的某个属性，省略动词：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="built_in">NSEventMaskFromType</span>(<span class="built_in">NSEventType</span> type)</div><div class="line"><span class="keyword">float</span> <span class="built_in">NSHeight</span>(<span class="built_in">NSRect</span> aRect)</div></pre></td></tr></table></figure>
<p>如果函数通过指针参数来返回值，需要在函数名中使用<code>Get</code>：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> *<span class="built_in">NSGetSizeAndAlignment</span>(<span class="keyword">const</span> <span class="keyword">char</span> *typePtr, <span class="keyword">unsigned</span> <span class="keyword">int</span> *sizep, <span class="keyword">unsigned</span> <span class="keyword">int</span> *alignp)</div></pre></td></tr></table></figure>
<p>函数的返回类型是BOOL时的命名：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">BOOL</span> <span class="built_in">NSDecimalIsNotANumber</span>(<span class="keyword">const</span> <span class="built_in">NSDecimal</span> *decimal)</div></pre></td></tr></table></figure>
<h3 id="命名属性和实例变量（Properties-amp-Instance-Variables）"><a href="#命名属性和实例变量（Properties-amp-Instance-Variables）" class="headerlink" title="命名属性和实例变量（Properties&amp;Instance Variables）"></a>命名属性和实例变量（Properties&amp;Instance Variables）</h3><p>属性和对象的存取方法相关联，属性的第一个字母小写，后续单词首字母大写，不必添加前缀。属性按功能命名成名词或者动词：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//名词属性</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>) <span class="built_in">NSString</span> *title;</div><div class="line"></div><div class="line"><span class="comment">//动词属性</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>) <span class="built_in">BOOL</span> showsAlpha;</div></pre></td></tr></table></figure>
<p>属性也可以命名成形容词，这时候通常会指定一个带有<code>is</code>前缀的get方法来提高可读性：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">getter</span>=isEditable) <span class="built_in">BOOL</span> editable;</div></pre></td></tr></table></figure>
<p>命名实例变量，在变量名前加上<code>_</code>前缀（<em>有些有历史的代码会将<code>_</code>放在后面</em>），其它和命名属性一样：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyClass</span> </span>&#123;</div><div class="line">    <span class="built_in">BOOL</span> _showsTitle;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>一般来说，类需要对使用者隐藏数据存储的细节，所以不要将实例方法定义成公共可访问的接口，可以使用<code>@private</code>，<code>@protected</code>前缀。</p>
<p><em>按苹果的说法，不建议在除了<code>init</code>和<code>dealloc</code>方法以外的地方直接访问实例变量，但很多人认为直接访问会让代码更加清晰可读，只在需要计算或者执行操作的时候才使用存取方法访问，我就是这种习惯，所以这里不作要求。</em></p>
<h3 id="命名常量（Constants）"><a href="#命名常量（Constants）" class="headerlink" title="命名常量（Constants）"></a>命名常量（Constants）</h3><p>如果要定义一组相关的常量，尽量使用枚举类型（enumerations），枚举类型的命名规则和函数的命名规则相同。<br>建议使用 <code>NS_ENUM</code> 和 <code>NS_OPTIONS</code> 宏来定义枚举类型，参见官方的 <a href="https://developer.apple.com/library/ios/releasenotes/ObjectiveC/ModernizationObjC/AdoptingModernObjective-C/AdoptingModernObjective-C.html" target="_blank" rel="external">Adopting Modern Objective-C</a> 一文：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//定义一个枚举</span></div><div class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, <span class="built_in">NSMatrixMode</span>) &#123;</div><div class="line">    <span class="built_in">NSRadioModeMatrix</span>,</div><div class="line">    <span class="built_in">NSHighlightModeMatrix</span>,</div><div class="line">    <span class="built_in">NSListModeMatrix</span>,</div><div class="line">    <span class="built_in">NSTrackModeMatrix</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>定义bit map：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="built_in">NS_OPTIONS</span>(<span class="built_in">NSUInteger</span>, <span class="built_in">NSWindowMask</span>) &#123;</div><div class="line">    <span class="built_in">NSBorderlessWindowMask</span>      = <span class="number">0</span>,</div><div class="line">    <span class="built_in">NSTitledWindowMask</span>          = <span class="number">1</span> &lt;&lt; <span class="number">0</span>,</div><div class="line">    <span class="built_in">NSClosableWindowMask</span>        = <span class="number">1</span> &lt;&lt; <span class="number">1</span>,</div><div class="line">    <span class="built_in">NSMiniaturizableWindowMask</span>  = <span class="number">1</span> &lt;&lt; <span class="number">2</span>,</div><div class="line">    <span class="built_in">NSResizableWindowMask</span>       = <span class="number">1</span> &lt;&lt; <span class="number">3</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>使用<code>const</code>定义浮点型或者单个的整数型常量，如果要定义一组相关的整数常量，应该优先使用枚举。常量的命名规范和函数相同：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> <span class="keyword">float</span> <span class="built_in">NSLightGray</span>;</div></pre></td></tr></table></figure>
<p>不要使用<code>#define</code>宏来定义常量，如果是整型常量，尽量使用枚举，浮点型常量，使用<code>const</code>定义。<code>#define</code>通常用来给编译器决定是否编译某块代码，比如常用的：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#ifdef DEBUG</span></div></pre></td></tr></table></figure>
<p>注意到一般由编译器定义的宏会在前后都有一个<code>__</code>，比如<em><code>__MACH__</code></em>。</p>
<h3 id="命名通知（Notifications）"><a href="#命名通知（Notifications）" class="headerlink" title="命名通知（Notifications）"></a>命名通知（Notifications）</h3><p>通知常用于在模块间传递消息，所以通知要尽可能地表示出发生的事件，通知的命名范式是：</p>
<pre><code>[触发通知的类名] + [Did | Will] + [动作] + Notification
</code></pre><p>栗子：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSApplicationDidBecomeActiveNotification</span></div><div class="line"><span class="built_in">NSWindowDidMiniaturizeNotification</span></div><div class="line"><span class="built_in">NSTextViewDidChangeSelectionNotification</span></div><div class="line"><span class="built_in">NSColorPanelColorDidChangeNotification</span></div></pre></td></tr></table></figure>
<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>读没有注释代码的痛苦你我都体会过，好的注释不仅能让人轻松读懂你的程序，还能提升代码的逼格。注意注释是为了让别人看懂，而不是仅仅你自己。</p>
<h3 id="文件注释"><a href="#文件注释" class="headerlink" title="文件注释"></a>文件注释</h3><p>每一个文件都<strong>必须</strong>写文件注释，文件注释通常包含</p>
<ul>
<li>文件所在模块</li>
<li>作者信息</li>
<li>历史版本信息</li>
<li>版权信息</li>
<li>文件包含的内容，作用</li>
</ul>
<p>一段良好文件注释的栗子：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*******************************************************************************</span></div><div class="line">	Copyright (C), 2011-2013, Andrew Min Chang</div><div class="line"></div><div class="line">	File name: 	AMCCommonLib.h</div><div class="line">	Author:		Andrew Chang (Zhang Min) </div><div class="line">	E-mail:		LaplaceZhang@126.com</div><div class="line">	</div><div class="line">	Description: 	</div><div class="line">			This file provide some covenient tool in calling library tools. One can easily include </div><div class="line">		library headers he wants by declaring the corresponding macros. </div><div class="line">			I hope this file is not only a header, but also a useful Linux library note.</div><div class="line">			</div><div class="line">	History:</div><div class="line">		2012-??-??: On about come date around middle of Year 2012, file created as "commonLib.h"</div><div class="line">		2012-08-20: Add shared memory library; add message queue.</div><div class="line">		2012-08-21: Add socket library (local)</div><div class="line">		2012-08-22: Add math library</div><div class="line">		2012-08-23: Add socket library (internet)</div><div class="line">		2012-08-24: Add daemon function</div><div class="line">		2012-10-10: Change file name as "AMCCommonLib.h"</div><div class="line">		2012-12-04: Add UDP support in AMC socket library</div><div class="line">		2013-01-07: Add basic data type such as "sint8_t"</div><div class="line">		2013-01-18: Add CFG_LIB_STR_NUM.</div><div class="line">		2013-01-22: Add CFG_LIB_TIMER.</div><div class="line">		2013-01-22: Remove CFG_LIB_DATA_TYPE because there is already AMCDataTypes.h</div><div class="line"></div><div class="line">	Copyright information: </div><div class="line">			This file was intended to be under GPL protocol. However, I may use this library</div><div class="line">		in my work as I am an employee. And my company may require me to keep it secret. </div><div class="line">		Therefore, this file is neither open source nor under GPL control. </div><div class="line">		</div><div class="line">********************************************************************************/</div></pre></td></tr></table></figure>
<p><em>文件注释的格式通常不作要求，能清晰易读就可以了，但在整个工程中风格要统一。</em></p>
<h3 id="代码注释"><a href="#代码注释" class="headerlink" title="代码注释"></a>代码注释</h3><p>好的代码应该是“自解释”（self-documenting）的，但仍然需要详细的注释来说明参数的意义、返回值、功能以及可能的副作用。</p>
<p>方法、函数、类、协议、类别的定义都需要注释，推荐采用Apple的标准注释风格，好处是可以在引用的地方<code>alt+点击</code>自动弹出注释，非常方便。</p>
<p>有很多可以自动生成注释格式的插件，推荐使用<a href="https://github.com/onevcat/VVDocumenter-Xcode" target="_blank" rel="external">VVDocumenter</a>：</p>
<p><img src="https://raw.github.com/onevcat/VVDocumenter-Xcode/master/ScreenShot.gif" alt="Screenshot"></p>
<p>一些良好的注释：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> *  Create a new preconnector to replace the old one with given mac address.</div><div class="line"> *  NOTICE: We DO NOT stop the old preconnector, so handle it by yourself.</div><div class="line"> *</div><div class="line"> *  @param type       Connect type the preconnector use.</div><div class="line"> *  @param macAddress Preconnector's mac address.</div><div class="line"> */</div><div class="line">- (<span class="keyword">void</span>)refreshConnectorWithConnectType:(IPCConnectType)type  Mac:(<span class="built_in">NSString</span> *)macAddress;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> *  Stop current preconnecting when application is going to background.</div><div class="line"> */</div><div class="line">-(<span class="keyword">void</span>)stopRunning;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> *  Get the COPY of cloud device with a given mac address.</div><div class="line"> *</div><div class="line"> *  @param macAddress Mac address of the device.</div><div class="line"> *</div><div class="line"> *  @return Instance of IPCCloudDevice.</div><div class="line"> */</div><div class="line">-(IPCCloudDevice *)getCloudDeviceWithMac:(<span class="built_in">NSString</span> *)macAddress;</div><div class="line"></div><div class="line"><span class="comment">// A delegate for NSApplication to handle notifications about app</span></div><div class="line"><span class="comment">// launch and shutdown. Owned by the main app controller.</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyAppDelegate</span> : <span class="title">NSObject</span> </span>&#123;</div><div class="line">  ...</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>协议、委托的注释要明确说明其被触发的条件：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** Delegate - Sent when failed to init connection, like p2p failed. */</span></div><div class="line">-(<span class="keyword">void</span>)initConnectionDidFailed:(IPCConnectHandler *)handler;</div></pre></td></tr></table></figure>
<p>如果在注释中要引用参数名或者方法函数名，使用<code>||</code>将参数或者方法括起来以避免歧义：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Sometimes we need |count| to be less than zero.</span></div><div class="line"></div><div class="line"><span class="comment">// Remember to call |StringWithoutSpaces("foo bar baz")|</span></div></pre></td></tr></table></figure>
<p><strong>定义在头文件里的接口方法、属性必须要有注释！</strong></p>
<h2 id="编码风格"><a href="#编码风格" class="headerlink" title="编码风格"></a>编码风格</h2><p>每个人都有自己的编码风格，这里总结了一些比较好的Cocoa编程风格和注意点。</p>
<h3 id="不要使用new方法"><a href="#不要使用new方法" class="headerlink" title="不要使用new方法"></a>不要使用new方法</h3><p>尽管很多时候能用<code>new</code>代替<code>alloc init</code>方法，但这可能会导致调试内存时出现不可预料的问题。Cocoa的规范就是使用<code>alloc init</code>方法，使用<code>new</code>会让一些读者困惑。</p>
<h3 id="Public-API要尽量简洁"><a href="#Public-API要尽量简洁" class="headerlink" title="Public API要尽量简洁"></a>Public API要尽量简洁</h3><p>共有接口要设计的简洁，满足核心的功能需求就可以了。不要设计很少会被用到，但是参数极其复杂的API。如果要定义复杂的方法，使用类别或者类扩展。</p>
<h3 id="import和-include"><a href="#import和-include" class="headerlink" title="#import和#include"></a>#import和#include</h3><p><code>#import</code>是Cocoa中常用的引用头文件的方式，它能自动防止重复引用文件，什么时候使用<code>#import</code>，什么时候使用<code>#include</code>呢？</p>
<ul>
<li>当引用的是一个Objective-C或者Objective-C++的头文件时，使用<code>#import</code></li>
<li>当引用的是一个C或者C++的头文件时，使用<code>#include</code>，这时必须要保证被引用的文件提供了保护域（#define guard）。</li>
</ul>
<p>栗子：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;Cocoa/Cocoa.h&gt;</span></span></div><div class="line"><span class="meta">#include <span class="meta-string">&lt;CoreFoundation/CoreFoundation.h&gt;</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">"GTMFoo.h"</span></span></div><div class="line"><span class="meta">#include <span class="meta-string">"base/basictypes.h"</span></span></div></pre></td></tr></table></figure>
<p>为什么不全部使用<code>#import</code>呢？主要是为了保证代码在不同平台间共享时不出现问题。</p>
<h3 id="引用框架的根头文件"><a href="#引用框架的根头文件" class="headerlink" title="引用框架的根头文件"></a>引用框架的根头文件</h3><p>上面提到过，每一个框架都会有一个和框架同名的头文件，它包含了框架内接口的所有引用，在使用框架的时候，应该直接引用这个根头文件，而不是其它子模块的头文件，即使是你只用到了其中的一小部分，编译器会自动完成优化的。</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//正确，引用根头文件</span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="comment">//错误，不要单独引用框架内的其它头文件</span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/NSArray.h&gt;</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/NSString.h&gt;</span></span></div></pre></td></tr></table></figure>
<h3 id="BOOL的使用"><a href="#BOOL的使用" class="headerlink" title="BOOL的使用"></a>BOOL的使用</h3><p>BOOL在Objective-C中被定义为<code>signed char</code>类型，这意味着一个BOOL类型的变量不仅仅可以表示<code>YES</code>(1)和<code>NO</code>(0)两个值，所以永远<strong>不要</strong>将BOOL类型变量直接和<code>YES</code>比较：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">BOOL great = [foo isGreat];</div><div class="line">if (great == YES)</div><div class="line">  // ...be great!</div><div class="line"></div><div class="line">//正确</div><div class="line">BOOL great = [foo isGreat];</div><div class="line">if (great)</div><div class="line">  // ...be great!</div></pre></td></tr></table></figure>
<p>同样的，也不要将其它类型的值作为BOOL来返回，这种情况下，BOOL变量只会取值的最后一个字节来赋值，这样很可能会取到0（NO）。但是，一些逻辑操作符比如<code>&amp;&amp;</code>,<code>||</code>,<code>!</code>的返回是可以直接赋给BOOL的：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//错误，不要将其它类型转化为BOOL返回</span></div><div class="line">- (<span class="built_in">BOOL</span>)isBold &#123;</div><div class="line">  <span class="keyword">return</span> [<span class="keyword">self</span> fontTraits] &amp; <span class="built_in">NSFontBoldTrait</span>;</div><div class="line">&#125;</div><div class="line">- (<span class="built_in">BOOL</span>)isValid &#123;</div><div class="line">  <span class="keyword">return</span> [<span class="keyword">self</span> stringValue];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//正确</span></div><div class="line">- (<span class="built_in">BOOL</span>)isBold &#123;</div><div class="line">  <span class="keyword">return</span> ([<span class="keyword">self</span> fontTraits] &amp; <span class="built_in">NSFontBoldTrait</span>) ? <span class="literal">YES</span> : <span class="literal">NO</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//正确，逻辑操作符可以直接转化为BOOL</span></div><div class="line">- (<span class="built_in">BOOL</span>)isValid &#123;</div><div class="line">  <span class="keyword">return</span> [<span class="keyword">self</span> stringValue] != <span class="literal">nil</span>;</div><div class="line">&#125;</div><div class="line">- (<span class="built_in">BOOL</span>)isEnabled &#123;</div><div class="line">  <span class="keyword">return</span> [<span class="keyword">self</span> isValid] &amp;&amp; [<span class="keyword">self</span> isBold];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>另外BOOL类型可以和<code>_Bool</code>,<code>bool</code>相互转化，但是<strong>不能</strong>和<code>Boolean</code>转化。</p>
<h3 id="使用ARC"><a href="#使用ARC" class="headerlink" title="使用ARC"></a>使用ARC</h3><p>除非想要兼容一些古董级的机器和操作系统，我们没有理由放弃使用ARC。在最新版的Xcode(6.2)中，ARC是自动打开的，所以直接使用就好了。</p>
<h3 id="在init和dealloc中不要用存取方法访问实例变量"><a href="#在init和dealloc中不要用存取方法访问实例变量" class="headerlink" title="在init和dealloc中不要用存取方法访问实例变量"></a>在init和dealloc中不要用存取方法访问实例变量</h3><p>当<code>init``dealloc</code>方法被执行时，类的运行时环境不是处于正常状态的，使用存取方法访问变量可能会导致不可预料的结果，因此应当在这两个方法内直接访问实例变量。</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//正确，直接访问实例变量</span></div><div class="line">- (<span class="keyword">instancetype</span>)init &#123;</div><div class="line">  <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">  <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</div><div class="line">    _bar = [[<span class="built_in">NSMutableString</span> alloc] init];</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)dealloc &#123;</div><div class="line">  [_bar release];</div><div class="line">  [<span class="keyword">super</span> dealloc];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//错误，不要通过存取方法访问</span></div><div class="line">- (<span class="keyword">instancetype</span>)init &#123;</div><div class="line">  <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">  <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</div><div class="line">    <span class="keyword">self</span>.bar = [<span class="built_in">NSMutableString</span> string];</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)dealloc &#123;</div><div class="line">  <span class="keyword">self</span>.bar = <span class="literal">nil</span>;</div><div class="line">  [<span class="keyword">super</span> dealloc];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="按照定义的顺序释放资源"><a href="#按照定义的顺序释放资源" class="headerlink" title="按照定义的顺序释放资源"></a>按照定义的顺序释放资源</h3><p>在类或者Controller的生命周期结束时，往往需要做一些扫尾工作，比如释放资源，停止线程等，这些扫尾工作的释放顺序应当与它们的初始化或者定义的顺序保持一致。这样做是为了方便调试时寻找错误，也能防止遗漏。</p>
<h3 id="保证NSString在赋值时被复制"><a href="#保证NSString在赋值时被复制" class="headerlink" title="保证NSString在赋值时被复制"></a>保证NSString在赋值时被复制</h3><p><code>NSString</code>非常常用，在它被传递或者赋值时应当保证是以复制（copy）的方式进行的，这样可以防止在不知情的情况下String的值被其它对象修改。</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (voidcsetFoo:(<span class="built_in">NSString</span> *)aFoo &#123;</div><div class="line">  _foo = [aFoo <span class="keyword">copy</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="使用NSNumber的语法糖"><a href="#使用NSNumber的语法糖" class="headerlink" title="使用NSNumber的语法糖"></a>使用NSNumber的语法糖</h3><p>使用带有<code>@</code>符号的语法糖来生成NSNumber对象能使代码更简洁：</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSNumber</span> *fortyTwo = @<span class="number">42</span>;</div><div class="line"><span class="built_in">NSNumber</span> *piOverTwo = @(M_PI / <span class="number">2</span>);</div><div class="line"><span class="keyword">enum</span> &#123;</div><div class="line">  kMyEnum = <span class="number">2</span>;</div><div class="line">&#125;;</div><div class="line"><span class="built_in">NSNumber</span> *myEnum = @(kMyEnum);</div></pre></td></tr></table></figure>
<h3 id="nil检查"><a href="#nil检查" class="headerlink" title="nil检查"></a>nil检查</h3><p>因为在Objective-C中向nil对象发送命令是不会抛出异常或者导致崩溃的，只是完全的“什么都不干”，所以，只在程序中使用nil来做逻辑上的检查。</p>
<p>另外，不要使用诸如<code>nil == Object</code>或者<code>Object == nil</code>的形式来判断。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">//正确，直接判断</div><div class="line">if (!objc) &#123;</div><div class="line">	...	</div><div class="line">&#125;</div><div class="line"></div><div class="line">//错误，不要使用nil == Object的形式</div><div class="line">if (nil == objc) &#123;</div><div class="line">	...	</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="属性的线程安全"><a href="#属性的线程安全" class="headerlink" title="属性的线程安全"></a>属性的线程安全</h3><p>定义一个属性时，编译器会自动生成线程安全的存取方法（Atomic），但这样会大大降低性能，特别是对于那些需要频繁存取的属性来说，是极大的浪费。所以如果定义的属性不需要线程保护，记得手动添加属性关键字<code>nonatomic</code>来取消编译器的优化。</p>
<h3 id="点分语法的使用"><a href="#点分语法的使用" class="headerlink" title="点分语法的使用"></a>点分语法的使用</h3><p>不要用点分语法来调用方法，只用来访问属性。这样是为了防止代码可读性问题。</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//正确，使用点分语法访问属性</span></div><div class="line"><span class="built_in">NSString</span> *oldName = myObject.name;</div><div class="line">myObject.name = <span class="string">@"Alice"</span>;</div><div class="line"></div><div class="line"><span class="comment">//错误，不要用点分语法调用方法</span></div><div class="line"><span class="built_in">NSArray</span> *array = [<span class="built_in">NSArray</span> arrayWithObject:<span class="string">@"hello"</span>];</div><div class="line"><span class="built_in">NSUInteger</span> numberOfItems = array.count;</div><div class="line">array.release;</div></pre></td></tr></table></figure>
<h3 id="Delegate要使用弱引用"><a href="#Delegate要使用弱引用" class="headerlink" title="Delegate要使用弱引用"></a>Delegate要使用弱引用</h3><p>一个类的Delegate对象通常还引用着类本身，这样很容易造成引用循环的问题，所以类的Delegate属性要设置为弱引用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/** delegate */</div><div class="line">@property (nonatomic, weak) id &lt;IPCConnectHandlerDelegate&gt; delegate;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/13/iOS界面优化系列之：处理图片缩放问题/" itemprop="url">
                  iOS界面优化系列之：处理图片缩放问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-02-13T14:56:05+08:00" content="2017-02-13">
              2017-02-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在众多阅读类的APP中，比如:<br><img src="http://upload-images.jianshu.io/upload_images/1421047-8b81cc02257ab29f.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="
![IMG_0782.PNG](http://upload-images.jianshu.io/upload_images/1421047-cefaed703108a4aa.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
"></p>
<p>这类比较稍微简单的界面中充斥着大量的的图片，多则6张,少则3-4张。再者像微博这类重型社交的APP，有的cell都已经有9张图片。图片的优化程度对整个界面的流畅度来说都是重中之重。（另外一个也很重要的地方就是文本的异步渲染），后几个系列也会说到。</p>
<p>像这种异步加载图片的开源库有很多：<code>SD_WebImageView</code>  <code>YYWebImage  Kingfisher</code>  <code>PINRemoteImage</code> …<br>开发者如果只是简单的调用一下 <code>sd_setImageWithURL:</code> 图片能够很好的显示出来。假如从网络加载的图片与自己设置的UIImageView的尺寸不一致,就会导致这种结果。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-8aeb9245ca7573ca.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20170112-131912.png"><br>如果是真机调试 打开<code>Instruments</code>中<code>Core Animation</code><br><img src="http://upload-images.jianshu.io/upload_images/1421047-66c55b53453df8db.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20170112-135233.png"><br>在右侧栏中打开<br><img src="http://upload-images.jianshu.io/upload_images/1421047-7ce789d8152d0bff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20170112-135327.png"><br>如果是模拟器，打开Debug -&gt;Color Misaligned Images</p>
<p>这个选项检查了图片是否被缩放，以及像素是否对齐。被放缩的图片会被标记为黄色，像素不对齐则会标注为紫色。**黄色、紫色越多，性能越差。</p>
<p>解决办法：<br>1.与后台协商，让后台返回的图片尺寸与客户端UIImageView尺寸一致;<br>2.自己处理。</p>
<p>下面介绍下如何自己处理</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIImage</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">resizeImage</span><span class="params">(<span class="number">_</span> image: UIImage, targetSize: CGSize)</span></span> -&gt; <span class="type">UIImage</span>? &#123;</div><div class="line">            <span class="keyword">let</span> newRect = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: targetSize.width, height: targetSize.height).integral</div><div class="line">            <span class="type">UIGraphicsBeginImageContextWithOptions</span>(targetSize, <span class="literal">false</span>, <span class="number">0</span>)</div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>() &#123;</div><div class="line">                context.interpolationQuality = .high</div><div class="line">                <span class="keyword">let</span> flipVertical = <span class="type">CGAffineTransform</span>(a: <span class="number">1</span>, b: <span class="number">0</span>, <span class="built_in">c</span>: <span class="number">0</span>, d: -<span class="number">1</span>, tx: <span class="number">0</span>, ty: targetSize.height)</div><div class="line">                context.concatenate(flipVertical)</div><div class="line">                context.draw(<span class="keyword">self</span>.cgImage!, <span class="keyword">in</span>: newRect)</div><div class="line">                <span class="keyword">let</span> newImage = <span class="type">UIImage</span>(cgImage: context.makeImage()!)</div><div class="line">                <span class="type">UIGraphicsEndImageContext</span>()</div><div class="line">               <span class="keyword">return</span> newImage</div><div class="line">            &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>很简单就是网络下载下来的图片按照自己设置的UIImageView的尺寸来重新draw一个。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">setImage</span>&lt;T: UIImageView&gt;<span class="params">(<span class="number">_</span> imageView: T, URLString: String, targetSize: CGSize)</span></span>&#123;</div><div class="line">        imageView.pin_setImage(from: <span class="type">URL</span>.<span class="keyword">init</span>(string: <span class="type">URLString</span>), completion: &#123;(<span class="type">PINRemoteImageManagerResult</span>) <span class="keyword">in</span></div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> image = <span class="type">PINRemoteImageManagerResult</span>.image&#123;</div><div class="line">                    imageView.image = image.resizeImage(image, targetSize: targetSize)</div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>重新给UIImageView设置image属性</p>
<p>重新打开Color Misaligned Images功能来检测一下<br><img src="http://upload-images.jianshu.io/upload_images/1421047-95561fdba06255d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20170112-140353.png"></p>
<p>嗯！ 不错哦，之前的黄色没有了。 本以为就达到了的要求。</p>
<p>但是用<code>Instruments</code>中<code>Time Profiler</code><br><img src="http://upload-images.jianshu.io/upload_images/1421047-0556297eefe06581.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20170112-140732.png"><br>来检测下处理该函数所需要的时间</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-758e84ae67a3697e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20170112-141255.png"></p>
<p>用Core Animation来测下FPS</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-7663f55e36043484.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20170112-142314.png"></p>
<p>虽然已经很流畅了（注：文本用到了异步绘制）,  基本在54左右， 但是距离满帧59 - 60还差那么一丢丢。</p>
<p>再来观察给UIImage扩展的这个方法 发现它是在主线程中执行，当快速滑动表格时，会有大量的图片在主线程中重新绘制。这个是造成缺失那几帧的主要原因。</p>
<p>解决办法：那就在子线程总去draw, 在主线程中去显示</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIImageView</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">drawImage</span><span class="params">(<span class="number">_</span> image: UIImage, targetSize: CGSize)</span></span> &#123;</div><div class="line">        <span class="type">DispatchQueue</span>.global().async &#123;</div><div class="line">            <span class="keyword">let</span> newRect = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: targetSize.width, height: targetSize.height).integral</div><div class="line">            <span class="type">UIGraphicsBeginImageContextWithOptions</span>(targetSize, <span class="literal">false</span>, <span class="number">0</span>)</div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>() &#123;</div><div class="line">                context.interpolationQuality = .high</div><div class="line">                <span class="keyword">let</span> flipVertical = <span class="type">CGAffineTransform</span>(a: <span class="number">1</span>, b: <span class="number">0</span>, <span class="built_in">c</span>: <span class="number">0</span>, d: -<span class="number">1</span>, tx: <span class="number">0</span>, ty: targetSize.height)</div><div class="line">                context.concatenate(flipVertical)</div><div class="line">                context.draw(image.cgImage!, <span class="keyword">in</span>: newRect)</div><div class="line">                <span class="keyword">let</span> newImage = <span class="type">UIImage</span>(cgImage: context.makeImage()!)</div><div class="line">                <span class="type">UIGraphicsEndImageContext</span>()</div><div class="line">                <span class="type">DispatchQueue</span>.main.async &#123;</div><div class="line">                    <span class="keyword">self</span>.layer.contents = newImage.cgImage</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Objective-C</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)drawImage:(<span class="built_in">UIImage</span> *)image targetSize:(<span class="built_in">CGSize</span> )size&#123;</div><div class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(QOS_CLASS_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        <span class="built_in">CGRect</span> newRect = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, size.width, size.height);</div><div class="line">        <span class="built_in">CGRectIntegral</span>(newRect);</div><div class="line">        <span class="built_in">UIGraphicsBeginImageContextWithOptions</span>(size, <span class="literal">NO</span>, [<span class="built_in">UIScreen</span> mainScreen].scale);</div><div class="line">        <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line">        <span class="built_in">CGContextSetInterpolationQuality</span>(context, kCGInterpolationHigh);</div><div class="line">        <span class="built_in">CGAffineTransform</span> transform = <span class="built_in">CGAffineTransformMake</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span>, size.height);</div><div class="line">        <span class="built_in">CGContextConcatCTM</span>(context, transform);</div><div class="line">        <span class="built_in">CGContextDrawImage</span>(context, newRect, image.CGImage);</div><div class="line">        <span class="built_in">CGImageRef</span> <span class="built_in">CGImage</span> = context ? <span class="built_in">CGBitmapContextCreateImage</span>(context) : <span class="literal">nil</span>;</div><div class="line">        <span class="built_in">UIImage</span> *newImage = <span class="built_in">CGImage</span> ? [<span class="built_in">UIImage</span> imageWithCGImage:<span class="built_in">CGImage</span>] : <span class="literal">nil</span>;</div><div class="line">        <span class="built_in">UIGraphicsEndImageContext</span>();</div><div class="line">        <span class="keyword">if</span> (<span class="built_in">CGImage</span>)&#123;</div><div class="line">            <span class="built_in">CGImageRelease</span>(<span class="built_in">CGImage</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">            <span class="keyword">if</span> (newImage) &#123;</div><div class="line">                <span class="keyword">self</span>.layer.contents = (__bridge <span class="keyword">id</span> _Nullable)(newImage.CGImage);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>该方法也很简单,在子线程中去重新draw一个UIImage,在主线程中去显示。</p>
<p>调用：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">setImage</span>&lt;T: UIImageView&gt;<span class="params">(<span class="number">_</span> imageView: T, URLString: String, targetSize: CGSize)</span></span>&#123;</div><div class="line">        imageView.pin_setImage(from: <span class="type">URL</span>.<span class="keyword">init</span>(string: <span class="type">URLString</span>), completion: &#123;(<span class="type">PINRemoteImageManagerResult</span>) <span class="keyword">in</span></div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> image = <span class="type">PINRemoteImageManagerResult</span>.image&#123;</div><div class="line">                imageView.drawImage(image, targetSize: targetSize)</div><div class="line"><span class="comment">//                    imageView.image = image.resizeImage(image, targetSize: targetSize)</span></div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>重新测下帧数以及Time Profile</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-2c7369df156405e6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20170112-143643.png"><br>当快速滑动的时候基本上能够达到慢帧的状态</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-833bed416800300a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20170112-143924.png"><br>所用的时间也是非常少的。在16ms以内。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/08/dispatch-semaphore-t-信号量/" itemprop="url">
                  dispatch_semaphore_t 信号量
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-12-08T16:20:14+08:00" content="2016-12-08">
              2016-12-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="dispatch-semaphore-create"><a href="#dispatch-semaphore-create" class="headerlink" title="dispatch_semaphore_create"></a><code>dispatch_semaphore_create</code></h1><p><code>dispatch_semaphore_create(long value)</code> 传入的是一个数字,该数字必须大于等于0。列如传入10，表示创建一个信号总量为10信号量（就好比一共有10个停车位）。假如传入0</p>
<p>The starting value for the semaphore. Passing a value less than zero will cause NULL to be returned.</p>
<p>则返回为NULL</p>
<h1 id="dispatch-semaphore-wait"><a href="#dispatch-semaphore-wait" class="headerlink" title="dispatch_semaphore_wait"></a><code>dispatch_semaphore_wait</code></h1><p>该函数会使传入的信号量减1,当信号量有 &gt;= 1时,就会继续往下执行。如果没有,该线程就会一直处于等待状态，可阻塞当前线程。该函数需要传入另一个参数 </p>
<p><code>#define DISPATCH_TIME_NOW  表示从现在开始 #define DISPATCH_TIME_FOREVER  表示永不超时</code></p>
<h1 id="dispatch-semaphore-single"><a href="#dispatch-semaphore-single" class="headerlink" title="dispatch_semaphore_single"></a><code>dispatch_semaphore_single</code></h1><p>该函数会使传入的信号量加1,与<code>dispatch_ semaphore _ wait</code>成对出现。</p>
<p>拿YYKit源码来举例：在#import “UIButton+YYWebImage.m”中</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">instancetype</span>)init &#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">    <span class="comment">//声明一个信号总量为1信号量</span></div><div class="line">    _lock = dispatch_semaphore_create(<span class="number">1</span>);</div><div class="line">    _dic = [<span class="built_in">NSMutableDictionary</span> new];</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (_YYWebImageSetter *)setterForState:(<span class="built_in">NSNumber</span> *)state &#123;</div><div class="line"></div><div class="line"><span class="comment">//是当前线程处于阻塞状态,直到有 &gt;= 1 信号量才会继续执行下面的取值操作</span></div><div class="line">    dispatch_semaphore_wait(_lock, DISPATCH_TIME_FOREVER);</div><div class="line">    _YYWebImageSetter *<span class="keyword">setter</span> = _dic[state];</div><div class="line">    <span class="comment">//使该信号量加1。保持信号量的平衡，如果没有保持信号量的平衡,可能会出现莫名的bug,甚至crash。</span></div><div class="line">    dispatch_semaphore_signal(_lock);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">setter</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">- (_YYWebImageSetter *)lazySetterForState:(<span class="built_in">NSNumber</span> *)state &#123;</div><div class="line">    dispatch_semaphore_wait(_lock, DISPATCH_TIME_FOREVER);</div><div class="line">    _YYWebImageSetter *<span class="keyword">setter</span> = _dic[state];</div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">setter</span>) &#123;</div><div class="line">        <span class="keyword">setter</span> = [_YYWebImageSetter new];</div><div class="line">        _dic[state] = <span class="keyword">setter</span>;</div><div class="line">    &#125;</div><div class="line">    dispatch_semaphore_signal(_lock);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">setter</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在读取_YYWebImageSetter该函数中使用<code>dispatch_semaphore_wait</code>和<code>dispatch_semaphore_signal</code>使当前函数为线程安全。实际上信号量就是锁，它与 <code>@synchronized</code> 函数看起来很像。所起到的作用就是至始至终只会有一个线程去访问该函数。</p>
<p>在 <a href="http://www.cnblogs.com/snailHL/p/3906112.html" target="_blank" rel="external">这边文章中</a>很形象的比喻了信号量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">关于信号量，一般可以用停车来比喻。</div><div class="line"></div><div class="line">　　停车场剩余4个车位，那么即使同时来了四辆车也能停的下。如果此时来了五辆车，那么就有一辆需要等待。</div><div class="line"></div><div class="line">　　信号量的值就相当于剩余车位的数目，dispatch_semaphore_wait函数就相当于来了一辆车，dispatch_semaphore_signal</div><div class="line"></div><div class="line">　　就相当于走了一辆车。停车位的剩余数目在初始化的时候就已经指明了（dispatch_semaphore_create（long value）），</div><div class="line"></div><div class="line">　　调用一次dispatch_semaphore_signal，剩余的车位就增加一个；调用一次dispatch_semaphore_wait剩余车位就减少一个；</div><div class="line"></div><div class="line">　　当剩余车位为0时，再来车（即调用dispatch_semaphore_wait）就只能等待。有可能同时有几辆车等待一个停车位。有些车主</div><div class="line"></div><div class="line">　　没有耐心，给自己设定了一段等待时间，这段时间内等不到停车位就走了，如果等到了就开进去停车。而有些车主就像把车停在这，</div><div class="line"></div><div class="line">　　所以就一直等下去。</div></pre></td></tr></table></figure>
<p>举个🌰   NSMutableArray不是线程安全的,我们可以稍作修饰,线程安全的去更新数组</p>
<p>　<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSMutableArray</span> *array = [<span class="built_in">NSMutableArray</span> array];</div><div class="line"> dispatch_semaphore_t semphore = dispatch_semaphore_create(<span class="number">1</span>);</div><div class="line"> <span class="built_in">dispatch_queue_t</span> concurrentQueue = dispatch_queue_create(<span class="string">"com.starming.gcddemo.concurrentqueue"</span>,DISPATCH_QUEUE_CONCURRENT);</div><div class="line">      dispatch_apply(<span class="number">100</span>, concurrentQueue, ^(size_t i) &#123;</div><div class="line">          dispatch_semaphore_wait(semphore, DISPATCH_TIME_FOREVER);</div><div class="line">          <span class="comment">/*</span></div><div class="line">          @synchronized (array) &#123;</div><div class="line">              [array addObject:[NSNumber numberWithUnsignedInteger:i]];</div><div class="line">          &#125;</div><div class="line">           */</div><div class="line">          [array addObject:[<span class="built_in">NSNumber</span> numberWithUnsignedInteger:i]];</div><div class="line">          dispatch_semaphore_signal(semphore);</div><div class="line">      &#125;);</div><div class="line">      <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,array);</div></pre></td></tr></table></figure></p>
<p>　　
　　</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/14/cocoapods升级1.1.0/" itemprop="url">
                  cocoapods 更新到最新版本(1.1.0)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-14T20:45:52+08:00" content="2016-10-14">
              2016-10-14
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/其他/" itemprop="url" rel="index">
                    <span itemprop="name">其他</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在Apple 发布swift3.0之后 一大部分著名的第三方开源库,比如Alamofire,snapKit 之后都陆续更新到swift3.0。当我们用cocoapods管理它们或者使用它们的时候都会看到这样一句话:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CocoaPods 1.1.0+ is required to build Alamofire 4.0.0+.</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CocoaPods 1.1.0+ is required to build SnapKit 3.0.0+.</div></pre></td></tr></table></figure>
<p>需要将cocoapods更新到1.1.0版本以上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gem install cocoapods --pre //升级到最新版本</div></pre></td></tr></table></figure>
<p>但是会遇到权限问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ERROR:  While executing gem ... (Errno::EPERM) Operation not permitted - /usr/bin/pod</div></pre></td></tr></table></figure>
<p>需要这么一句话</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo gem install cocoapods --pre -n /usr/local/bin cocoa pods</div></pre></td></tr></table></figure>
<p>在10.11以上的系统中Apple已经启用无根的安装 stack overflow这么解释:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">This is happening because Apple has enabled rootless on the new install</div></pre></td></tr></table></figure>
<p><a href="http://stackoverflow.com/questions/30812777/cannot-install-cocoa-pods-after-uninstalling-results-in-error/" target="_blank" rel="external">参考链接</a></p>
<p>查看cocoapods当前版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod --version</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">1.1.0.beta.2</div></pre></td></tr></table></figure>
<p>此时cocoapods版本就会更新到最新版本.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/10/iOS开发小技巧(一)/" itemprop="url">
                  iOS开发小技巧(一)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-10T20:44:20+08:00" content="2016-10-10">
              2016-10-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="改变UIImagePickerController的导航条以及title的颜色"><a href="#改变UIImagePickerController的导航条以及title的颜色" class="headerlink" title="改变UIImagePickerController的导航条以及title的颜色"></a>改变UIImagePickerController的导航条以及title的颜色</h1><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)navigationController:(<span class="built_in">UINavigationController</span> *)navigationController willShowViewController:(<span class="built_in">UIViewController</span> *)viewController animated:(<span class="built_in">BOOL</span>)animated</div><div class="line">&#123;</div><div class="line">   [<span class="built_in">UIApplication</span> sharedApplication].statusBarStyle = <span class="built_in">UIStatusBarStyleLightContent</span>;</div><div class="line">    <span class="built_in">UINavigationBar</span> *bar = [<span class="built_in">UINavigationBar</span> appearance];</div><div class="line">    <span class="built_in">NSMutableDictionary</span> *titleDictionary = [<span class="built_in">NSMutableDictionary</span> dictionary];</div><div class="line">    titleDictionary[<span class="built_in">NSForegroundColorAttributeName</span>] = [<span class="built_in">UIColor</span> whiteColor];</div><div class="line">    [bar setTitleTextAttributes:titleDictionary];</div><div class="line">    viewController.navigationController.navigationBar.barTintColor = DIF_BASE_COLOR;</div><div class="line">    viewController.navigationController.navigationBar.tintColor = [<span class="built_in">UIColor</span> whiteColor];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="利用KVC改变TextField的占位符的颜色"><a href="#利用KVC改变TextField的占位符的颜色" class="headerlink" title="利用KVC改变TextField的占位符的颜色"></a>利用KVC改变TextField的占位符的颜色</h1><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="keyword">self</span>.nickNameTextField setValue:[<span class="built_in">UIColor</span> whiteColor] forKeyPath:<span class="string">@"_placeholderLabel.textColor"</span>];</div></pre></td></tr></table></figure>
<h1 id="TextView的字数限制"><a href="#TextView的字数限制" class="headerlink" title="TextView的字数限制"></a>TextView的字数限制</h1><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#define MaxNumberOfDescriptionChars  150</span></div><div class="line"></div><div class="line">-(<span class="keyword">void</span>)textViewEditChanged:(<span class="built_in">NSNotification</span> *)obj&#123;</div><div class="line">    <span class="built_in">UITextView</span> *textView = (<span class="built_in">UITextView</span> *)obj.object;</div><div class="line">    <span class="built_in">NSString</span> *toBeString = textView.text;</div><div class="line">    <span class="built_in">NSString</span> *lang = [[<span class="built_in">UITextInputMode</span> currentInputMode] primaryLanguage]; <span class="comment">// 键盘输入模式</span></div><div class="line">    <span class="keyword">if</span> ([lang isEqualToString:<span class="string">@"zh-Hans"</span>]) &#123; <span class="comment">// 简体中文输入，包括简体拼音，健体五笔，简体手写</span></div><div class="line">        <span class="built_in">UITextRange</span> *selectedRange = [textView markedTextRange];</div><div class="line">        <span class="comment">//获取高亮部分</span></div><div class="line">        <span class="built_in">UITextPosition</span> *position = [textView positionFromPosition:selectedRange.start offset:<span class="number">0</span>];</div><div class="line">        <span class="comment">// 没有高亮选择的字，则对已输入的文字进行字数统计和限制</span></div><div class="line">        <span class="keyword">if</span> (!position) &#123;</div><div class="line">            <span class="keyword">if</span> (toBeString.length &gt; MaxNumberOfDescriptionChars) &#123;</div><div class="line">                textView.text = [toBeString substringToIndex:MaxNumberOfDescriptionChars];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 有高亮选择的字符串，则暂不对文字进行统计和限制</span></div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 中文输入法以外的直接对其统计限制即可，不考虑其他语种情况</span></div><div class="line">    <span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">if</span> (toBeString.length &gt; MaxNumberOfDescriptionChars) &#123;</div><div class="line">            </div><div class="line">            textView.text = [toBeString substringToIndex:MaxNumberOfDescriptionChars];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">- (<span class="built_in">BOOL</span>)textView:(<span class="built_in">UITextView</span> *)textView shouldChangeTextInRange:(<span class="built_in">NSRange</span>)range replacementText:(<span class="built_in">NSString</span> *)text&#123;</div><div class="line">    <span class="built_in">NSString</span> *new = [textView.text stringByReplacingCharactersInRange:range withString:text];</div><div class="line">    <span class="keyword">self</span>.numLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%zd字"</span>,(MaxNumberOfDescriptionChars - new.length)];</div><div class="line">    <span class="keyword">if</span>(new.length &gt; MaxNumberOfDescriptionChars)&#123;</div><div class="line">         <span class="keyword">self</span>.numLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%zd字"</span>,<span class="number">0</span>];</div><div class="line">        <span class="keyword">if</span> (![text isEqualToString:<span class="string">@""</span>]) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="判断字符串或者集合类型是否为空"><a href="#判断字符串或者集合类型是否为空" class="headerlink" title="判断字符串或者集合类型是否为空"></a>判断字符串或者集合类型是否为空</h1><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">BOOL</span>)isEmpty:(<span class="keyword">id</span> )obj</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> ([obj isKindOfClass:[<span class="built_in">NSString</span> <span class="keyword">class</span>]]) &#123;</div><div class="line">        <span class="keyword">if</span>(obj == <span class="literal">nil</span> || [obj <span class="keyword">class</span>] == [<span class="built_in">NSNull</span> null] || [obj isEqualToString:<span class="string">@""</span>] || [obj isEqualToString:<span class="string">@"(null)"</span>] || [obj isEqualToString:<span class="string">@"NULL"</span>] || [obj isEqualToString:<span class="string">@"&lt;null&gt;"</span>] || [obj isEqualToString:<span class="string">@"null"</span>])</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (obj == <span class="literal">nil</span> || (<span class="built_in">NSNull</span> *)obj == [<span class="built_in">NSNull</span> null] || ([obj respondsToSelector:<span class="keyword">@selector</span>(length)] &amp;&amp; [obj length] == <span class="number">0</span>) || ([obj respondsToSelector:<span class="keyword">@selector</span>(count)] &amp;&amp; [obj count] == <span class="number">0</span>))&#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="给UIResponder添加indexPath属性"><a href="#给UIResponder添加indexPath属性" class="headerlink" title="给UIResponder添加indexPath属性"></a>给UIResponder添加indexPath属性</h1><h2 id="列如在cell中有button-imageview-可以利用该属性找到cell中改该视图"><a href="#列如在cell中有button-imageview-可以利用该属性找到cell中改该视图" class="headerlink" title="列如在cell中有button imageview 可以利用该属性找到cell中改该视图"></a>列如在cell中有button imageview 可以利用该属性找到cell中改该视图</h2><h3 id="objective-C"><a href="#objective-C" class="headerlink" title="objective - C"></a>objective - C</h3><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UIResponder</span> (<span class="title">Externtion</span>)</span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSIndexPath</span> *indexPath;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</div><div class="line">&#123;</div><div class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, <span class="keyword">@selector</span>(indexPath), indexPath, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">- (<span class="built_in">NSIndexPath</span> *)indexPath&#123;</div><div class="line">    <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, <span class="keyword">@selector</span>(indexPath));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="swift"><a href="#swift" class="headerlink" title="swift"></a>swift</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIResponder</span></span>&#123;</div><div class="line">    </div><div class="line">   <span class="keyword">private</span> <span class="class"><span class="keyword">struct</span> <span class="title">AssociatedKey</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">var</span> <span class="type">AssociatedName</span> = <span class="string">"AssociatedName"</span></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">var</span> indexPath: <span class="type">NSIndexPath</span>?&#123;</div><div class="line">        <span class="keyword">get</span>&#123;</div><div class="line">           <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, &amp;<span class="type">AssociatedKey</span>.<span class="type">AssociatedName</span>) <span class="keyword">as</span>? <span class="type">NSIndexPath</span></div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">set</span>&#123;</div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> newValue = newValue &#123;</div><div class="line">                objc_setAssociatedObject(<span class="keyword">self</span>, &amp;<span class="type">AssociatedKey</span>.<span class="type">AssociatedName</span>, newValue <span class="keyword">as</span> <span class="type">NSIndexPath</span> , .<span class="type">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span>)</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="UIRefreshControl"><a href="#UIRefreshControl" class="headerlink" title="UIRefreshControl"></a>UIRefreshControl</h1><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> refresh = <span class="type">UIRefreshControl</span>.<span class="keyword">init</span>()</div><div class="line">        refresh.tintColor = <span class="type">UIColor</span>.red</div><div class="line">        refresh.attributedTitle = <span class="type">NSAttributedString</span>.<span class="keyword">init</span>(string: <span class="string">"正在加载"</span>)</div><div class="line">        refresh.addTarget(<span class="keyword">self</span>, action: #selector(<span class="type">ViewController</span>.refreshTabeleView(sender:)), <span class="keyword">for</span>: <span class="type">UIControlEvents</span>.valueChanged)</div><div class="line">        </div><div class="line">        </div><div class="line">        tableView.refreshControl = refresh</div><div class="line">        tableView.addSubview(refresh)</div><div class="line">        tableView.reloadData()</div></pre></td></tr></table></figure>
<h1 id="将HTML字符串转化为NSAttributedString富文本字符串"><a href="#将HTML字符串转化为NSAttributedString富文本字符串" class="headerlink" title="将HTML字符串转化为NSAttributedString富文本字符串"></a>将HTML字符串转化为NSAttributedString富文本字符串</h1><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSAttributedString</span> *)attributedStringWithHTMLString:(<span class="built_in">NSString</span> *)htmlString</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSDictionary</span> *options = @&#123; <span class="built_in">NSDocumentTypeDocumentAttribute</span> : <span class="built_in">NSHTMLTextDocumentType</span>,</div><div class="line">                               <span class="built_in">NSCharacterEncodingDocumentAttribute</span> :@(<span class="built_in">NSUTF8StringEncoding</span>) &#125;;</div><div class="line">   </div><div class="line">    <span class="built_in">NSData</span> *data = [htmlString dataUsingEncoding:<span class="built_in">NSUTF8StringEncoding</span>];</div><div class="line">   </div><div class="line">    <span class="keyword">return</span> [[<span class="built_in">NSAttributedString</span> alloc] initWithData:data options:options documentAttributes:<span class="literal">nil</span> error:<span class="literal">nil</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="CABasicAnimation（CAKeyframeAnimation）key-path-取值"><a href="#CABasicAnimation（CAKeyframeAnimation）key-path-取值" class="headerlink" title="CABasicAnimation（CAKeyframeAnimation）key path 取值"></a>CABasicAnimation（CAKeyframeAnimation）key path 取值</h1><h2 id="keyPath可以使用的key"><a href="#keyPath可以使用的key" class="headerlink" title="keyPath可以使用的key"></a>keyPath可以使用的key</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">- define angle2Radian(angle) ((angle)/180.0*M_PI)</div><div class="line"></div><div class="line">transform.rotation.x 围绕x轴翻转 参数：角度 angle2Radian(4)</div><div class="line"></div><div class="line">transform.rotation.y 围绕y轴翻转 参数：同上</div><div class="line"></div><div class="line">transform.rotation.z 围绕z轴翻转 参数：同上</div><div class="line"></div><div class="line">transform.rotation 默认围绕z轴</div><div class="line"></div><div class="line">transform.scale.x x方向缩放 参数：缩放比例 1.5</div><div class="line"></div><div class="line">transform.scale.y y方向缩放 参数：同上</div><div class="line"></div><div class="line">transform.scale.z z方向缩放 参数：同上</div><div class="line"></div><div class="line">transform.scale 所有方向缩放 参数：同上</div><div class="line"></div><div class="line">transform.translation.x x方向移动 参数：x轴上的坐标 100</div><div class="line"></div><div class="line">transform.translation.y x方向移动 参数：y轴上的坐标</div><div class="line"></div><div class="line">transform.translation.z x方向移动 参数：z轴上的坐标</div><div class="line"></div><div class="line">transform.translation 移动 参数：移动到的点 （100，100）</div><div class="line"></div><div class="line">opacity 透明度 参数：透明度 0.5</div><div class="line"></div><div class="line">backgroundColor 背景颜色 参数：颜色 (id)[[UIColor redColor] CGColor]</div><div class="line"></div><div class="line">cornerRadius 圆角 参数：圆角半径 5</div><div class="line"></div><div class="line">borderWidth 边框宽度 参数：边框宽度 5</div><div class="line"></div><div class="line">bounds 大小 参数：CGRect</div><div class="line"></div><div class="line">contents 内容 参数：CGImage</div><div class="line"></div><div class="line">contentsRect 可视内容 参数：CGRect 值是0～1之间的小数</div><div class="line"></div><div class="line">hidden 是否隐藏</div><div class="line"></div><div class="line">position</div><div class="line"></div><div class="line">shadowColor</div><div class="line"></div><div class="line">shadowOffset</div><div class="line"></div><div class="line">shadowOpacity</div><div class="line"></div><div class="line">shadowRadius</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/09/load VS initialize/" itemprop="url">
                  load VS initialize
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-09T20:35:30+08:00" content="2016-10-09">
              2016-10-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="共同点"><a href="#共同点" class="headerlink" title="共同点"></a>共同点</h1><p>方法只会被调用一次(相对于runtime而言)</p>
<h1 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h1><h2 id="load方法"><a href="#load方法" class="headerlink" title="load方法"></a>load方法</h2><p>声明一个SuperClass类继承与NSObject </p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SuperClass</span></span></div><div class="line">+ (<span class="keyword">void</span>) load &#123;</div><div class="line">  <span class="built_in">NSLog</span>(<span class="string">@"加载load方法"</span>); </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在main.m文件中导入头文件 <code>#import &quot;SuperClass.h&quot;</code></p>
<p>控制台打印输出 <code>Test[1558:44427] 加载load方法</code></p>
<p>得出结论:load是只要类所在文件被引用就会被调用</p>
<h2 id="initialize方法"><a href="#initialize方法" class="headerlink" title="initialize方法"></a>initialize方法</h2><p>执行以下代码</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">+ (<span class="keyword">void</span>) initialize &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>) load &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>控制台打印输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SuperClass +[SuperClass initialize]</div><div class="line">SuperClass +[SuperClass load]</div></pre></td></tr></table></figure>
<p>为什么initialize方法会再load方法前调用呢？通过Apple的文档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">The runtime sends initialize to each class in a program exactly one time just before the class, or any class that inherits from it, is sent its first message from within the program. (Thus the method may never be invoked if the class is not used.) The runtime sends the initialize message to classes in a thread-safe manner. Superclasses receive this message before their subclasses.</div></pre></td></tr></table></figure>
<p>得知: initialize方法在类的第一个方法被调用前调用。即先执行load方法中的[self class] 就会调用initialize方法。</p>
<h2 id="子类会调用父类的initialize"><a href="#子类会调用父类的initialize" class="headerlink" title="子类会调用父类的initialize"></a>子类会调用父类的initialize</h2><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ChildClass</span> : <span class="title">SuperClass</span></span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SuperClass</span></span></div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>) initialize &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ChildClass</span></span></div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>)load</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>还是导入头文件而不去使用它控制台打印输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SuperClass +[SuperClass initialize]</div><div class="line">ChildClass +[ChildClass initialize]</div><div class="line">ChildClass +[ChildClass load]</div></pre></td></tr></table></figure>
<h2 id="类别-Category-中的-void-load的-void-initialize"><a href="#类别-Category-中的-void-load的-void-initialize" class="headerlink" title="类别(Category)中的+(void)load的+(void)initialize"></a>类别(Category)中的+(void)load的+(void)initialize</h2><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/******* Interface *******/</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MainClass</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="comment">/******* Category Implementation *******/</span></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MainClass</span>(<span class="title">Category</span>)</span></div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>) load &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>) initialize &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MainClass</span>(<span class="title">OtherCategory</span>)</span></div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>) load &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>) initialize &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="comment">/******* Implementation *******/</span></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MainClass</span></span></div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>) load &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>) initialize &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>import 之后 </p>
<p>MainClass +[MainClass(OtherCategory) initialize]<br>MainClass +[MainClass load]<br>MainClass +[MainClass(Category) load]<br>MainClass +[MainClass(OtherCategory) load]</p>
<p>先执行类自身的实现，再执行类别(Category)中的实现</p>
<h2 id="不需要调用-super-load-和-super-initialize"><a href="#不需要调用-super-load-和-super-initialize" class="headerlink" title="不需要调用[super load] 和 [super initialize]"></a>不需要调用[super load] 和 [super initialize]</h2><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">+ (<span class="keyword">void</span>)initialize &#123;</div><div class="line">    <span class="comment">//do initialization thing</span></div><div class="line">    [<span class="keyword">super</span> initialize];</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>) load &#123;</div><div class="line">    <span class="comment">//do some loading things</span></div><div class="line">    [<span class="keyword">super</span> load];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样写是多余的</p>
<h1 id="开发过程中需要注意"><a href="#开发过程中需要注意" class="headerlink" title="开发过程中需要注意"></a>开发过程中需要注意</h1><p>在Objective-C中，运行时会自动调用每个类的两个方法。+load会在类初始加载时调用，+initialize会在第一次调用类的类方法或实例方法之前被调用。这两个方法是可选的，且只有在实现了它们时才会被调用。由于method swizzling会影响到类的全局状态，因此要尽量避免在并发处理中出现竞争的情况。+load能保证在类的初始化过程中被加载，并保证这种改变应用级别的行为的一致性。相比之下，+initialize在其执行时不提供这种保证–事实上，如果在应用中没为给这个类发送消息，则它可能永远不会被调用</p>
<p>参考链接:<br><a href="http://www.cnblogs.com/ider/archive/2012/09/29/objective_c_load_vs_initialize.html" target="_blank" rel="external">Objective C类方法load和initialize的区别</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/24/3D - Touch之Peek & Pop/" itemprop="url">
                  3D - Touch（二）之Peek & Pop
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-24T10:21:50+08:00" content="2016-09-24">
              2016-09-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在介绍了前面的桌面的3D-Touch,这篇文章来介绍应用中使用peek &amp; pop。 比如QQ 微信中消息界面重压cell就会出现peek &amp; pop。接下来实现这一效果。</p>
<h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><h2 id="创建视图-sourceView"><a href="#创建视图-sourceView" class="headerlink" title="创建视图(sourceView)"></a>创建视图(sourceView)</h2><p>首先用tableview来做例子。用storyboard创建表,在这里就不赘述了。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> titleArray = [<span class="string">"3D-Touch Objective-C"</span>,<span class="string">"3D-Touch Swift"</span>,<span class="string">"前言快报:Swift终将超越OC,进而取代OC"</span>,<span class="string">"Github9月编程语言 JS 跃居第一位"</span>]</div></pre></td></tr></table></figure>
<p>创建一个数组来做tableview的数据源。</p>
<h2 id="实现代理"><a href="#实现代理" class="headerlink" title="实现代理"></a>实现代理</h2><p>在实现这一效果之前,需要使当前的控制器实现<code>UIViewControllerPreviewingDelegate</code>代理并且要判断当前设备是否支持Peek &amp; pop:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> traitCollection.forceTouchCapability == .available&#123;</div><div class="line">            registerForPreviewing(with: <span class="keyword">self</span>, sourceView: tableView)</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p>代理中有两个方法:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">previewingContext</span><span class="params">(<span class="number">_</span> previewingContext: UIViewControllerPreviewing, viewControllerForLocation location: CGPoint)</span></span> -&gt; <span class="type">UIViewController</span>?</div></pre></td></tr></table></figure>
<p>第一个参数可以获取到要显示的是哪个目标view（sourceView）以及手势,其中有个属性（sourceRect）还可以控制那块区域展示出peek的效果</p>
<p>第二个参数location 顾名思义就是要控制能产生重压的区域。(与第一个参数的sourceRect不同,sourceRect只是哪片区域要展示peek效果,就是在屏幕中视图凸起的那一部分。如果不设置默认就是整个sourceView,而这个参数则是控制哪些区域能使用peek效果)。注意 “能” 和 “要”。<br>这个方法返回的是要显示的那个控制器,就是pop预览的那个控制器。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">previewingContext</span><span class="params">(<span class="number">_</span> previewingContext: UIViewControllerPreviewing, commit viewControllerToCommit: UIViewController)</span></span></div></pre></td></tr></table></figure>
<p>这个方法就是用来做跳转的。</p>
<h2 id="开始实现代理方法"><a href="#开始实现代理方法" class="headerlink" title="开始实现代理方法"></a>开始实现代理方法</h2><p>我们需要新建一个控制器来做pop效果,返回出这个控制器。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">previewingContext</span><span class="params">(<span class="number">_</span> previewingContext: UIViewControllerPreviewing, viewControllerForLocation location: CGPoint)</span></span> -&gt; <span class="type">UIViewController</span>? &#123;</div><div class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> indexPath = tableView.indexPathForRow(at:location) , <span class="keyword">let</span> cell = tableView.cellForRow(at: indexPath) <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">let</span> detailVC  = <span class="type">UIStoryboard</span>.<span class="keyword">init</span>(name: <span class="string">"Main"</span>, bundle: <span class="literal">nil</span>).instantiateViewController(withIdentifier: <span class="string">"detail"</span>) <span class="keyword">as</span>! <span class="type">DetailViewController</span></div><div class="line">    previewingContext.sourceRect = cell.frame</div><div class="line">    detailVC.text = (cell.textLabel?.text)!</div><div class="line">    <span class="keyword">return</span> detailVC</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">previewingContext</span><span class="params">(<span class="number">_</span> previewingContext: UIViewControllerPreviewing, commit viewControllerToCommit: UIViewController)</span></span> &#123;</div><div class="line"><span class="comment">//        self.show(viewControllerToCommit, sender: self)</span></div><div class="line">        <span class="keyword">self</span>.navigationController?.pushViewController(viewControllerToCommit, animated: <span class="literal">true</span>)</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>show 和 push都能展示出相同的效果</p>
<h2 id="在显示的控制器中设置代码"><a href="#在显示的控制器中设置代码" class="headerlink" title="在显示的控制器中设置代码"></a>在显示的控制器中设置代码</h2><p>在detailviewcontroller中需要返回出pop向上拉的选项。（也可以不实现）另外要为了要展示出数据,我在该视图控制器中添加了一个textview来展示数据。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.title = <span class="string">"详情"</span></div><div class="line"><span class="keyword">self</span>.automaticallyAdjustsScrollViewInsets = <span class="literal">false</span></div><div class="line"><span class="keyword">self</span>.textView.text = text</div></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">override</span> <span class="keyword">var</span> previewActionItems: [<span class="type">UIPreviewActionItem</span>]&#123;</div><div class="line">       </div><div class="line">       <span class="keyword">let</span> action1 = <span class="type">UIPreviewAction</span>.<span class="keyword">init</span>(title: <span class="string">"喜欢"</span>, style: .<span class="keyword">default</span>) &#123; (<span class="type">UIPreviewAction</span>, <span class="type">UIViewController</span>) <span class="keyword">in</span> </div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="keyword">let</span> action2 = <span class="type">UIPreviewAction</span>.<span class="keyword">init</span>(title: <span class="string">"收藏"</span>, style: .<span class="keyword">default</span>) &#123; (<span class="type">UIPreviewAction</span>, <span class="type">UIViewController</span>) <span class="keyword">in</span></div><div class="line">           </div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="keyword">let</span> cancle = <span class="type">UIPreviewAction</span>.<span class="keyword">init</span>(title: <span class="string">"取消"</span>, style: .<span class="keyword">default</span>) &#123; (<span class="type">UIPreviewAction</span>, <span class="type">UIViewController</span>) <span class="keyword">in</span></div><div class="line">           </div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="keyword">let</span> delete = <span class="type">UIPreviewAction</span>.<span class="keyword">init</span>(title: <span class="string">"删除"</span>, style: .destructive) &#123; (<span class="type">UIPreviewAction</span>, <span class="type">UIViewController</span>) <span class="keyword">in</span></div><div class="line">           </div><div class="line">       &#125;</div><div class="line">   </div><div class="line">       <span class="keyword">let</span> actionGroup = <span class="type">UIPreviewActionGroup</span>.<span class="keyword">init</span>(title: <span class="string">"删除"</span>, style: .destructive, actions: [cancle,delete])</div><div class="line">       </div><div class="line">       <span class="keyword">return</span> [action1, action2 ,actionGroup]</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>返回的数组中存的是UIPreviewAction。这个数组可以是个二维数组,所以可以展示出很多选项。例子中返回的就是一个二维数组。</p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>到此整个效果的代码都设置完了。接下来运行程序,看看我们的成果吧:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-f73b14b53899dc5b.gif?imageMogr2/auto-orient/strip" alt="3D- Touch.gif"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/23/3D-Touch 桌面/" itemprop="url">
                  3D - Touch(一) 桌面
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-23T20:07:51+08:00" content="2016-09-23">
              2016-09-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="桌面3D-Touch"><a href="#桌面3D-Touch" class="headerlink" title="桌面3D - Touch"></a>桌面3D - Touch</h1><h2 id="快捷静态操作（Quick-actions）"><a href="#快捷静态操作（Quick-actions）" class="headerlink" title="快捷静态操作（Quick actions）"></a>快捷静态操作（Quick actions）</h2><p>需要在 <code>info.plist</code>中配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;key&gt;UIApplicationShortcutItems&lt;/key&gt;</div><div class="line">&lt;array&gt;</div><div class="line">	&lt;dict&gt;</div><div class="line">		&lt;key&gt;UIApplicationShortcutItemIconType&lt;/key&gt;</div><div class="line">		&lt;string&gt;UIApplicationShortcutIconTypeShare&lt;/string&gt;</div><div class="line">		&lt;key&gt;UIApplicationShortcutItemTitle&lt;/key&gt;</div><div class="line">		&lt;string&gt;弹一弹&lt;/string&gt;</div><div class="line">		&lt;key&gt;UIApplicationShortcutItemType&lt;/key&gt;</div><div class="line">		&lt;string&gt;com.yuwubao.search&lt;/string&gt;</div><div class="line">	&lt;/dict&gt;</div><div class="line">	&lt;dict&gt;</div><div class="line">		&lt;key&gt;UIApplicationShortcutItemIconType&lt;/key&gt;</div><div class="line">		&lt;string&gt;UIApplicationShortcutIconTypeShare&lt;/string&gt;</div><div class="line">		&lt;key&gt;UIApplicationShortcutItemTitle&lt;/key&gt;</div><div class="line">		&lt;string&gt;摇一摇&lt;/string&gt;</div><div class="line">		&lt;key&gt;UIApplicationShortcutItemType&lt;/key&gt;</div><div class="line">		&lt;string&gt;com.yuwubao.search&lt;/string&gt;</div><div class="line">	&lt;/dict&gt;</div><div class="line">	&lt;dict&gt;</div><div class="line">		&lt;key&gt;UIApplicationShortcutItemIconType&lt;/key&gt;</div><div class="line">		&lt;string&gt;UIApplicationShortcutIconTypeShare&lt;/string&gt;</div><div class="line">		&lt;key&gt;UIApplicationShortcutItemTitle&lt;/key&gt;</div><div class="line">		&lt;string&gt;扫一扫&lt;/string&gt;</div><div class="line">		&lt;key&gt;UIApplicationShortcutItemType&lt;/key&gt;</div><div class="line">		&lt;string&gt;com.yuwubao.search&lt;/string&gt;</div><div class="line">	&lt;/dict&gt;</div><div class="line">&lt;/array&gt;</div></pre></td></tr></table></figure>
<p>关于几个必须要填写的项：</p>
<ol>
<li>UIApplicationShortcutItemTitle:  表示要显示的标题。展示在你的quick action菜单中的action标题。如果标题一行无法显示并且你没有指定子标题那么它将显示两行。可以使用本地化(localised)。</li>
<li>UIApplicationShortcutItemType:  作为UIApplicationShortcutItem的一部分发送给你的应用。可以依据不同的shortcut类型用于执行你的actions。命名规则为： com.公司名.app名.图标作用名</li>
</ol>
<p>关于选填的项：</p>
<ol>
<li>UIApplicationShortcutItemIconType:  定义内置图标类型的字符串，可选类型列表可以查询<a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIApplicationShortcutIcon_Class/index.html#//apple_ref/c/tdef/UIApplicationShortcutIconType" target="_blank" rel="external">这里</a></li>
<li>UIApplicationShortcutItemSubtitle:  用户展示你的actions的子标题的字符串。它将显示在你的quick actions标题的下方。可以本地化。</li>
<li>UIApplicationShortcutItemIconFile：一个指定Assets Catalog或者Bundle中的字符串。如果指定了此键，则系统会忽略UIApplicationShortcutItemIconType</li>
<li>UIApplicationShortcutItemUserInfo：一个字典，包含你想要解析的其他信息。</li>
</ol>
<h2 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h2><p>在入口类文件（appDelegate）中</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?)</span></span> -&gt; <span class="type">Bool</span> &#123;</div><div class="line">        </div><div class="line">        <span class="comment">//检测版本</span></div><div class="line">        <span class="keyword">if</span> <span class="type">UIDevice</span>.current.systemVersion &gt;= <span class="string">"9.0"</span> &#123;</div><div class="line">            <span class="keyword">let</span> shortcutItem = launchOptions?[<span class="type">UIApplicationLaunchOptionsKey</span>.shortcutItem] <span class="keyword">as</span>? <span class="type">UIApplicationShortcutItem</span></div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> shortcutItem = shortcutItem&#123;</div><div class="line">                <span class="keyword">self</span>.quickActionWithShortcutItem(shortcutItem: shortcutItem)</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>还要实现另一个方法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//MARK: - 3D-Touch</span></div><div class="line"> <span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, performActionFor shortcutItem: UIApplicationShortcutItem, completionHandler: @escaping <span class="params">(Bool)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</div><div class="line">     <span class="keyword">self</span>.quickActionWithShortcutItem(shortcutItem: shortcutItem)</div><div class="line">     completionHandler(<span class="literal">true</span>)</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>由于代码的冗余 需要定义一个私有的方法 可以根据<br><code>localizedTitle</code> 或者 <code>type</code> 来区别点击的是哪个。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span>  <span class="function"><span class="keyword">func</span> <span class="title">quickActionWithShortcutItem</span><span class="params">(shortcutItem: UIApplicationShortcutItem)</span></span>&#123;</div><div class="line">      <span class="keyword">let</span> nav = <span class="keyword">self</span>.window?.rootViewController <span class="keyword">as</span>? <span class="type">UINavigationController</span></div><div class="line">      <span class="keyword">if</span> shortcutItem.localizedTitle == <span class="string">"弹一弹"</span>&#123;</div><div class="line">          </div><div class="line">      &#125;<span class="keyword">else</span> <span class="keyword">if</span> shortcutItem.localizedTitle == <span class="string">"摇一摇"</span>&#123;</div><div class="line">          </div><div class="line">          <span class="keyword">let</span> detailVC = <span class="type">UIStoryboard</span>.<span class="keyword">init</span>(name: <span class="string">"Main"</span>, bundle: <span class="literal">nil</span>).instantiateViewController(withIdentifier: <span class="string">"detail"</span>) <span class="keyword">as</span>! <span class="type">DetailViewController</span></div><div class="line">          nav!.pushViewController(detailVC, animated: <span class="literal">true</span>)</div><div class="line">          </div><div class="line">      &#125;<span class="keyword">else</span>&#123;</div><div class="line">          </div><div class="line">          nav!.pushViewController(<span class="type">ThirdViewController</span>(), animated: <span class="literal">true</span>)</div><div class="line">      &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>到这里完全设置好了桌面图标的3D - Touch。 由于最近系统升级到了iOS10 桌面icon的3D - Touch 新增了widget。接下来就来时适配iOS10。</p>
<h1 id="Extention"><a href="#Extention" class="headerlink" title="Extention"></a>Extention</h1><p>(更多信息移步到<a href="https://onevcat.com/2014/08/notification-today-widget/" target="_blank" rel="external">这里</a>)(喵神博客)</p>
<p>Extensions不是独立的应用程序。Extensions必须依赖于一个host app，叫作宿主APP，同时他们的生命周期相互独立，并且可以互相触发事件。一个宿主APP可以包含多个Extensions。本篇文章主要是 Today Extention。创建方法 <code>File-&gt;New-&gt;Target</code></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-2c7a1a352ceedf42.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="QQ20160923-0@2x.png"></p>
<p>工程中会多出这些文件</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-8d30c066607b9592.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="QQ20160923-1@2x.png"></p>
<p>在MainInterface.storyboard中我们可以定制UI。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-4ac148040ca13437.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="QQ20160923-3@2x.png"></p>
<p>当我们想纯代码构建UI时,在上图显示的Info.plist中NSExtension需要将NSExtensionMainStoryboard删掉,解除与storyboard的关联</p>
<p>例子中用的storyboard构建UI。 当我们需要与APP通信时。需要用到 URL Shchemes。</p>
<h2 id="首先给label添加手势"><a href="#首先给label添加手势" class="headerlink" title="首先给label添加手势"></a>首先给label添加手势</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">widgetLabel.addGestureRecognizer(<span class="type">UITapGestureRecognizer</span>.<span class="keyword">init</span>(target: <span class="keyword">self</span></div><div class="line">            , action: #selector(<span class="type">TodayViewController</span>.widgetLabelAction)))</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">@objc private  func widgetLabelAction() -&gt; Void &#123;</div><div class="line">       extensionContext?.open(NSURL(string: &quot;simple://finished&quot;) as! URL, completionHandler: nil)</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h2 id="设置URL-Schemes"><a href="#设置URL-Schemes" class="headerlink" title="设置URL Schemes"></a>设置URL Schemes</h2><p><img src="http://upload-images.jianshu.io/upload_images/1421047-a28aeabf864d2fc2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="QQ20160923-4@2x.png"></p>
<p>运行程序</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-108a96a4f30cd1bf.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_0609.PNG"></p>
<p>我们也可以在widget中添加自己的APP显示信息了</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/20/Swift基础/" itemprop="url">
                  Swift基础
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-20T22:54:59+08:00" content="2016-09-20">
              2016-09-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="stride与循环结构"><a href="#stride与循环结构" class="headerlink" title="stride与循环结构"></a>stride与循环结构</h1><p>区间运算符<br>开区间：[a,b]<br>闭区间：[a,b)<br>举例：<br>1.开区间</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> index <span class="keyword">in</span> <span class="number">1</span>..&lt;<span class="number">10</span>&#123;</div><div class="line">    index;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>index的值一次为:0~9;可以用此方法遍历数组。比如：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> scoreArr = [<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>,<span class="number">55</span>,<span class="number">66</span>,<span class="number">77</span>,<span class="number">88</span>,<span class="number">99</span>];</div><div class="line"><span class="keyword">var</span> <span class="built_in">count</span> = scoreArr.<span class="built_in">count</span>;</div><div class="line"><span class="keyword">for</span> index <span class="keyword">in</span> <span class="number">0</span> ..&lt; <span class="built_in">count</span>&#123;</div><div class="line">    <span class="keyword">var</span> s = scoreArr[index];</div><div class="line">    <span class="built_in">print</span>(s);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2.闭区间</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> index <span class="keyword">in</span> <span class="number">1</span>...<span class="number">10</span>&#123;</div><div class="line">    index;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>index的值以此为：0~10</p>
<h1 id="在swift3-0中stride语法已经改为这样-stride-from-to-by-函数和stride-from-through-by-函数"><a href="#在swift3-0中stride语法已经改为这样-stride-from-to-by-函数和stride-from-through-by-函数" class="headerlink" title="在swift3.0中stride语法已经改为这样:stride(from: , to: , by: )函数和stride(from: , through: , by: )函数"></a>在swift3.0中stride语法已经改为这样:stride(from: , to: , by: )函数和stride(from: , through: , by: )函数</h1><p>stride 方法定义在 Strideable 协议中,swift3.0废弃了传统C的for循环之后，定义的全新方法。<br>stride(from: , to: , by: )相当于开区间；<br>stride(from: , through: , by: )相当于闭区间<br>个人理解：<br>表示从初始数值到目标数值,by:表示跨越的进度（可加可减）。<br>举例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">stride</span>(from: <span class="number">10</span>, through: <span class="number">0</span>, by: -<span class="number">1</span>)&#123;</div><div class="line">    <span class="built_in">print</span>(index);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-c9a76252e83621c3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="屏幕快照 2016-09-07 下午10.03.33.png"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">stride</span>(from: <span class="number">10</span>, to: <span class="number">0</span>, by: -<span class="number">1</span>)&#123;</div><div class="line">    <span class="built_in">print</span>(index);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>index的数值:<br>index –10<br>index –9<br>index –8<br>index –7<br>index –6<br>index –5<br>index –4<br>index –3<br>index –2<br>index –1</p>
<h2 id="用stride方法遍历scoreArr数组"><a href="#用stride方法遍历scoreArr数组" class="headerlink" title="用stride方法遍历scoreArr数组"></a>用stride方法遍历scoreArr数组</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">stride</span>(from: <span class="number">0</span>, to: scoreArr.<span class="built_in">count</span>, by: <span class="number">1</span>)&#123;</div><div class="line">    <span class="keyword">var</span> arr = scoreArr[i];</div><div class="line">    <span class="built_in">print</span>(arr);</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/20/多种方法使tableView的Header下拉放大/" itemprop="url">
                  多种方法使tableView的Header下拉放大
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-20T22:15:16+08:00" content="2016-09-20">
              2016-09-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>看了<a href="http://www.jianshu.com/users/b09c3959ab3b/latest_articles" target="_blank" rel="external">峥吖</a>同学的这篇文章<a href="http://www.jianshu.com/p/859e3ef76b05" target="_blank" rel="external">【一行代码快速集成tableView头部缩放视图】</a>之后 。想着自己用其他的方法来实现这一效果，于是乎想到</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CGAffineTransformMakeScale</div></pre></td></tr></table></figure>
<p>这一方法。</p>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://upload-images.jianshu.io/upload_images/1421047-f9cf98990ebda6b2.gif?imageMogr2/auto-orient/strip" alt="下拉放大.gif"></p>
<h1 id="开始实现"><a href="#开始实现" class="headerlink" title="开始实现"></a>开始实现</h1><p>在自己写的过程中发现了一些问题, 直接把</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.tableView.tableHeaderView = <span class="keyword">self</span>.imageView</div></pre></td></tr></table></figure>
<p>之后并不能达到想要的效果。整张图片frame都随着tableview的拖动而改变。并不是像是固定在那里。tableview的顶部会出现大部分空白。然后我仔细看了一遍源码。发现做法是</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="keyword">self</span>.tableView insertSubview:imageView atIndex:<span class="number">0</span>];</div></pre></td></tr></table></figure>
<p>接着把一个透明view填充到tableview的header view中。   </p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">UIView</span> *headerView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>)];    </div><div class="line">headerView.backgroundColor = [<span class="built_in">UIColor</span> clearColor];    </div><div class="line"><span class="keyword">self</span>.tableView.tableHeaderView = headerView;</div></pre></td></tr></table></figure>
<p>找到这一技巧之后。自己写了一个稍微简单的demo。</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"header"</span>]];</div><div class="line">imageView.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="keyword">self</span>.view.frame.size.width, imageViewH);</div><div class="line">[<span class="keyword">self</span>.tableView insertSubview:imageView atIndex:<span class="number">0</span>];</div><div class="line"><span class="keyword">self</span>.imageView = imageView;</div><div class="line"></div><div class="line"><span class="built_in">UIView</span> *headerView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, imageViewH)];</div><div class="line">headerView.backgroundColor = [<span class="built_in">UIColor</span> clearColor];</div><div class="line"><span class="keyword">self</span>.tableView.tableHeaderView = headerView;</div></pre></td></tr></table></figure>
<p>在</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)scrollViewDidScroll:(<span class="built_in">UIScrollView</span> *)scrollView</div></pre></td></tr></table></figure>
<p>方法中这么写:</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CGFloat</span> offsetY = scrollView.contentOffset.y;</div><div class="line">  <span class="keyword">if</span> (offsetY &lt; <span class="number">0</span>) &#123;</div><div class="line">      <span class="keyword">self</span>.imageView.frame = <span class="built_in">CGRectMake</span>(offsetY, offsetY, scrollView.bounds.size.width - offsetY * <span class="number">2</span>, imageViewH - offsetY);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">self</span>.imageView.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, scrollView.bounds.size.width, imageViewH);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>原理一模一样,拿到scrollview的偏移量计算下拉imageview的frame,使其imageview的宽高增大。上拉的时候恢复原来的frame。</p>
<h1 id="另一种方法"><a href="#另一种方法" class="headerlink" title="另一种方法"></a>另一种方法</h1><p>还是在</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)scrollViewDidScroll:(<span class="built_in">UIScrollView</span> *)scrollView</div></pre></td></tr></table></figure>
<p>方法中拿到scrollview的偏移量计算缩放系数</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CGFloat</span> offsetY = scrollView.contentOffset.y + scrollView.contentInset.top;</div><div class="line"><span class="built_in">CGFloat</span> scale = <span class="number">1.0</span>;</div><div class="line"><span class="keyword">if</span> (offsetY &lt; <span class="number">0</span>) &#123;</div><div class="line">    <span class="comment">//向下拉</span></div><div class="line">    scale = MIN(<span class="number">2.5</span>, <span class="number">1</span> - offsetY / imageViewH);</div><div class="line">    <span class="keyword">self</span>.imageView.transform = <span class="built_in">CGAffineTransformMakeScale</span>(scale, scale);</div><div class="line">    <span class="built_in">CGRect</span> frame = <span class="keyword">self</span>.imageView.frame;</div><div class="line">    frame.origin.y = offsetY;</div><div class="line">    <span class="keyword">self</span>.imageView.frame = frame;</div><div class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(offsetY &gt; <span class="number">0</span>)</div><div class="line">&#123;</div><div class="line">    <span class="comment">//向上拉</span></div><div class="line">    <span class="built_in">CGRect</span> frame = <span class="keyword">self</span>.imageView.frame;</div><div class="line">    frame.origin.y = -offsetY/imageViewH;</div><div class="line">    <span class="keyword">self</span>.imageView.frame = frame;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>再向上拉的过程中要保证imageview不会进行缩放，只是改变下imageview的y轴的值。</p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>感谢<a href="http://www.jianshu.com/users/b09c3959ab3b/latest_articles" target="_blank" rel="external">峥吖</a>同学提供的思路。demo地址:<a href="https://github.com/sunshineLixun/tableViewHeaderScale" target="_blank" rel="external">戳我</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.png"
               alt="Sunshine" />
          <p class="site-author-name" itemprop="name">Sunshine</p>
          <p class="site-description motion-element" itemprop="description">做一个有文艺气息的程序猿</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">10</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/sunshineLixun" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sunshine</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
