<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="做一个有文艺气息的程序猿">
<meta property="og:type" content="website">
<meta property="og:title" content="Sunshine">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Sunshine">
<meta property="og:description" content="做一个有文艺气息的程序猿">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sunshine">
<meta name="twitter:description" content="做一个有文艺气息的程序猿">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/"/>

  <title> Sunshine </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Sunshine</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">lx的个人博客</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/13/iOS界面优化系列之：处理图片缩放问题/" itemprop="url">
                  iOS界面优化系列之：处理图片缩放问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-02-13T14:56:05+08:00" content="2017-02-13">
              2017-02-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在众多阅读类的APP中，比如:<br><img src="http://upload-images.jianshu.io/upload_images/1421047-8b81cc02257ab29f.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="
![IMG_0782.PNG](http://upload-images.jianshu.io/upload_images/1421047-cefaed703108a4aa.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
"></p>
<p>这类比较稍微简单的界面中充斥着大量的的图片，多则6张,少则3-4张。再者像微博这类重型社交的APP，有的cell都已经有9张图片。图片的优化程度对整个界面的流畅度来说都是重中之重。（另外一个也很重要的地方就是文本的异步渲染），后几个系列也会说到。</p>
<p>像这种异步加载图片的开源库有很多：SD_WebImageView  YYWebImage  Kingfisher  PINRemoteImage …<br>开发者如果只是简单的调用一下 sd_setImageWithURL: 图片能够很好的显示出来。假如从网络加载的图片与自己设置的UIImageView的尺寸不一致,就会导致这种结果。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-8aeb9245ca7573ca.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20170112-131912.png"><br>如果是真机调试 打开<code>Instruments</code>中<code>Core Animation</code><br><img src="http://upload-images.jianshu.io/upload_images/1421047-66c55b53453df8db.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20170112-135233.png"><br>在右侧栏中打开<br><img src="http://upload-images.jianshu.io/upload_images/1421047-7ce789d8152d0bff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20170112-135327.png"><br>如果是模拟器，打开Debug -&gt;Color Misaligned Images</p>
<p>这个选项检查了图片是否被缩放，以及像素是否对齐。被放缩的图片会被标记为黄色，像素不对齐则会标注为紫色。**黄色、紫色越多，性能越差。</p>
<p>解决办法：<br>1.与后台协商，让后台返回的图片尺寸与客户端UIImageView尺寸一致;<br>2.自己处理。</p>
<p>下面介绍下如何自己处理</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIImage</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">resizeImage</span><span class="params">(<span class="number">_</span> image: UIImage, targetSize: CGSize)</span></span> -&gt; <span class="type">UIImage</span>? &#123;</div><div class="line">            <span class="keyword">let</span> newRect = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: targetSize.width, height: targetSize.height).integral</div><div class="line">            <span class="type">UIGraphicsBeginImageContextWithOptions</span>(targetSize, <span class="literal">false</span>, <span class="number">0</span>)</div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>() &#123;</div><div class="line">                context.interpolationQuality = .high</div><div class="line">                <span class="keyword">let</span> flipVertical = <span class="type">CGAffineTransform</span>(a: <span class="number">1</span>, b: <span class="number">0</span>, <span class="built_in">c</span>: <span class="number">0</span>, d: -<span class="number">1</span>, tx: <span class="number">0</span>, ty: targetSize.height)</div><div class="line">                context.concatenate(flipVertical)</div><div class="line">                context.draw(<span class="keyword">self</span>.cgImage!, <span class="keyword">in</span>: newRect)</div><div class="line">                <span class="keyword">let</span> newImage = <span class="type">UIImage</span>(cgImage: context.makeImage()!)</div><div class="line">                <span class="type">UIGraphicsEndImageContext</span>()</div><div class="line">               <span class="keyword">return</span> newImage</div><div class="line">            &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>很简单就是网络下载下来的图片按照自己设置的UIImageView的尺寸来重新draw一个。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">setImage</span>&lt;T: UIImageView&gt;<span class="params">(<span class="number">_</span> imageView: T, URLString: String, targetSize: CGSize)</span></span>&#123;</div><div class="line">        imageView.pin_setImage(from: <span class="type">URL</span>.<span class="keyword">init</span>(string: <span class="type">URLString</span>), completion: &#123;(<span class="type">PINRemoteImageManagerResult</span>) <span class="keyword">in</span></div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> image = <span class="type">PINRemoteImageManagerResult</span>.image&#123;</div><div class="line">                    imageView.image = image.resizeImage(image, targetSize: targetSize)</div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>重新给UIImageView设置image属性</p>
<p>重新打开Color Misaligned Images功能来检测一下<br><img src="http://upload-images.jianshu.io/upload_images/1421047-95561fdba06255d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20170112-140353.png"></p>
<p>嗯！ 不错哦，之前的黄色没有了。 本以为就达到了的要求。</p>
<p>但是用<code>Instruments</code>中<code>Time Profiler</code><br><img src="http://upload-images.jianshu.io/upload_images/1421047-0556297eefe06581.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20170112-140732.png"><br>来检测下处理该函数所需要的时间</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-758e84ae67a3697e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20170112-141255.png"></p>
<p>用Core Animation来测下FPS</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-7663f55e36043484.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20170112-142314.png"></p>
<p>虽然已经很流畅了（注：文本用到了异步绘制）,  基本在54左右， 但是距离满帧59 - 60还差那么一丢丢。</p>
<p>再来观察给UIImage扩展的这个方法 发现它是在主线程中执行，当快速滑动表格时，会有大量的图片在主线程中重新绘制。这个是造成缺失那几帧的主要原因。</p>
<p>解决办法：那就在子线程总去draw, 在主线程中去显示</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIImageView</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">drawImage</span><span class="params">(<span class="number">_</span> image: UIImage, targetSize: CGSize)</span></span> &#123;</div><div class="line">        <span class="type">DispatchQueue</span>.global().async &#123;</div><div class="line">            <span class="keyword">let</span> newRect = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: targetSize.width, height: targetSize.height).integral</div><div class="line">            <span class="type">UIGraphicsBeginImageContextWithOptions</span>(targetSize, <span class="literal">false</span>, <span class="number">0</span>)</div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> context = <span class="type">UIGraphicsGetCurrentContext</span>() &#123;</div><div class="line">                context.interpolationQuality = .high</div><div class="line">                <span class="keyword">let</span> flipVertical = <span class="type">CGAffineTransform</span>(a: <span class="number">1</span>, b: <span class="number">0</span>, <span class="built_in">c</span>: <span class="number">0</span>, d: -<span class="number">1</span>, tx: <span class="number">0</span>, ty: targetSize.height)</div><div class="line">                context.concatenate(flipVertical)</div><div class="line">                context.draw(image.cgImage!, <span class="keyword">in</span>: newRect)</div><div class="line">                <span class="keyword">let</span> newImage = <span class="type">UIImage</span>(cgImage: context.makeImage()!)</div><div class="line">                <span class="type">UIGraphicsEndImageContext</span>()</div><div class="line">                <span class="type">DispatchQueue</span>.main.async &#123;</div><div class="line">                    <span class="keyword">self</span>.layer.contents = newImage.cgImage</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Objective-C</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)drawImage:(<span class="built_in">UIImage</span> *)image targetSize:(<span class="built_in">CGSize</span> )size&#123;</div><div class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(QOS_CLASS_DEFAULT, <span class="number">0</span>), ^&#123;</div><div class="line">        <span class="built_in">CGRect</span> newRect = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, size.width, size.height);</div><div class="line">        <span class="built_in">CGRectIntegral</span>(newRect);</div><div class="line">        <span class="built_in">UIGraphicsBeginImageContextWithOptions</span>(size, <span class="literal">NO</span>, [<span class="built_in">UIScreen</span> mainScreen].scale);</div><div class="line">        <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line">        <span class="built_in">CGContextSetInterpolationQuality</span>(context, kCGInterpolationHigh);</div><div class="line">        <span class="built_in">CGAffineTransform</span> transform = <span class="built_in">CGAffineTransformMake</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span>, size.height);</div><div class="line">        <span class="built_in">CGContextConcatCTM</span>(context, transform);</div><div class="line">        <span class="built_in">CGContextDrawImage</span>(context, newRect, image.CGImage);</div><div class="line">        <span class="built_in">CGImageRef</span> <span class="built_in">CGImage</span> = context ? <span class="built_in">CGBitmapContextCreateImage</span>(context) : <span class="literal">nil</span>;</div><div class="line">        <span class="built_in">UIImage</span> *newImage = <span class="built_in">CGImage</span> ? [<span class="built_in">UIImage</span> imageWithCGImage:<span class="built_in">CGImage</span>] : <span class="literal">nil</span>;</div><div class="line">        <span class="built_in">UIGraphicsEndImageContext</span>();</div><div class="line">        <span class="keyword">if</span> (<span class="built_in">CGImage</span>)&#123;</div><div class="line">            <span class="built_in">CGImageRelease</span>(<span class="built_in">CGImage</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</div><div class="line">            <span class="keyword">if</span> (newImage) &#123;</div><div class="line">                <span class="keyword">self</span>.layer.contents = (__bridge <span class="keyword">id</span> _Nullable)(newImage.CGImage);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>该方法也很简单,在子线程中去重新draw一个UIImage,在主线程中去显示。</p>
<p>调用：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">setImage</span>&lt;T: UIImageView&gt;<span class="params">(<span class="number">_</span> imageView: T, URLString: String, targetSize: CGSize)</span></span>&#123;</div><div class="line">        imageView.pin_setImage(from: <span class="type">URL</span>.<span class="keyword">init</span>(string: <span class="type">URLString</span>), completion: &#123;(<span class="type">PINRemoteImageManagerResult</span>) <span class="keyword">in</span></div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> image = <span class="type">PINRemoteImageManagerResult</span>.image&#123;</div><div class="line">                imageView.drawImage(image, targetSize: targetSize)</div><div class="line"><span class="comment">//                    imageView.image = image.resizeImage(image, targetSize: targetSize)</span></div><div class="line">            &#125;</div><div class="line">        &#125;)</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>重新测下帧数以及Time Profile</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-2c7369df156405e6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20170112-143643.png"><br>当快速滑动的时候基本上能够达到慢帧的状态</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-833bed416800300a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Jietu20170112-143924.png"><br>所用的时间也是非常少的。在16ms以内。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/08/dispatch-semaphore-t-信号量/" itemprop="url">
                  dispatch_semaphore_t 信号量
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-12-08T16:20:14+08:00" content="2016-12-08">
              2016-12-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="dispatch-semaphore-create"><a href="#dispatch-semaphore-create" class="headerlink" title="dispatch_semaphore_create"></a><code>dispatch_semaphore_create</code></h1><p><code>dispatch_semaphore_create(long value)</code> 传入的是一个数字,该数字必须大于等于0。列如传入10，表示创建一个信号总量为10信号量（就好比一共有10个停车位）。假如传入0</p>
<p>The starting value for the semaphore. Passing a value less than zero will cause NULL to be returned.</p>
<p>则返回为NULL</p>
<h1 id="dispatch-semaphore-wait"><a href="#dispatch-semaphore-wait" class="headerlink" title="dispatch_semaphore_wait"></a><code>dispatch_semaphore_wait</code></h1><p>该函数会使传入的信号量减1,当信号量有 &gt;= 1时,就会继续往下执行。如果没有,该线程就会一直处于等待状态，可阻塞当前线程。该函数需要传入另一个参数 </p>
<p><code>#define DISPATCH_TIME_NOW  表示从现在开始 #define DISPATCH_TIME_FOREVER  表示永不超时</code></p>
<h1 id="dispatch-semaphore-single"><a href="#dispatch-semaphore-single" class="headerlink" title="dispatch_semaphore_single"></a><code>dispatch_semaphore_single</code></h1><p>该函数会使传入的信号量加1,与<code>dispatch_ semaphore _ wait</code>成对出现。</p>
<p>拿YYKit源码来举例：在#import “UIButton+YYWebImage.m”中</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">instancetype</span>)init &#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">    <span class="comment">//声明一个信号总量为1信号量</span></div><div class="line">    _lock = dispatch_semaphore_create(<span class="number">1</span>);</div><div class="line">    _dic = [<span class="built_in">NSMutableDictionary</span> new];</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (_YYWebImageSetter *)setterForState:(<span class="built_in">NSNumber</span> *)state &#123;</div><div class="line"></div><div class="line"><span class="comment">//是当前线程处于阻塞状态,直到有 &gt;= 1 信号量才会继续执行下面的取值操作</span></div><div class="line">    dispatch_semaphore_wait(_lock, DISPATCH_TIME_FOREVER);</div><div class="line">    _YYWebImageSetter *<span class="keyword">setter</span> = _dic[state];</div><div class="line">    <span class="comment">//使该信号量加1。保持信号量的平衡，如果没有保持信号量的平衡,可能会出现莫名的bug,甚至crash。</span></div><div class="line">    dispatch_semaphore_signal(_lock);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">setter</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">- (_YYWebImageSetter *)lazySetterForState:(<span class="built_in">NSNumber</span> *)state &#123;</div><div class="line">    dispatch_semaphore_wait(_lock, DISPATCH_TIME_FOREVER);</div><div class="line">    _YYWebImageSetter *<span class="keyword">setter</span> = _dic[state];</div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">setter</span>) &#123;</div><div class="line">        <span class="keyword">setter</span> = [_YYWebImageSetter new];</div><div class="line">        _dic[state] = <span class="keyword">setter</span>;</div><div class="line">    &#125;</div><div class="line">    dispatch_semaphore_signal(_lock);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">setter</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在读取_YYWebImageSetter该函数中使用<code>dispatch_semaphore_wait</code>和<code>dispatch_semaphore_signal</code>使当前函数为线程安全。实际上信号量就是锁，它与 <code>@synchronized</code> 函数看起来很像。所起到的作用就是至始至终只会有一个线程去访问该函数。</p>
<p>在 <a href="http://www.cnblogs.com/snailHL/p/3906112.html" target="_blank" rel="external">这边文章中</a>很形象的比喻了信号量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">关于信号量，一般可以用停车来比喻。</div><div class="line"></div><div class="line">　　停车场剩余4个车位，那么即使同时来了四辆车也能停的下。如果此时来了五辆车，那么就有一辆需要等待。</div><div class="line"></div><div class="line">　　信号量的值就相当于剩余车位的数目，dispatch_semaphore_wait函数就相当于来了一辆车，dispatch_semaphore_signal</div><div class="line"></div><div class="line">　　就相当于走了一辆车。停车位的剩余数目在初始化的时候就已经指明了（dispatch_semaphore_create（long value）），</div><div class="line"></div><div class="line">　　调用一次dispatch_semaphore_signal，剩余的车位就增加一个；调用一次dispatch_semaphore_wait剩余车位就减少一个；</div><div class="line"></div><div class="line">　　当剩余车位为0时，再来车（即调用dispatch_semaphore_wait）就只能等待。有可能同时有几辆车等待一个停车位。有些车主</div><div class="line"></div><div class="line">　　没有耐心，给自己设定了一段等待时间，这段时间内等不到停车位就走了，如果等到了就开进去停车。而有些车主就像把车停在这，</div><div class="line"></div><div class="line">　　所以就一直等下去。</div></pre></td></tr></table></figure>
<p>举个🌰   NSMutableArray不是线程安全的,我们可以稍作修饰,线程安全的去更新数组</p>
<p>　<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSMutableArray</span> *array = [<span class="built_in">NSMutableArray</span> array];</div><div class="line"> dispatch_semaphore_t semphore = dispatch_semaphore_create(<span class="number">1</span>);</div><div class="line"> <span class="built_in">dispatch_queue_t</span> concurrentQueue = dispatch_queue_create(<span class="string">"com.starming.gcddemo.concurrentqueue"</span>,DISPATCH_QUEUE_CONCURRENT);</div><div class="line">      dispatch_apply(<span class="number">100</span>, concurrentQueue, ^(size_t i) &#123;</div><div class="line">          dispatch_semaphore_wait(semphore, DISPATCH_TIME_FOREVER);</div><div class="line">          <span class="comment">/*</span></div><div class="line">          @synchronized (array) &#123;</div><div class="line">              [array addObject:[NSNumber numberWithUnsignedInteger:i]];</div><div class="line">          &#125;</div><div class="line">           */</div><div class="line">          [array addObject:[<span class="built_in">NSNumber</span> numberWithUnsignedInteger:i]];</div><div class="line">          dispatch_semaphore_signal(semphore);</div><div class="line">      &#125;);</div><div class="line">      <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,array);</div></pre></td></tr></table></figure></p>
<p>　　
　　</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/14/cocoapods升级1.1.0/" itemprop="url">
                  cocoapods 更新到最新版本(1.1.0)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-14T20:45:52+08:00" content="2016-10-14">
              2016-10-14
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/其他/" itemprop="url" rel="index">
                    <span itemprop="name">其他</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在Apple 发布swift3.0之后 一大部分著名的第三方开源库,比如Alamofire,snapKit 之后都陆续更新到swift3.0。当我们用cocoapods管理它们或者使用它们的时候都会看到这样一句话:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CocoaPods 1.1.0+ is required to build Alamofire 4.0.0+.</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CocoaPods 1.1.0+ is required to build SnapKit 3.0.0+.</div></pre></td></tr></table></figure>
<p>需要将cocoapods更新到1.1.0版本以上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gem install cocoapods --pre //升级到最新版本</div></pre></td></tr></table></figure>
<p>但是会遇到权限问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ERROR:  While executing gem ... (Errno::EPERM) Operation not permitted - /usr/bin/pod</div></pre></td></tr></table></figure>
<p>需要这么一句话</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo gem install cocoapods --pre -n /usr/local/bin cocoa pods</div></pre></td></tr></table></figure>
<p>在10.11以上的系统中Apple已经启用无根的安装 stack overflow这么解释:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">This is happening because Apple has enabled rootless on the new install</div></pre></td></tr></table></figure>
<p><a href="http://stackoverflow.com/questions/30812777/cannot-install-cocoa-pods-after-uninstalling-results-in-error/" target="_blank" rel="external">参考链接</a></p>
<p>查看cocoapods当前版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod --version</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">1.1.0.beta.2</div></pre></td></tr></table></figure>
<p>此时cocoapods版本就会更新到最新版本.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/10/iOS开发小技巧(一)/" itemprop="url">
                  iOS开发小技巧(一)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-10T20:44:20+08:00" content="2016-10-10">
              2016-10-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="改变UIImagePickerController的导航条以及title的颜色"><a href="#改变UIImagePickerController的导航条以及title的颜色" class="headerlink" title="改变UIImagePickerController的导航条以及title的颜色"></a>改变UIImagePickerController的导航条以及title的颜色</h1><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)navigationController:(<span class="built_in">UINavigationController</span> *)navigationController willShowViewController:(<span class="built_in">UIViewController</span> *)viewController animated:(<span class="built_in">BOOL</span>)animated</div><div class="line">&#123;</div><div class="line">   [<span class="built_in">UIApplication</span> sharedApplication].statusBarStyle = <span class="built_in">UIStatusBarStyleLightContent</span>;</div><div class="line">    <span class="built_in">UINavigationBar</span> *bar = [<span class="built_in">UINavigationBar</span> appearance];</div><div class="line">    <span class="built_in">NSMutableDictionary</span> *titleDictionary = [<span class="built_in">NSMutableDictionary</span> dictionary];</div><div class="line">    titleDictionary[<span class="built_in">NSForegroundColorAttributeName</span>] = [<span class="built_in">UIColor</span> whiteColor];</div><div class="line">    [bar setTitleTextAttributes:titleDictionary];</div><div class="line">    viewController.navigationController.navigationBar.barTintColor = DIF_BASE_COLOR;</div><div class="line">    viewController.navigationController.navigationBar.tintColor = [<span class="built_in">UIColor</span> whiteColor];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="利用KVC改变TextField的占位符的颜色"><a href="#利用KVC改变TextField的占位符的颜色" class="headerlink" title="利用KVC改变TextField的占位符的颜色"></a>利用KVC改变TextField的占位符的颜色</h1><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="keyword">self</span>.nickNameTextField setValue:[<span class="built_in">UIColor</span> whiteColor] forKeyPath:<span class="string">@"_placeholderLabel.textColor"</span>];</div></pre></td></tr></table></figure>
<h1 id="TextView的字数限制"><a href="#TextView的字数限制" class="headerlink" title="TextView的字数限制"></a>TextView的字数限制</h1><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#define MaxNumberOfDescriptionChars  150</span></div><div class="line"></div><div class="line">-(<span class="keyword">void</span>)textViewEditChanged:(<span class="built_in">NSNotification</span> *)obj&#123;</div><div class="line">    <span class="built_in">UITextView</span> *textView = (<span class="built_in">UITextView</span> *)obj.object;</div><div class="line">    <span class="built_in">NSString</span> *toBeString = textView.text;</div><div class="line">    <span class="built_in">NSString</span> *lang = [[<span class="built_in">UITextInputMode</span> currentInputMode] primaryLanguage]; <span class="comment">// 键盘输入模式</span></div><div class="line">    <span class="keyword">if</span> ([lang isEqualToString:<span class="string">@"zh-Hans"</span>]) &#123; <span class="comment">// 简体中文输入，包括简体拼音，健体五笔，简体手写</span></div><div class="line">        <span class="built_in">UITextRange</span> *selectedRange = [textView markedTextRange];</div><div class="line">        <span class="comment">//获取高亮部分</span></div><div class="line">        <span class="built_in">UITextPosition</span> *position = [textView positionFromPosition:selectedRange.start offset:<span class="number">0</span>];</div><div class="line">        <span class="comment">// 没有高亮选择的字，则对已输入的文字进行字数统计和限制</span></div><div class="line">        <span class="keyword">if</span> (!position) &#123;</div><div class="line">            <span class="keyword">if</span> (toBeString.length &gt; MaxNumberOfDescriptionChars) &#123;</div><div class="line">                textView.text = [toBeString substringToIndex:MaxNumberOfDescriptionChars];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 有高亮选择的字符串，则暂不对文字进行统计和限制</span></div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 中文输入法以外的直接对其统计限制即可，不考虑其他语种情况</span></div><div class="line">    <span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">if</span> (toBeString.length &gt; MaxNumberOfDescriptionChars) &#123;</div><div class="line">            </div><div class="line">            textView.text = [toBeString substringToIndex:MaxNumberOfDescriptionChars];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">- (<span class="built_in">BOOL</span>)textView:(<span class="built_in">UITextView</span> *)textView shouldChangeTextInRange:(<span class="built_in">NSRange</span>)range replacementText:(<span class="built_in">NSString</span> *)text&#123;</div><div class="line">    <span class="built_in">NSString</span> *new = [textView.text stringByReplacingCharactersInRange:range withString:text];</div><div class="line">    <span class="keyword">self</span>.numLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%zd字"</span>,(MaxNumberOfDescriptionChars - new.length)];</div><div class="line">    <span class="keyword">if</span>(new.length &gt; MaxNumberOfDescriptionChars)&#123;</div><div class="line">         <span class="keyword">self</span>.numLabel.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%zd字"</span>,<span class="number">0</span>];</div><div class="line">        <span class="keyword">if</span> (![text isEqualToString:<span class="string">@""</span>]) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="判断字符串或者集合类型是否为空"><a href="#判断字符串或者集合类型是否为空" class="headerlink" title="判断字符串或者集合类型是否为空"></a>判断字符串或者集合类型是否为空</h1><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">BOOL</span>)isEmpty:(<span class="keyword">id</span> )obj</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> ([obj isKindOfClass:[<span class="built_in">NSString</span> <span class="keyword">class</span>]]) &#123;</div><div class="line">        <span class="keyword">if</span>(obj == <span class="literal">nil</span> || [obj <span class="keyword">class</span>] == [<span class="built_in">NSNull</span> null] || [obj isEqualToString:<span class="string">@""</span>] || [obj isEqualToString:<span class="string">@"(null)"</span>] || [obj isEqualToString:<span class="string">@"NULL"</span>] || [obj isEqualToString:<span class="string">@"&lt;null&gt;"</span>] || [obj isEqualToString:<span class="string">@"null"</span>])</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (obj == <span class="literal">nil</span> || (<span class="built_in">NSNull</span> *)obj == [<span class="built_in">NSNull</span> null] || ([obj respondsToSelector:<span class="keyword">@selector</span>(length)] &amp;&amp; [obj length] == <span class="number">0</span>) || ([obj respondsToSelector:<span class="keyword">@selector</span>(count)] &amp;&amp; [obj count] == <span class="number">0</span>))&#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="给UIResponder添加indexPath属性"><a href="#给UIResponder添加indexPath属性" class="headerlink" title="给UIResponder添加indexPath属性"></a>给UIResponder添加indexPath属性</h1><h2 id="列如在cell中有button-imageview-可以利用该属性找到cell中改该视图"><a href="#列如在cell中有button-imageview-可以利用该属性找到cell中改该视图" class="headerlink" title="列如在cell中有button imageview 可以利用该属性找到cell中改该视图"></a>列如在cell中有button imageview 可以利用该属性找到cell中改该视图</h2><h3 id="objective-C"><a href="#objective-C" class="headerlink" title="objective - C"></a>objective - C</h3><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UIResponder</span> (<span class="title">Externtion</span>)</span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSIndexPath</span> *indexPath;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</div><div class="line">&#123;</div><div class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, <span class="keyword">@selector</span>(indexPath), indexPath, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">- (<span class="built_in">NSIndexPath</span> *)indexPath&#123;</div><div class="line">    <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, <span class="keyword">@selector</span>(indexPath));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="swift"><a href="#swift" class="headerlink" title="swift"></a>swift</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIResponder</span></span>&#123;</div><div class="line">    </div><div class="line">   <span class="keyword">private</span> <span class="class"><span class="keyword">struct</span> <span class="title">AssociatedKey</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">var</span> <span class="type">AssociatedName</span> = <span class="string">"AssociatedName"</span></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">var</span> indexPath: <span class="type">NSIndexPath</span>?&#123;</div><div class="line">        <span class="keyword">get</span>&#123;</div><div class="line">           <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, &amp;<span class="type">AssociatedKey</span>.<span class="type">AssociatedName</span>) <span class="keyword">as</span>? <span class="type">NSIndexPath</span></div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">set</span>&#123;</div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> newValue = newValue &#123;</div><div class="line">                objc_setAssociatedObject(<span class="keyword">self</span>, &amp;<span class="type">AssociatedKey</span>.<span class="type">AssociatedName</span>, newValue <span class="keyword">as</span> <span class="type">NSIndexPath</span> , .<span class="type">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span>)</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="UIRefreshControl"><a href="#UIRefreshControl" class="headerlink" title="UIRefreshControl"></a>UIRefreshControl</h1><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> refresh = <span class="type">UIRefreshControl</span>.<span class="keyword">init</span>()</div><div class="line">        refresh.tintColor = <span class="type">UIColor</span>.red</div><div class="line">        refresh.attributedTitle = <span class="type">NSAttributedString</span>.<span class="keyword">init</span>(string: <span class="string">"正在加载"</span>)</div><div class="line">        refresh.addTarget(<span class="keyword">self</span>, action: #selector(<span class="type">ViewController</span>.refreshTabeleView(sender:)), <span class="keyword">for</span>: <span class="type">UIControlEvents</span>.valueChanged)</div><div class="line">        </div><div class="line">        </div><div class="line">        tableView.refreshControl = refresh</div><div class="line">        tableView.addSubview(refresh)</div><div class="line">        tableView.reloadData()</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/09/load VS initialize/" itemprop="url">
                  load VS initialize
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-09T20:35:30+08:00" content="2016-10-09">
              2016-10-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="共同点"><a href="#共同点" class="headerlink" title="共同点"></a>共同点</h1><p>方法只会被调用一次(相对于runtime而言)</p>
<h1 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h1><h2 id="load方法"><a href="#load方法" class="headerlink" title="load方法"></a>load方法</h2><p>声明一个SuperClass类继承与NSObject </p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SuperClass</span></span></div><div class="line">+ (<span class="keyword">void</span>) load &#123;</div><div class="line">  <span class="built_in">NSLog</span>(<span class="string">@"加载load方法"</span>); </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在main.m文件中导入头文件 <code>#import &quot;SuperClass.h&quot;</code></p>
<p>控制台打印输出 <code>Test[1558:44427] 加载load方法</code></p>
<p>得出结论:load是只要类所在文件被引用就会被调用</p>
<h2 id="initialize方法"><a href="#initialize方法" class="headerlink" title="initialize方法"></a>initialize方法</h2><p>执行以下代码</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">+ (<span class="keyword">void</span>) initialize &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>) load &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>控制台打印输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SuperClass +[SuperClass initialize]</div><div class="line">SuperClass +[SuperClass load]</div></pre></td></tr></table></figure>
<p>为什么initialize方法会再load方法前调用呢？通过Apple的文档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">The runtime sends initialize to each class in a program exactly one time just before the class, or any class that inherits from it, is sent its first message from within the program. (Thus the method may never be invoked if the class is not used.) The runtime sends the initialize message to classes in a thread-safe manner. Superclasses receive this message before their subclasses.</div></pre></td></tr></table></figure>
<p>得知: initialize方法在类的第一个方法被调用前调用。即先执行load方法中的[self class] 就会调用initialize方法。</p>
<h2 id="子类会调用父类的initialize"><a href="#子类会调用父类的initialize" class="headerlink" title="子类会调用父类的initialize"></a>子类会调用父类的initialize</h2><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ChildClass</span> : <span class="title">SuperClass</span></span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SuperClass</span></span></div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>) initialize &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ChildClass</span></span></div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>)load</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>还是导入头文件而不去使用它控制台打印输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SuperClass +[SuperClass initialize]</div><div class="line">ChildClass +[ChildClass initialize]</div><div class="line">ChildClass +[ChildClass load]</div></pre></td></tr></table></figure>
<h2 id="类别-Category-中的-void-load的-void-initialize"><a href="#类别-Category-中的-void-load的-void-initialize" class="headerlink" title="类别(Category)中的+(void)load的+(void)initialize"></a>类别(Category)中的+(void)load的+(void)initialize</h2><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/******* Interface *******/</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MainClass</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="comment">/******* Category Implementation *******/</span></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MainClass</span>(<span class="title">Category</span>)</span></div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>) load &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>) initialize &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MainClass</span>(<span class="title">OtherCategory</span>)</span></div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>) load &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>) initialize &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="comment">/******* Implementation *******/</span></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MainClass</span></span></div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>) load &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>) initialize &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>import 之后 </p>
<p>MainClass +[MainClass(OtherCategory) initialize]<br>MainClass +[MainClass load]<br>MainClass +[MainClass(Category) load]<br>MainClass +[MainClass(OtherCategory) load]</p>
<p>先执行类自身的实现，再执行类别(Category)中的实现</p>
<h2 id="不需要调用-super-load-和-super-initialize"><a href="#不需要调用-super-load-和-super-initialize" class="headerlink" title="不需要调用[super load] 和 [super initialize]"></a>不需要调用[super load] 和 [super initialize]</h2><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">+ (<span class="keyword">void</span>)initialize &#123;</div><div class="line">    <span class="comment">//do initialization thing</span></div><div class="line">    [<span class="keyword">super</span> initialize];</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (<span class="keyword">void</span>) load &#123;</div><div class="line">    <span class="comment">//do some loading things</span></div><div class="line">    [<span class="keyword">super</span> load];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样写是多余的</p>
<h1 id="开发过程中需要注意"><a href="#开发过程中需要注意" class="headerlink" title="开发过程中需要注意"></a>开发过程中需要注意</h1><p>在Objective-C中，运行时会自动调用每个类的两个方法。+load会在类初始加载时调用，+initialize会在第一次调用类的类方法或实例方法之前被调用。这两个方法是可选的，且只有在实现了它们时才会被调用。由于method swizzling会影响到类的全局状态，因此要尽量避免在并发处理中出现竞争的情况。+load能保证在类的初始化过程中被加载，并保证这种改变应用级别的行为的一致性。相比之下，+initialize在其执行时不提供这种保证–事实上，如果在应用中没为给这个类发送消息，则它可能永远不会被调用</p>
<p>参考链接:<br><a href="http://www.cnblogs.com/ider/archive/2012/09/29/objective_c_load_vs_initialize.html" target="_blank" rel="external">Objective C类方法load和initialize的区别</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/24/3D - Touch之Peek & Pop/" itemprop="url">
                  未命名
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-24T10:21:50+08:00" content="2016-09-24">
              2016-09-24
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="——"><a href="#——" class="headerlink" title="——-"></a>——-</h2><p>title: 3D - Touch（二）之Peek &amp; Pop<br>categories: Swift<br>tags: iOS</p>
<h2 id="date-2016-09-24-10-21-50"><a href="#date-2016-09-24-10-21-50" class="headerlink" title="date: 2016-09-24 10:21:50"></a>date: 2016-09-24 10:21:50</h2><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在介绍了前面的桌面的3D-Touch,这篇文章来介绍应用中使用peek &amp; pop。 比如QQ 微信中消息界面重压cell就会出现peek &amp; pop。接下来实现这一效果。</p>
<h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><h2 id="创建视图-sourceView"><a href="#创建视图-sourceView" class="headerlink" title="创建视图(sourceView)"></a>创建视图(sourceView)</h2><p>首先用tableview来做例子。用storyboard创建表,在这里就不赘述了。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> titleArray = [<span class="string">"3D-Touch Objective-C"</span>,<span class="string">"3D-Touch Swift"</span>,<span class="string">"前言快报:Swift终将超越OC,进而取代OC"</span>,<span class="string">"Github9月编程语言 JS 跃居第一位"</span>]</div></pre></td></tr></table></figure>
<p>创建一个数组来做tableview的数据源。</p>
<h2 id="实现代理"><a href="#实现代理" class="headerlink" title="实现代理"></a>实现代理</h2><p>在实现这一效果之前,需要使当前的控制器实现<code>UIViewControllerPreviewingDelegate</code>代理并且要判断当前设备是否支持Peek &amp; pop:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> traitCollection.forceTouchCapability == .available&#123;</div><div class="line">            registerForPreviewing(with: <span class="keyword">self</span>, sourceView: tableView)</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p>代理中有两个方法:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">previewingContext</span><span class="params">(<span class="number">_</span> previewingContext: UIViewControllerPreviewing, viewControllerForLocation location: CGPoint)</span></span> -&gt; <span class="type">UIViewController</span>?</div></pre></td></tr></table></figure>
<p>第一个参数可以获取到要显示的是哪个目标view（sourceView）以及手势,其中有个属性（sourceRect）还可以控制那块区域展示出peek的效果</p>
<p>第二个参数location 顾名思义就是要控制能产生重压的区域。(与第一个参数的sourceRect不同,sourceRect只是哪片区域要展示peek效果,就是在屏幕中视图凸起的那一部分。如果不设置默认就是整个sourceView,而这个参数则是控制哪些区域能使用peek效果)。注意 “能” 和 “要”。<br>这个方法返回的是要显示的那个控制器,就是pop预览的那个控制器。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">previewingContext</span><span class="params">(<span class="number">_</span> previewingContext: UIViewControllerPreviewing, commit viewControllerToCommit: UIViewController)</span></span></div></pre></td></tr></table></figure>
<p>这个方法就是用来做跳转的。</p>
<h2 id="开始实现代理方法"><a href="#开始实现代理方法" class="headerlink" title="开始实现代理方法"></a>开始实现代理方法</h2><p>我们需要新建一个控制器来做pop效果,返回出这个控制器。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">previewingContext</span><span class="params">(<span class="number">_</span> previewingContext: UIViewControllerPreviewing, viewControllerForLocation location: CGPoint)</span></span> -&gt; <span class="type">UIViewController</span>? &#123;</div><div class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> indexPath = tableView.indexPathForRow(at:location) , <span class="keyword">let</span> cell = tableView.cellForRow(at: indexPath) <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">let</span> detailVC  = <span class="type">UIStoryboard</span>.<span class="keyword">init</span>(name: <span class="string">"Main"</span>, bundle: <span class="literal">nil</span>).instantiateViewController(withIdentifier: <span class="string">"detail"</span>) <span class="keyword">as</span>! <span class="type">DetailViewController</span></div><div class="line">    previewingContext.sourceRect = cell.frame</div><div class="line">    detailVC.text = (cell.textLabel?.text)!</div><div class="line">    <span class="keyword">return</span> detailVC</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">previewingContext</span><span class="params">(<span class="number">_</span> previewingContext: UIViewControllerPreviewing, commit viewControllerToCommit: UIViewController)</span></span> &#123;</div><div class="line"><span class="comment">//        self.show(viewControllerToCommit, sender: self)</span></div><div class="line">        <span class="keyword">self</span>.navigationController?.pushViewController(viewControllerToCommit, animated: <span class="literal">true</span>)</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>show 和 push都能展示出相同的效果</p>
<h2 id="在显示的控制器中设置代码"><a href="#在显示的控制器中设置代码" class="headerlink" title="在显示的控制器中设置代码"></a>在显示的控制器中设置代码</h2><p>在detailviewcontroller中需要返回出pop向上拉的选项。（也可以不实现）另外要为了要展示出数据,我在该视图控制器中添加了一个textview来展示数据。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.title = <span class="string">"详情"</span></div><div class="line"><span class="keyword">self</span>.automaticallyAdjustsScrollViewInsets = <span class="literal">false</span></div><div class="line"><span class="keyword">self</span>.textView.text = text</div></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">override</span> <span class="keyword">var</span> previewActionItems: [<span class="type">UIPreviewActionItem</span>]&#123;</div><div class="line">       </div><div class="line">       <span class="keyword">let</span> action1 = <span class="type">UIPreviewAction</span>.<span class="keyword">init</span>(title: <span class="string">"喜欢"</span>, style: .<span class="keyword">default</span>) &#123; (<span class="type">UIPreviewAction</span>, <span class="type">UIViewController</span>) <span class="keyword">in</span> </div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="keyword">let</span> action2 = <span class="type">UIPreviewAction</span>.<span class="keyword">init</span>(title: <span class="string">"收藏"</span>, style: .<span class="keyword">default</span>) &#123; (<span class="type">UIPreviewAction</span>, <span class="type">UIViewController</span>) <span class="keyword">in</span></div><div class="line">           </div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="keyword">let</span> cancle = <span class="type">UIPreviewAction</span>.<span class="keyword">init</span>(title: <span class="string">"取消"</span>, style: .<span class="keyword">default</span>) &#123; (<span class="type">UIPreviewAction</span>, <span class="type">UIViewController</span>) <span class="keyword">in</span></div><div class="line">           </div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="keyword">let</span> delete = <span class="type">UIPreviewAction</span>.<span class="keyword">init</span>(title: <span class="string">"删除"</span>, style: .destructive) &#123; (<span class="type">UIPreviewAction</span>, <span class="type">UIViewController</span>) <span class="keyword">in</span></div><div class="line">           </div><div class="line">       &#125;</div><div class="line">   </div><div class="line">       <span class="keyword">let</span> actionGroup = <span class="type">UIPreviewActionGroup</span>.<span class="keyword">init</span>(title: <span class="string">"删除"</span>, style: .destructive, actions: [cancle,delete])</div><div class="line">       </div><div class="line">       <span class="keyword">return</span> [action1, action2 ,actionGroup]</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>返回的数组中存的是UIPreviewAction。这个数组可以是个二维数组,所以可以展示出很多选项。例子中返回的就是一个二维数组。</p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>到此整个效果的代码都设置完了。接下来运行程序,看看我们的成果吧:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-f73b14b53899dc5b.gif?imageMogr2/auto-orient/strip" alt="3D- Touch.gif"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/23/3D-Touch 桌面/" itemprop="url">
                  3D - Touch(一) 桌面
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-23T20:07:51+08:00" content="2016-09-23">
              2016-09-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="桌面3D-Touch"><a href="#桌面3D-Touch" class="headerlink" title="桌面3D - Touch"></a>桌面3D - Touch</h1><h2 id="快捷静态操作（Quick-actions）"><a href="#快捷静态操作（Quick-actions）" class="headerlink" title="快捷静态操作（Quick actions）"></a>快捷静态操作（Quick actions）</h2><p>需要在 <code>info.plist</code>中配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;key&gt;UIApplicationShortcutItems&lt;/key&gt;</div><div class="line">&lt;array&gt;</div><div class="line">	&lt;dict&gt;</div><div class="line">		&lt;key&gt;UIApplicationShortcutItemIconType&lt;/key&gt;</div><div class="line">		&lt;string&gt;UIApplicationShortcutIconTypeShare&lt;/string&gt;</div><div class="line">		&lt;key&gt;UIApplicationShortcutItemTitle&lt;/key&gt;</div><div class="line">		&lt;string&gt;弹一弹&lt;/string&gt;</div><div class="line">		&lt;key&gt;UIApplicationShortcutItemType&lt;/key&gt;</div><div class="line">		&lt;string&gt;com.yuwubao.search&lt;/string&gt;</div><div class="line">	&lt;/dict&gt;</div><div class="line">	&lt;dict&gt;</div><div class="line">		&lt;key&gt;UIApplicationShortcutItemIconType&lt;/key&gt;</div><div class="line">		&lt;string&gt;UIApplicationShortcutIconTypeShare&lt;/string&gt;</div><div class="line">		&lt;key&gt;UIApplicationShortcutItemTitle&lt;/key&gt;</div><div class="line">		&lt;string&gt;摇一摇&lt;/string&gt;</div><div class="line">		&lt;key&gt;UIApplicationShortcutItemType&lt;/key&gt;</div><div class="line">		&lt;string&gt;com.yuwubao.search&lt;/string&gt;</div><div class="line">	&lt;/dict&gt;</div><div class="line">	&lt;dict&gt;</div><div class="line">		&lt;key&gt;UIApplicationShortcutItemIconType&lt;/key&gt;</div><div class="line">		&lt;string&gt;UIApplicationShortcutIconTypeShare&lt;/string&gt;</div><div class="line">		&lt;key&gt;UIApplicationShortcutItemTitle&lt;/key&gt;</div><div class="line">		&lt;string&gt;扫一扫&lt;/string&gt;</div><div class="line">		&lt;key&gt;UIApplicationShortcutItemType&lt;/key&gt;</div><div class="line">		&lt;string&gt;com.yuwubao.search&lt;/string&gt;</div><div class="line">	&lt;/dict&gt;</div><div class="line">&lt;/array&gt;</div></pre></td></tr></table></figure>
<p>关于几个必须要填写的项：</p>
<ol>
<li>UIApplicationShortcutItemTitle:  表示要显示的标题。展示在你的quick action菜单中的action标题。如果标题一行无法显示并且你没有指定子标题那么它将显示两行。可以使用本地化(localised)。</li>
<li>UIApplicationShortcutItemType:  作为UIApplicationShortcutItem的一部分发送给你的应用。可以依据不同的shortcut类型用于执行你的actions。命名规则为： com.公司名.app名.图标作用名</li>
</ol>
<p>关于选填的项：</p>
<ol>
<li>UIApplicationShortcutItemIconType:  定义内置图标类型的字符串，可选类型列表可以查询<a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIApplicationShortcutIcon_Class/index.html#//apple_ref/c/tdef/UIApplicationShortcutIconType" target="_blank" rel="external">这里</a></li>
<li>UIApplicationShortcutItemSubtitle:  用户展示你的actions的子标题的字符串。它将显示在你的quick actions标题的下方。可以本地化。</li>
<li>UIApplicationShortcutItemIconFile：一个指定Assets Catalog或者Bundle中的字符串。如果指定了此键，则系统会忽略UIApplicationShortcutItemIconType</li>
<li>UIApplicationShortcutItemUserInfo：一个字典，包含你想要解析的其他信息。</li>
</ol>
<h2 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h2><p>在入口类文件（appDelegate）中</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?)</span></span> -&gt; <span class="type">Bool</span> &#123;</div><div class="line">        </div><div class="line">        <span class="comment">//检测版本</span></div><div class="line">        <span class="keyword">if</span> <span class="type">UIDevice</span>.current.systemVersion &gt;= <span class="string">"9.0"</span> &#123;</div><div class="line">            <span class="keyword">let</span> shortcutItem = launchOptions?[<span class="type">UIApplicationLaunchOptionsKey</span>.shortcutItem] <span class="keyword">as</span>? <span class="type">UIApplicationShortcutItem</span></div><div class="line">            <span class="keyword">if</span> <span class="keyword">let</span> shortcutItem = shortcutItem&#123;</div><div class="line">                <span class="keyword">self</span>.quickActionWithShortcutItem(shortcutItem: shortcutItem)</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>还要实现另一个方法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//MARK: - 3D-Touch</span></div><div class="line"> <span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, performActionFor shortcutItem: UIApplicationShortcutItem, completionHandler: @escaping <span class="params">(Bool)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</div><div class="line">     <span class="keyword">self</span>.quickActionWithShortcutItem(shortcutItem: shortcutItem)</div><div class="line">     completionHandler(<span class="literal">true</span>)</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>由于代码的冗余 需要定义一个私有的方法 可以根据<br><code>localizedTitle</code> 或者 <code>type</code> 来区别点击的是哪个。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span>  <span class="function"><span class="keyword">func</span> <span class="title">quickActionWithShortcutItem</span><span class="params">(shortcutItem: UIApplicationShortcutItem)</span></span>&#123;</div><div class="line">      <span class="keyword">let</span> nav = <span class="keyword">self</span>.window?.rootViewController <span class="keyword">as</span>? <span class="type">UINavigationController</span></div><div class="line">      <span class="keyword">if</span> shortcutItem.localizedTitle == <span class="string">"弹一弹"</span>&#123;</div><div class="line">          </div><div class="line">      &#125;<span class="keyword">else</span> <span class="keyword">if</span> shortcutItem.localizedTitle == <span class="string">"摇一摇"</span>&#123;</div><div class="line">          </div><div class="line">          <span class="keyword">let</span> detailVC = <span class="type">UIStoryboard</span>.<span class="keyword">init</span>(name: <span class="string">"Main"</span>, bundle: <span class="literal">nil</span>).instantiateViewController(withIdentifier: <span class="string">"detail"</span>) <span class="keyword">as</span>! <span class="type">DetailViewController</span></div><div class="line">          nav!.pushViewController(detailVC, animated: <span class="literal">true</span>)</div><div class="line">          </div><div class="line">      &#125;<span class="keyword">else</span>&#123;</div><div class="line">          </div><div class="line">          nav!.pushViewController(<span class="type">ThirdViewController</span>(), animated: <span class="literal">true</span>)</div><div class="line">      &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>到这里完全设置好了桌面图标的3D - Touch。 由于最近系统升级到了iOS10 桌面icon的3D - Touch 新增了widget。接下来就来时适配iOS10。</p>
<h1 id="Extention"><a href="#Extention" class="headerlink" title="Extention"></a>Extention</h1><p>(更多信息移步到<a href="https://onevcat.com/2014/08/notification-today-widget/" target="_blank" rel="external">这里</a>)(喵神博客)</p>
<p>Extensions不是独立的应用程序。Extensions必须依赖于一个host app，叫作宿主APP，同时他们的生命周期相互独立，并且可以互相触发事件。一个宿主APP可以包含多个Extensions。本篇文章主要是 Today Extention。创建方法 <code>File-&gt;New-&gt;Target</code></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-2c7a1a352ceedf42.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="QQ20160923-0@2x.png"></p>
<p>工程中会多出这些文件</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-8d30c066607b9592.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="QQ20160923-1@2x.png"></p>
<p>在MainInterface.storyboard中我们可以定制UI。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-4ac148040ca13437.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="QQ20160923-3@2x.png"></p>
<p>当我们想纯代码构建UI时,在上图显示的Info.plist中NSExtension需要将NSExtensionMainStoryboard删掉,解除与storyboard的关联</p>
<p>例子中用的storyboard构建UI。 当我们需要与APP通信时。需要用到 URL Shchemes。</p>
<h2 id="首先给label添加手势"><a href="#首先给label添加手势" class="headerlink" title="首先给label添加手势"></a>首先给label添加手势</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">widgetLabel.addGestureRecognizer(<span class="type">UITapGestureRecognizer</span>.<span class="keyword">init</span>(target: <span class="keyword">self</span></div><div class="line">            , action: #selector(<span class="type">TodayViewController</span>.widgetLabelAction)))</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">@objc private  func widgetLabelAction() -&gt; Void &#123;</div><div class="line">       extensionContext?.open(NSURL(string: &quot;simple://finished&quot;) as! URL, completionHandler: nil)</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h2 id="设置URL-Schemes"><a href="#设置URL-Schemes" class="headerlink" title="设置URL Schemes"></a>设置URL Schemes</h2><p><img src="http://upload-images.jianshu.io/upload_images/1421047-a28aeabf864d2fc2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="QQ20160923-4@2x.png"></p>
<p>运行程序</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-108a96a4f30cd1bf.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="IMG_0609.PNG"></p>
<p>我们也可以在widget中添加自己的APP显示信息了</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/20/Swift基础/" itemprop="url">
                  Swift基础
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-20T22:54:59+08:00" content="2016-09-20">
              2016-09-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="stride与循环结构"><a href="#stride与循环结构" class="headerlink" title="stride与循环结构"></a>stride与循环结构</h1><p>区间运算符<br>开区间：[a,b]<br>闭区间：[a,b)<br>举例：<br>1.开区间</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> index <span class="keyword">in</span> <span class="number">1</span>..&lt;<span class="number">10</span>&#123;</div><div class="line">    index;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>index的值一次为:0~9;可以用此方法遍历数组。比如：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> scoreArr = [<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>,<span class="number">55</span>,<span class="number">66</span>,<span class="number">77</span>,<span class="number">88</span>,<span class="number">99</span>];</div><div class="line"><span class="keyword">var</span> <span class="built_in">count</span> = scoreArr.<span class="built_in">count</span>;</div><div class="line"><span class="keyword">for</span> index <span class="keyword">in</span> <span class="number">0</span> ..&lt; <span class="built_in">count</span>&#123;</div><div class="line">    <span class="keyword">var</span> s = scoreArr[index];</div><div class="line">    <span class="built_in">print</span>(s);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2.闭区间</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> index <span class="keyword">in</span> <span class="number">1</span>...<span class="number">10</span>&#123;</div><div class="line">    index;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>index的值以此为：0~10</p>
<h1 id="在swift3-0中stride语法已经改为这样-stride-from-to-by-函数和stride-from-through-by-函数"><a href="#在swift3-0中stride语法已经改为这样-stride-from-to-by-函数和stride-from-through-by-函数" class="headerlink" title="在swift3.0中stride语法已经改为这样:stride(from: , to: , by: )函数和stride(from: , through: , by: )函数"></a>在swift3.0中stride语法已经改为这样:stride(from: , to: , by: )函数和stride(from: , through: , by: )函数</h1><p>stride 方法定义在 Strideable 协议中,swift3.0废弃了传统C的for循环之后，定义的全新方法。<br>stride(from: , to: , by: )相当于开区间；<br>stride(from: , through: , by: )相当于闭区间<br>个人理解：<br>表示从初始数值到目标数值,by:表示跨越的进度（可加可减）。<br>举例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">stride</span>(from: <span class="number">10</span>, through: <span class="number">0</span>, by: -<span class="number">1</span>)&#123;</div><div class="line">    <span class="built_in">print</span>(index);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/1421047-c9a76252e83621c3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="屏幕快照 2016-09-07 下午10.03.33.png"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">stride</span>(from: <span class="number">10</span>, to: <span class="number">0</span>, by: -<span class="number">1</span>)&#123;</div><div class="line">    <span class="built_in">print</span>(index);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>index的数值:<br>index –10<br>index –9<br>index –8<br>index –7<br>index –6<br>index –5<br>index –4<br>index –3<br>index –2<br>index –1</p>
<h2 id="用stride方法遍历scoreArr数组"><a href="#用stride方法遍历scoreArr数组" class="headerlink" title="用stride方法遍历scoreArr数组"></a>用stride方法遍历scoreArr数组</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">stride</span>(from: <span class="number">0</span>, to: scoreArr.<span class="built_in">count</span>, by: <span class="number">1</span>)&#123;</div><div class="line">    <span class="keyword">var</span> arr = scoreArr[i];</div><div class="line">    <span class="built_in">print</span>(arr);</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/20/多种方法使tableView的Header下拉放大/" itemprop="url">
                  多种方法使tableView的Header下拉放大
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-20T22:15:16+08:00" content="2016-09-20">
              2016-09-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>看了<a href="http://www.jianshu.com/users/b09c3959ab3b/latest_articles" target="_blank" rel="external">峥吖</a>同学的这篇文章<a href="http://www.jianshu.com/p/859e3ef76b05" target="_blank" rel="external">【一行代码快速集成tableView头部缩放视图】</a>之后 。想着自己用其他的方法来实现这一效果，于是乎想到</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CGAffineTransformMakeScale</div></pre></td></tr></table></figure>
<p>这一方法。</p>
<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="http://upload-images.jianshu.io/upload_images/1421047-f9cf98990ebda6b2.gif?imageMogr2/auto-orient/strip" alt="下拉放大.gif"></p>
<h1 id="开始实现"><a href="#开始实现" class="headerlink" title="开始实现"></a>开始实现</h1><p>在自己写的过程中发现了一些问题, 直接把</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.tableView.tableHeaderView = <span class="keyword">self</span>.imageView</div></pre></td></tr></table></figure>
<p>之后并不能达到想要的效果。整张图片frame都随着tableview的拖动而改变。并不是像是固定在那里。tableview的顶部会出现大部分空白。然后我仔细看了一遍源码。发现做法是</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="keyword">self</span>.tableView insertSubview:imageView atIndex:<span class="number">0</span>];</div></pre></td></tr></table></figure>
<p>接着把一个透明view填充到tableview的header view中。   </p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">UIView</span> *headerView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>)];    </div><div class="line">headerView.backgroundColor = [<span class="built_in">UIColor</span> clearColor];    </div><div class="line"><span class="keyword">self</span>.tableView.tableHeaderView = headerView;</div></pre></td></tr></table></figure>
<p>找到这一技巧之后。自己写了一个稍微简单的demo。</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithImage:[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"header"</span>]];</div><div class="line">imageView.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="keyword">self</span>.view.frame.size.width, imageViewH);</div><div class="line">[<span class="keyword">self</span>.tableView insertSubview:imageView atIndex:<span class="number">0</span>];</div><div class="line"><span class="keyword">self</span>.imageView = imageView;</div><div class="line"></div><div class="line"><span class="built_in">UIView</span> *headerView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, imageViewH)];</div><div class="line">headerView.backgroundColor = [<span class="built_in">UIColor</span> clearColor];</div><div class="line"><span class="keyword">self</span>.tableView.tableHeaderView = headerView;</div></pre></td></tr></table></figure>
<p>在</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)scrollViewDidScroll:(<span class="built_in">UIScrollView</span> *)scrollView</div></pre></td></tr></table></figure>
<p>方法中这么写:</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CGFloat</span> offsetY = scrollView.contentOffset.y;</div><div class="line">  <span class="keyword">if</span> (offsetY &lt; <span class="number">0</span>) &#123;</div><div class="line">      <span class="keyword">self</span>.imageView.frame = <span class="built_in">CGRectMake</span>(offsetY, offsetY, scrollView.bounds.size.width - offsetY * <span class="number">2</span>, imageViewH - offsetY);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">self</span>.imageView.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, scrollView.bounds.size.width, imageViewH);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>原理一模一样,拿到scrollview的偏移量计算下拉imageview的frame,使其imageview的宽高增大。上拉的时候恢复原来的frame。</p>
<h1 id="另一种方法"><a href="#另一种方法" class="headerlink" title="另一种方法"></a>另一种方法</h1><p>还是在</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)scrollViewDidScroll:(<span class="built_in">UIScrollView</span> *)scrollView</div></pre></td></tr></table></figure>
<p>方法中拿到scrollview的偏移量计算缩放系数</p>
<figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CGFloat</span> offsetY = scrollView.contentOffset.y + scrollView.contentInset.top;</div><div class="line"><span class="built_in">CGFloat</span> scale = <span class="number">1.0</span>;</div><div class="line"><span class="keyword">if</span> (offsetY &lt; <span class="number">0</span>) &#123;</div><div class="line">    <span class="comment">//向下拉</span></div><div class="line">    scale = MIN(<span class="number">2.5</span>, <span class="number">1</span> - offsetY / imageViewH);</div><div class="line">    <span class="keyword">self</span>.imageView.transform = <span class="built_in">CGAffineTransformMakeScale</span>(scale, scale);</div><div class="line">    <span class="built_in">CGRect</span> frame = <span class="keyword">self</span>.imageView.frame;</div><div class="line">    frame.origin.y = offsetY;</div><div class="line">    <span class="keyword">self</span>.imageView.frame = frame;</div><div class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(offsetY &gt; <span class="number">0</span>)</div><div class="line">&#123;</div><div class="line">    <span class="comment">//向上拉</span></div><div class="line">    <span class="built_in">CGRect</span> frame = <span class="keyword">self</span>.imageView.frame;</div><div class="line">    frame.origin.y = -offsetY/imageViewH;</div><div class="line">    <span class="keyword">self</span>.imageView.frame = frame;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>再向上拉的过程中要保证imageview不会进行缩放，只是改变下imageview的y轴的值。</p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>感谢<a href="http://www.jianshu.com/users/b09c3959ab3b/latest_articles" target="_blank" rel="external">峥吖</a>同学提供的思路。demo地址:<a href="https://github.com/sunshineLixun/tableViewHeaderScale" target="_blank" rel="external">戳我</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.png"
               alt="Sunshine" />
          <p class="site-author-name" itemprop="name">Sunshine</p>
          <p class="site-description motion-element" itemprop="description">做一个有文艺气息的程序猿</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">9</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/sunshineLixun" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sunshine</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
